<!DOCTYPE html>
<html lang="zh-CN">





<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  <meta name="description" content="王诛魔">
  <meta name="author" content="wangzhumo">
  <meta name="keywords" content="">
  <title>Glide4.X版本的基本使用 ~ 王诛魔</title>

  <link rel="stylesheet" href="/lib/font-awesome/css/all.min.css"  >
<link rel="stylesheet" href="/lib/bootstrap/css/bootstrap.min.css"  >
<link rel="stylesheet" href="/lib/mdbootstrap/css/mdb.min.css"  >
<link rel="stylesheet" href="/lib/github-markdown/github-markdown.min.css"  >
<link rel="stylesheet" href="//at.alicdn.com/t/font_1067060_qzomjdt8bmp.css">


  <link rel="stylesheet" href="/lib/prettify/github-v2.min.css"  >

<link rel="stylesheet" href="/css/main.css"  >


  <link rel="stylesheet" href="/lib/fancybox/jquery.fancybox.min.css"  >


</head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>王诛魔</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/">首页</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/archives/">归档</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/categories/">分类</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/tags/">标签</a>
          </li>
        
          
          
          <li class="nav-item">
            <a class="nav-link" href="/about/">关于</a>
          </li>
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>


</nav>

    <div class="view intro-2" id="background"
         style="background: url('/img/default.png')no-repeat center center;
           background-size: cover;
           background-attachment: fixed;">
      <div class="full-bg-img">
        <div class="mask rgba-black-light flex-center">
          <div class="container text-center white-text fadeInUp">
            <span class="h2" id="subtitle">
              
            </span>

            
              <br>
              
                <p class="mt-3">
                  <i class="fas fa-calendar-alt" aria-hidden="true"></i>&nbsp;
                  星期四, 八月 9日 2018, 2:32 下午
                </p>
              

              <p>
                
                  
                  &nbsp;<i class="far fa-chart-bar"></i>
                  <span class="post-count">
                    1k 字
                  </span>&nbsp;
                

                
                  
                  &nbsp;<i class="far fa-clock"></i>
                  <span class="post-count">
                      5 分钟
                  </span>&nbsp;
                

                
                  <!-- 不蒜子统计文章PV -->
                  
                  &nbsp;<i class="far fa-eye" aria-hidden="true"></i>&nbsp;
                  <span id="busuanzi_container_page_pv">
                    <span id="busuanzi_value_page_pv"></span> 次
                  </span>&nbsp;
                
              </p>
            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="py-5 z-depth-3" id="board">
        <div class="post-content mx-auto" id="post">
          <div class="markdown-body">
            <h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>Glide是一款性能优异,包大小中等,加载速度快的图片加载工具,也是Google推荐使用的加载框架之一.</p>
<p>在以前的工程中,我们都是使用3.8版本一下的Glide,而在4.X版本中,Glide的使用方式发生了一些变化,所以今天特意写了笔记来记录,以便于以后使用时查阅</p>
<h4 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h4><blockquote>
<p>Glide:   <a href="https://github.com/bumptech/glide" target="_blank" rel="noopener">https://github.com/bumptech/glide</a></p>
</blockquote>
<a id="more"></a>
<h4 id="依赖"><a href="#依赖" class="headerlink" title="依赖:"></a>依赖:</h4><pre><code class="groovy">implementation (&quot;com.github.bumptech.glide:glide:4.7.1&quot;) {
    exclude group: &quot;com.android.support&quot;
}
annotationProcessor &quot;com.github.bumptech.glide:compiler:4.7.1&quot;
//kotlin使用kapt
// kapt &#39;com.github.bumptech.glide:compiler:4.7.1&#39;    
//如果你需要使用okhttp作为网络层
implementation &quot;com.github.bumptech.glide:okhttp3-integration:4.7.1&quot;
</code></pre>
<h4 id="混淆-proguard"><a href="#混淆-proguard" class="headerlink" title="混淆(proguard):"></a>混淆(proguard):</h4><pre><code class="xml">-keep public class * implements com.bumptech.glide.module.GlideModule
-keep public class * extends com.bumptech.glide.module.AppGlideModule
-keep public enum com.bumptech.glide.load.resource.bitmap.ImageHeaderParser$** {
  **[] $VALUES;
  public *;
}
# for DexGuard only
-keepresourcexmlelements manifest/application/meta-data@value=GlideModule
</code></pre>
<h3 id="开始使用"><a href="#开始使用" class="headerlink" title="开始使用"></a>开始使用</h3><h4 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h4><p>继承 AppGlideModule</p>
<pre><code class="java">/**
 * If you have any questions, you can contact by email {wangzhumoo@gmail.com}
 * @author 王诛魔 2018/8/9 下午12:16
 */
@GlideModule
public class GlideLoaderModule extends AppGlideModule {

    @Override
    public void applyOptions(Context context, GlideBuilder builder) {
        RequestOptions options  = new RequestOptions()
                .centerCrop()
                .placeholder(R.drawable.default_images_load)
                .error(R.drawable.default_images_load)
                .priority(Priority.HIGH)
                .format(DecodeFormat.PREFER_ARGB_8888)
                .diskCacheStrategy(DiskCacheStrategy.ALL);
        int maxMemory = (int) Runtime.getRuntime().maxMemory();
        int memoryCacheSize = maxMemory / 8;
        //设置内存缓存大小
        File cacheDir = new File(ApiConstants.INSTANCE.getIMAGE_PATH() + File.separator);
        if(!cacheDir.exists()){
            cacheDir.mkdirs();
        }
        int diskCacheSize = 1024 * 1024 * 512;
        //设置磁盘缓存大小
        builder.setMemoryCache(new LruResourceCache(memoryCacheSize));
        builder.setDiskCache(new DiskLruCacheFactory(cacheDir.getPath(), &quot;Images&quot;, diskCacheSize));
        builder.setDefaultRequestOptions(options);
    }


    @Override
    public void registerComponents(Context context, Glide glide, Registry registry) {
        registry.replace(GlideUrl.class, InputStream.class, new OkHttpUrlLoader.Factory());
    }
}
</code></pre>
<p>注意,<code>GlideLoaderModule</code>在4.X版本之后,不需要写到Manifest文件中去,但是需要你添加<code>@GlideModule</code>注解</p>
<p>注意,<code>GlideLoaderModule</code>在4.X版本之后,不需要写到Manifest文件中去,但是需要你添加<code>@GlideModule</code>注解</p>
<h4 id="占位符"><a href="#占位符" class="headerlink" title="占位符"></a>占位符</h4><ul>
<li><p><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#placeholder-int-" target="_blank" rel="noopener">placeholder</a></p>
<ul>
<li><p>占位符是当请求正在执行时被展示的 Drawable,当请求成功完成时,占位符会被请求到的资源替</p>
</li>
<li><p>如果资源是从内存中加载出来的，那么占位符可能根本不会被显示</p>
</li>
<li>如果请求失败并且没有设置 <code>error Drawable</code> ，则占位符将被持续展示</li>
</ul>
</li>
<li><p><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#error-int-" target="_blank" rel="noopener">error</a></p>
<ul>
<li>在请求永久性失败时展示</li>
<li>也在请求的url/model为 <code>null</code> ，且并没有设置 <code>fallback Drawable</code> 时展示</li>
</ul>
</li>
<li><p><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/request/RequestOptions.html#fallback-int-" target="_blank" rel="noopener">fallback</a></p>
<ul>
<li>在请求的url/model为 <code>null</code> 时展示(注意,null).   会覆盖<code>error</code>的第二条显示条件</li>
</ul>
</li>
</ul>
<h4 id="Transform-圆角"><a href="#Transform-圆角" class="headerlink" title="Transform(圆角)"></a>Transform(圆角)</h4><p>变换这块,分为几个部分</p>
<h5 id="默认变换"><a href="#默认变换" class="headerlink" title="默认变换"></a>默认变换</h5><ul>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/load/resource/bitmap/CenterCrop.html" target="_blank" rel="noopener">CenterCrop</a></li>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/load/resource/bitmap/FitCenter.html" target="_blank" rel="noopener">FitCenter</a></li>
<li><a href="https://muyangmin.github.io/glide-docs-cn/javadocs/400/com/bumptech/glide/load/resource/bitmap/CircleCrop.html" target="_blank" rel="noopener">CircleCrop</a></li>
</ul>
<h5 id="多重变换"><a href="#多重变换" class="headerlink" title="多重变换"></a>多重变换</h5><p>使用<code>transform</code>方法</p>
<ul>
<li><p>方式一</p>
<pre><code class="java">Glide.with(context)
  .load(url)
  .transform(new MultiTransformation(new FitCenter(), new CustomTransformation())
  .into(imageView);
</code></pre>
</li>
<li><p>方式二</p>
<pre><code class="java">GlideApp.with(context)
  .load(url)
  .transforms(new FitCenter(), new CustomTransformation())
  .into(imageView);
</code></pre>
</li>
</ul>
<h5 id="自定义变换"><a href="#自定义变换" class="headerlink" title="自定义变换()"></a>自定义变换()</h5><pre><code class="java">/**
 * If you have any questions, you can contact by email {wangzhumoo@gmail.com}
 * @author 王诛魔 2017/11/2 上午12:20
 * 圆角图片
 */

public class GlideRoundTransform extends BitmapTransformation {

    private static final String ID = &quot;com.wangzhumo.app.commonlib.utils.GlideRoundTransform&quot;;

    private static float radius = 0f;

    public GlideRoundTransform() {
        this(5);
    }

    /**
     * 圆角像素
     * @param dp
     */
    public GlideRoundTransform(int dp) {
        radius = Resources.getSystem().getDisplayMetrics().density * dp;
    }

    @Override
    protected Bitmap transform(@NonNull BitmapPool pool, @NonNull Bitmap toTransform, int outWidth, int outHeight) {
        return roundCrop(pool, toTransform);
    }

    private static Bitmap roundCrop(BitmapPool pool, Bitmap source) {
        if (source == null) return null;
        Bitmap result = pool.get(source.getWidth(), source.getHeight(), Bitmap.Config.ARGB_8888);
        Canvas canvas = new Canvas(result);
        Paint paint = new Paint();
        paint.setShader(new BitmapShader(source, BitmapShader.TileMode.CLAMP, BitmapShader.TileMode.CLAMP));
        paint.setAntiAlias(true);
        RectF rectF = new RectF(0f, 0f, source.getWidth(), source.getHeight());
        canvas.drawRoundRect(rectF, radius, radius, paint);
        return result;
    }

    @Override
    public boolean equals(Object o) {
        return o instanceof GlideRoundTransform;
    }

    @Override
    public int hashCode() {
        return ID.hashCode();
    }

    @Override
    public void updateDiskCacheKey(MessageDigest messageDigest) {
        messageDigest.update(ID.getBytes());
    }
}
</code></pre>
<p>其中<code>equals()</code>,<code>hashCode()</code>,<code>updateDiskCacheKey</code>主要是为了缓存和存储的正常工作</p>
<h4 id="GlideExtension-扩展API"><a href="#GlideExtension-扩展API" class="headerlink" title="GlideExtension(扩展API)"></a>GlideExtension(扩展API)</h4><h5 id="GlideOption"><a href="#GlideOption" class="headerlink" title="GlideOption"></a>GlideOption</h5><pre><code class="java">/**
 * If you have any questions, you can contact by email {wangzhumoo@gmail.com}
 * @author 王诛魔 2018/8/9 下午2:57
 * 支持快捷使用圆角图片
 */
@GlideExtension
public final class RoundGlideExtension {

    private RoundGlideExtension(){ }

    /**
     * 给url添加参数
     * @param options RequestOptions
     */
    @GlideOption
    public static void round(RequestOptions options,int corner){
        options.transform(new GlideRoundTransform(corner));
    }

    /**
     * 给url添加参数
     * @param options RequestOptions
     */
    @GlideOption
    public static void round(RequestOptions options){
        options.transform(new GlideRoundTransform());
    }
}
</code></pre>
<ol>
<li>添加<code>@GlideExtension</code>注解</li>
<li>私有构造</li>
<li>静态方法,以及<code>@GlideOption</code>注解</li>
</ol>
<pre><code class="java">//通过
GlideApp.with(context).load(url).apply(options).round();
// or
GlideApp.with(context).load(url).apply(options).round(corner);
//来加载圆角图片
</code></pre>
<h5 id="GlideType"><a href="#GlideType" class="headerlink" title="GlideType"></a>GlideType</h5><p>允许你添加对新的资源类型的支持，包括指定默认选项。</p>
<p>暂时没有使用.</p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>下一期,我们做一个带进度条的图片加载.</p>

            <hr>
          </div>
          <br>
          <div>
            <p>
            
              <span>
                <i class="iconfont icon-inbox"></i>
                
                  <a class="hover-with-bg" href="/categories/Android">Android</a>
                  &nbsp;
                
              </span>&nbsp;&nbsp;
            
            
              <span>
                <i class="iconfont icon-tag"></i>
                
                  <a class="hover-with-bg" href="/tags/Android">Android</a>
                
              </span>
            
            </p>
            
          </div>
        </div>
      </div>
    </div>
    <div class="d-none d-lg-block col-lg-2 toc-container">
      
  <div id="toc">
    <p class="h4"><i class="far fa-list-alt"></i>&nbsp;目录</p>
    <div id="tocbot"></div>
  </div>

    </div>
  </div>
</div>

<!-- custom -->


<!-- Comments -->
<div class="col-lg-7 mx-auto nopadding-md">
  <div class="container comments mx-auto" id="comments">
    
  </div>
</div>

    
  </main>

  
    <a class="z-depth-1" id="scroll-top-button" href="#" role="button">
      <i class="fa fa-chevron-up scroll-top-arrow" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  <footer class="mt-5">
  <div class="text-center py-3">
    <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><b>Hexo</b></a>
    <i class="iconfont icon-love"></i>
    <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"> <b>Fluid</b></a>
    <br>

    
  
    <!-- 不蒜子统计PV -->
    
    &nbsp;<span id="busuanzi_container_site_pv">总访问量 
          <span id="busuanzi_value_site_pv"></span> 次</span>&nbsp;
  
  
    <!-- 不蒜子统计UV -->
    
    &nbsp;<span id="busuanzi_container_site_uv">总访客数 
            <span id="busuanzi_value_site_uv"></span> 人</span>&nbsp;
  
  <br>



    
  <!-- 备案信息 -->
  <a href="http://beian.miit.gov.cn/" target="_blank"
     rel="nofollow noopener">京ICP备19052807号-1</a>
  


  </div>
</footer>

<!-- SCRIPTS -->
<script src="/lib/jquery/jquery.min.js" ></script>
<script src="/lib/popper/popper.min.js" ></script>
<script src="/lib/bootstrap/js/bootstrap.min.js" ></script>
<script src="/lib/mdbootstrap/js/mdb.min.js" ></script>
<script src="/js/main.js" ></script>


  <script src="/js/lazyload.js" ></script>



  
    <script src="/lib/tocbot/tocbot.min.js" ></script>
  
  <script src="/js/post.js" ></script>



  <script src="/lib/smooth-scroll/smooth-scroll.min.js" ></script>



  <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" ></script>


<!-- Plugins -->


  
    <!-- Baidu Analytics -->
    <script>
      var _hmt = _hmt || [];
      (function () {
        var hm = document.createElement("script");
        hm.src = "https://hm.baidu.com/hm.js?";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(hm, s);
      })();
    </script>
  

  
    <!-- Google Analytics -->
    <script>
      (function (i, s, o, g, r, a, m) {
        i['GoogleAnalyticsObject'] = r;
        i[r] = i[r] || function () {
          (i[r].q = i[r].q || []).push(arguments)
        }, i[r].l = 1 * new Date();
        a = s.createElement(o),
          m = s.getElementsByTagName(o)[0];
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m)
      })(window, document, 'script', 'https://www.google-analytics.com/analytics.js', 'ga');

      ga('create', '', 'auto');
      ga('send', 'pageview');
    </script>
  

  

  

  




  <script src="/lib/prettify/prettify.min.js" ></script>
  <script>
    $(document).ready(function () {
      $('pre').addClass('prettyprint  linenums');
      prettyPrint();
    })
  </script>



  <script src="/lib/typed/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "Glide4.X版本的基本使用&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script src="/lib/anchor/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "false",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      getSearchFile(path);
      this.onclick = null
    }
  </script>



  <script src="/lib/fancybox/jquery.fancybox.min.js" ></script>
  <script>
    $("#post img:not(.no-zoom img, img[no-zoom])").each(
      function () {
        var element = document.createElement("a");
        $(element).attr("data-fancybox", "images");
        $(element).attr("href", $(this).attr("src"));
        $(this).wrap(element);
      }
    );
  </script>







</body>
</html>
