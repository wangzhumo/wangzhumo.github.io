<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[Android Binder机制(一)]]></title>
      <url>/Source-Code/Android-Binder%E6%9C%BA%E5%88%B6-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h3 id="ServiceManager"><a href="#ServiceManager" class="headerlink" title="ServiceManager"></a>ServiceManager</h3><p>首先我们要了解一下ServiceManager.</p>
<p>ServiceManager的功能主要就是注册,查询服务,作为一个大管家的角色出现.</p>
<ul>
<li>注册服务：记录服务名和信息，放到服务列表</li>
<li>查询服务：根据服务名查询相应的的信息</li>
</ul>
<p>ServiceManager是有权限控制的，只有具有相应权限的进程才能注册,查询服务</p>
<h3 id="Linux内存"><a href="#Linux内存" class="headerlink" title="Linux内存"></a>Linux内存</h3><h4 id="内核空间"><a href="#内核空间" class="headerlink" title="内核空间"></a>内核空间</h4><p>为什么进程间不可以直接通讯那?</p>
<p>因为每个进程的内存空间都是隔离起来的,不可能随意去访问其他进程的内存.</p>
<p>在32位系统中,寻址空间最大为4G,那么这4G内存,一般将1G分配给内核空间,3G用户空间,Linux内核由系统内的所有进程共享.</p>
<p><img src="/images/linux_memory.png" alt=""></p>
<p>这么一来,我们就可以在内核空间为所欲为了,不,并不能.用户进程不能直接操作内核.</p>
<p>Android是在Linux的内核上跑的,那么为什么Android要自己做一个Binder来实现进程间的通讯那?</p>
<p>我们都知道Linux上Socket/管道/消息队列都可以做到进程间的通讯,但是通过这些都需要2次内存拷贝,</p>
<p>而Binder只需要一次就可以完成,大大的提高效率</p>
<h4 id="BINDER-MMAP"><a href="#BINDER-MMAP" class="headerlink" title="BINDER_MMAP"></a>BINDER_MMAP</h4><p>mmap可以将一个文件或者其它对象映射进内存</p>
<p>在Binder中,通过在用户空间(当前进程的用户空间)创建一个虚拟地址空间,并在内核空间创建相同大小的虚拟地址空间.</p>
<p>接着申请一块物理内存,将物理内存映射到内核虚拟地址空间和用户虚拟内存空间,这样就实现了用户控件和内核空间的同步.</p>
<p>来自Gityuan大神的分享<a href="http://gityuan.com/2015/11/01/binder-driver/" target="_blank" rel="noopener">http://gityuan.com/2015/11/01/binder-driver/</a></p>
<blockquote>
<ul>
<li>binder_init：初始化字符设备；</li>
<li>binder_open：打开驱动设备，过程需要持有binder_main_lock同步锁；</li>
<li>binder_mmap：申请内存空间，该过程需要持有binder_mmap_lock同步锁；</li>
<li>binder_ioctl：执行相应的ioctl操作，该过程需要持有binder_main_lock同步锁；<ul>
<li>当处于binder_thread_read过程，read_buffer无数据则释放同步锁，并处于wait_event_freezable过程，等有数据到来则唤醒并尝试持有同步锁。</li>
</ul>
</li>
</ul>
</blockquote>
<p><img src="/images/binder_physical_memory.jpg" alt="来自Gityuan大佬"></p>
]]></content>
      
        <categories>
            
            <category> Source Code </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Source Code </tag>
            
            <tag> Binder </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[线程与进程的异同以及Android中的IPC机制]]></title>
      <url>/Java/%E7%BA%BF%E7%A8%8B%E4%B8%8E%E8%BF%9B%E7%A8%8B%E7%9A%84%E5%BC%82%E5%90%8C%E4%BB%A5%E5%8F%8AAndroid%E4%B8%AD%E7%9A%84IPC%E6%9C%BA%E5%88%B6/</url>
      <content type="html"><![CDATA[<h3 id="线程与进程"><a href="#线程与进程" class="headerlink" title="线程与进程"></a>线程与进程</h3><p>Google  Doc (<a href="https://developer.android.com/guide/components/processes-and-threads" target="_blank" rel="noopener">https://developer.android.com/guide/components/processes-and-threads</a>)</p>
<ul>
<li><p>进程是资源分配的最小单位，线程是cpu调度的最小单位.</p>
</li>
<li><p>进程是应用程序的执行实例,一个进程中可以包含多个线程,</p>
<p>而一个进程的创建分配是要消耗较大的性能的,相比来说线程就要比进程的开销小.</p>
</li>
<li><p>对于进程来说不共享资源,内存是独立的.而线程共享它所在的线程的资源,内存.</p>
</li>
<li><p>进程间的通信就要更加麻烦,需要使用IPC( Inter-Proscess Communication)进程间的通讯</p>
<p>线程方便很多,但是线程间的同步又是一个较为大的课题了.</p>
<p>​</p>
<blockquote>
<p>想强调的是，线程关注的是中央处理器的运行，而不是进程那样关注内存等资源的管理。</p>
</blockquote>
</li>
</ul>
<h3 id="Android中的IPC机制"><a href="#Android中的IPC机制" class="headerlink" title="Android中的IPC机制"></a>Android中的IPC机制</h3><p>如下图所示:(已经不知道哪里的配图了…感谢分享)</p>
<p><img src="/images/android_ipc.png" alt=""></p>
<h4 id="IPC简介"><a href="#IPC简介" class="headerlink" title="IPC简介"></a>IPC简介</h4><p>IPC(Inter-Process Communication) 进程间通信</p>
<p>使用场景:</p>
<p>在Android程序中，一般情况下一个程序就是一个进程</p>
<ol>
<li><p>App间的通信,常见的如需要使用其他App的数据</p>
</li>
<li><p>一个App使用多进程,比如指定运行线程<code>android:process=&quot;:name&quot;</code></p>
<blockquote>
<p>需要注意的是,如果一个App使用多进程,Application也会多次创建</p>
</blockquote>
</li>
</ol>
<h4 id="Bundle"><a href="#Bundle" class="headerlink" title="Bundle"></a>Bundle</h4><p>常见于Activity,service中传递数据</p>
<p>需要注意的是,bundle中的数据必须支持序列化(Serializable,Parcelable)</p>
<h4 id="文件共享"><a href="#文件共享" class="headerlink" title="文件共享"></a>文件共享</h4><p>SharedPreference就是这种实现的.</p>
<p>适合对同步要求不高的使用方式,需要注意处理好并发的问题.</p>
<h4 id="Messenger"><a href="#Messenger" class="headerlink" title="Messenger"></a>Messenger</h4><p>Messenger 对 AIDL 进行了封装，它实现了一种基于消息的进程间通信的方式</p>
<p><code>frameworks/base/core/java/android/os/IMessenger.aidl</code></p>
<p>它的AIDL文件就在这里保存着!</p>
<h4 id="AIDL"><a href="#AIDL" class="headerlink" title="AIDL"></a>AIDL</h4><p>AIDL（Android Interface definition language） 是 Android 提供的一种进程间通信 (IPC) 机制</p>
<p>需要注意的是AIDL支持的数据类型与Java接口支持的数据类型有些不同:</p>
<ol>
<li>所有基础类型（int, char…）</li>
<li>String，List，Map</li>
<li>所有Parcelable的类</li>
</ol>
<p>并且要根据需要添加 in out 的关键词</p>
<h4 id="ContentProvider"><a href="#ContentProvider" class="headerlink" title="ContentProvider"></a>ContentProvider</h4><p>主要是针对数据库使用的,最常见的例子就是Android中有很多已经定义好的ContentProvider</p>
<h4 id="Socket"><a href="#Socket" class="headerlink" title="Socket"></a>Socket</h4><p>说道这里,就不得不提一下<strong>Binder</strong>了</p>
]]></content>
      
        <categories>
            
            <category> Java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java中的内存模型]]></title>
      <url>/Java/Java%E4%B8%AD%E7%9A%84%E5%86%85%E5%AD%98%E6%A8%A1%E5%9E%8B/</url>
      <content type="html"><![CDATA[<p><img src="/images/java_heap_stack.png" alt="java_heap_stack"></p>
<h4 id="1-堆"><a href="#1-堆" class="headerlink" title="1. 堆"></a>1. 堆</h4><p>在JVM中只有一个,java回收机制主要就是作用于这一块</p>
<p>堆主要是用来存放存储对象的内容及其本身的.</p>
<h4 id="2-方法区"><a href="#2-方法区" class="headerlink" title="2. 方法区"></a>2. 方法区</h4><p>方法区也和堆一样,是被线程共享的.</p>
<p>存放了类的信息(方法,字段,名称),静态变量,常量</p>
<p>Java1.7之前,字符串常量池也是放在这里的,但是1.7以后移动到堆里面去了</p>
<h4 id="3-虚拟机栈"><a href="#3-虚拟机栈" class="headerlink" title="3. 虚拟机栈"></a>3. 虚拟机栈</h4><p><img src="/images/java_stack.png" alt="java_stack"></p>
<p>每一个栈帧的出入栈都是一个方法被调起直到结束返回的过程.</p>
<p>每个线程都会有一个自己的Java栈，栈帧中包括</p>
<ul>
<li><p>局部变量表(Local Variables)</p>
<p>方法中的局部变量,函数的参数等.对于基础类型的变量直接存储他的值,而引用类型的变量</p>
<p>则存储的是指向对象的引用</p>
</li>
<li><p>操作数栈(Operand Stack)</p>
</li>
<li><p>指向运行时常量池的引用(Reference to runtime constant pool)</p>
<p>保证方法可以使用当前类的常量</p>
</li>
<li><p>方法返回地址(Return Address)</p>
<p>执行一个方法完成后需要返回调用它的地方</p>
</li>
<li><p>附加信息</p>
</li>
</ul>
<h4 id="4-程序计数器"><a href="#4-程序计数器" class="headerlink" title="4. 程序计数器"></a>4. 程序计数器</h4><p>Program Counter Register 也称作为PC寄存器,保存的是程序当前执行的指令的地址</p>
<h4 id="5-本地方法栈"><a href="#5-本地方法栈" class="headerlink" title="5.本地方法栈"></a>5.本地方法栈</h4><p>本地方法栈则是为执行本地方法（Native Method）服务的</p>
]]></content>
      
        <categories>
            
            <category> Java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android的启动流程]]></title>
      <url>/Source-Code/Android%E7%9A%84%E5%90%AF%E5%8A%A8%E6%B5%81%E7%A8%8B/</url>
      <content type="html"><![CDATA[<h5 id="系统结构"><a href="#系统结构" class="headerlink" title="系统结构"></a>系统结构</h5><ul>
<li><p>应用层</p>
<p>即为开发出来的一些app,当然还包括了一些系统App</p>
</li>
<li><p>应用框架层(Java API Framework)</p>
<p>这一层由java编写,提供给我们平时开发使用的API,主要的一些组件:</p>
<ul>
<li><p>Manager</p>
<p>Activity Manager , Window Manager , Package Manager ,Location Manager </p>
<p>Notification Manager,Resource Manager,Telephony Manager</p>
</li>
<li><p>Content Providers</p>
</li>
<li><p>View System</p>
</li>
</ul>
</li>
<li><p>系统运行库层</p>
<p>C/C++程序库和Android运行时库</p>
</li>
<li><p>硬件抽象层(<strong>HAL</strong>)</p>
</li>
<li><p>Linux内核层</p>
</li>
</ul>
<p><img src="/images/android_boot_process.png" alt="boot"></p>
<h5 id="Android的启动主要过程"><a href="#Android的启动主要过程" class="headerlink" title="Android的启动主要过程"></a>Android的启动主要过程</h5><ol>
<li><p><strong>init进程</strong></p>
<p>init进程是由内核启动的,是用户空间的第一个进程,可以说是一个root进程</p>
<ul>
<li>当init进程启动后会创建挂载系统目录,设备节点,</li>
<li>解析init.rc 和 init.hardware.rc,启动属性服务，以及一系列的服务和进程</li>
</ul>
</li>
</ol>
<ol>
<li><p><strong>本地守护进程</strong></p>
<p>启动</p>
<blockquote>
<p>servicemanager  管理binder的通讯</p>
<p>surfaceflinger  UI</p>
<p>mediaserver  音视频,相机</p>
<p>netd  蓝牙、wifi、usb等</p>
<p>adbd</p>
<p>rild</p>
<p>installd </p>
</blockquote>
<p>需要注意的是这些都是一个独立的Linux进程</p>
</li>
<li><p><strong>Native系统服务</strong></p>
<p>运行在本地守护进程中,所属进程初始化的时候会将Native系统服务注册到ServiceManager中,方便我们通过Binder机制调用Native系统服务</p>
</li>
<li><p><strong>Java服务</strong></p>
<p>再创建本地服务的同时,init进程还会创建Zygote进程</p>
<p>Zygote也是Android中相当重要的一个进程了,Zygote进程会建立一个Dalvik VM并且启动</p>
<p>System Server系统服务</p>
<p>System Server将启动Android Service</p>
<blockquote>
<p>AccessibilityManagerService 截获用户输入，并根据输入给用户一些额外的反馈，起到辅助效果的服务<br>AccountManagerService 管理设备中所有账号的服务，包括账号、密码、授权管理功能<br>ActivityManagerService 管理所有组件的服务，安卓系统的核心服务 AlarmManagerService 管理闹钟的服务<br>AppWidgetService 管理APP widgets的工作，包括加载、删除、布局等<br>AssetAtlasService 将一些系统图片资源合并成一个纹理图传给GPU达到硬件加速的效果的服务<br>AudioService 管理音频的服务<br>BackupManagerService 管理备份和应用数据的服务<br>BatteryService 管理电池的服务<br>BluetoothManagerService 管理系统蓝牙的服务<br>CertBlacklister 更新系统SSL证书的公共秘钥和序列号黑名单的服务<br>ClipboardService 管理系统剪贴板的服务<br>CommonTimeManagementService 管理公共时间配置的服务<br>ConnectivityService 管理网络连接的服务<br>ContentService 管理系统数据更新通知的服务，和ContentProvider密切相关<br>CountryDetectorService 检测当前系统所属国家的服务<br>DevicePolicyManagerService 管理系统设备配置的服务<br>DeviceStorageMonitorService 管理系统存储空间的服务，当存储空间小于某个阈值时，会发出警告广播<br>DiskStateService 管理系统存储空间统计的服务<br>DisplayManagerService 管理显示设备的服务<br>DreamManagerService 管理屏幕保护的服务<br>DropBoxManagerService 生成和管理系统运行中日志文件的服务<br>EntropyMixer 加载和保存随机信息的服务<br>IdleMaintenanceService 管理系统在空闲时执行维护任务的服务<br>InputManagerService 管理触屏输入的服务<br>InputMethodManagerService 管理系统输入法的服务<br>LightsService 管理光传感器的服务<br>LocationManagerService 管理定位和位置的服务<br>LockSettingsService 管理系统锁屏设置的服务<br>MountService 管理系统存储设备挂载和卸载的服务<br>NetWorkManagementService 管理系统网络的服务<br>NetWorkPolicyManagerService 管理网络连接策略的服务<br>NetWorkStatsService 管理网络连接状态的服务<br>NetWorkTimeUpdateService 根据网络时间更新本地时间的服务<br>NotificationManagerService 管理系统通知的服务<br>PackageManagerService 管理应用包的服务<br>PowerManagerService 管理系统电源的服务<br>PrintManagerService 管理打印的服务<br>RecognitionManagerService 管理身份识别的服务<br>SamplingProfilerService 记录和分析系统启动性能的服务<br>SchedulingPolicyService 管理系统调度策略的服务<br>SearchManagerServcie 管理系统搜索功能的服务<br>SerialServie 管理系统串口设备的服务<br>StatusBarManagerService 管理系统状态栏的服务<br>TelephonyRegistry 监听和管理通话事件和状态的服务<br>TextServicesManagerService 文本拼写检查的服务<br>UiModeManagerService 设置和管理系统UI模式的服务<br>UsbService 管理USB连接的服务<br>UserManagerService 管理系统用户身份信息的服务<br>VibratorService 管理系统振动器的服务<br>ＷallpaperManagerService 管理系统桌面背景墙纸的服务<br>WifiP2pService 管理Wifi点对点连接的服务<br>WifiService 管理系统Wifi设备的服务<br>WindowManagerService 管理窗口的服务，安卓系统的核心服务</p>
</blockquote>
<p>这些服务都会注册到Service Manager中去,完成ServcieManager对服务的管理</p>
<p>需要注意的是,由System Server创建的这些服务,都是存在于System Server进程中的线程</p>
<p>举例说明一下</p>
<blockquote>
<p>servicemanager是init的子进程</p>
<p>Zygote是init的子进程，fork出来所有的虚拟机</p>
<p>system server是Zygote的子进程</p>
</blockquote>
</li>
</ol>
<ol>
<li><p><strong>Home启动</strong></p>
<p>当所有的任务启动后,会通过ActivityManager启动Home界面</p>
<p>同时发送ACTION_BOOT_COMPLETED广播</p>
</li>
</ol>
]]></content>
      
        <categories>
            
            <category> Source Code </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Source Code </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android通讯机制分析-Handler]]></title>
      <url>/Source-Code/Handler%E9%80%9A%E8%AE%AF%E6%9C%BA%E5%88%B6%E5%88%86%E6%9E%90/</url>
      <content type="html"><![CDATA[<p>Handler在Android世界中的地位不言而喻.这篇笔记算是简单的记录一下我对于Handler的理解.</p>
<p>当时第一次对Handler产生兴趣是我在知乎上看到一个问题:</p>
<p><strong>Android中为什么主线程不会因为Looper.loop()里的死循环卡死</strong></p>
<h4 id="Handler消息机制的构成"><a href="#Handler消息机制的构成" class="headerlink" title="Handler消息机制的构成"></a>Handler消息机制的构成</h4><ul>
<li><p>Handler</p>
<p>主要就是发送各种消息<code>sendMessage</code>等,以及处理消息<code>handleMessage</code></p>
</li>
<li><p>Message</p>
<p>即是传递消息的载体,有时候也会承载硬件发出的消息.</p>
</li>
<li><p>Looper</p>
<p>这是一个循环<code>Looper.loop</code>,并负责将消息发送给目标.</p>
</li>
<li><p>MessageQueue</p>
<p>消息队负责将消息发送都消息池以及在消息池中拿走消息</p>
<p>​</p>
</li>
</ul>
<p><img src="/images/handler_class.png" alt="handler"></p>
<h4 id="Message类分析"><a href="#Message类分析" class="headerlink" title="Message类分析"></a>Message类分析</h4><p>首先我们要看到</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">private static Message sPool;</span><br><span class="line"></span><br><span class="line">// sometimes we store linked lists of these things</span><br><span class="line">/*package*/ Message next;</span><br></pre></td></tr></table></figure>
<p><code>sPool</code>声明为static 也就是说所有的Message实例共享</p>
<p><code>next</code>则为每一个实例都有的</p>
<p>Message类中,一系列的obtain,如下:</p>
<p>obtain(Handler h)</p>
<p>obtain(Handler h, int what)</p>
<p>obtain(Handler h, Runnable callback)</p>
<p>…</p>
<p>obtain()</p>
<ul>
<li><p>复用机制</p>
<p>我们查看源码可知,他们最后都调用obtain()获得一个Message实体</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">android.os.Message#obtain()</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Return a new Message instance from the global pool. Allows us to</span></span><br><span class="line"><span class="comment">    * avoid allocating new objects in many cases.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Message <span class="title">obtain</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">           <span class="keyword">if</span> (sPool != <span class="keyword">null</span>) &#123;</span><br><span class="line">               Message m = sPool;</span><br><span class="line">               sPool = m.next;</span><br><span class="line">               m.next = <span class="keyword">null</span>;</span><br><span class="line">               m.flags = <span class="number">0</span>; <span class="comment">// clear in-use flag</span></span><br><span class="line">               sPoolSize--;</span><br><span class="line">               <span class="keyword">return</span> m;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> Message();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>可以看到,当<code>sPool</code>为<code>null</code>时才会<code>new Message();</code></p>
<p>如果不为<code>null</code>则把当前的<code>sPool</code>赋值给<code>Message m</code>  而后把<code>sPool</code>赋值为<code>m.next()</code>(也就是sPool没有赋值前它的下一个Message对象)</p>
<p>查看源码分析可知,有一个Message的消息池,采用的是单链表头插法,next永远指向的是下一个可复用的实例地址</p>
<p>所以,如果我们在代码中要使用Message实例,就尽量使用<code>obtain()</code>这一系列方法,而不要直接New</p>
<ul>
<li><p>加入消息池</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">android.os.Message#recycleUnchecked</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * Recycles a Message that may be in-use.</span></span><br><span class="line"><span class="comment">    * Used internally by the MessageQueue and Looper when disposing of queued Messages.</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">void</span> <span class="title">recycleUnchecked</span><span class="params">()</span> </span>&#123;</span><br><span class="line">       <span class="comment">// Mark the message as in use while it remains in the recycled object pool.</span></span><br><span class="line">       <span class="comment">// Clear out all other details.</span></span><br><span class="line">       flags = FLAG_IN_USE;</span><br><span class="line">       what = <span class="number">0</span>;</span><br><span class="line">       arg1 = <span class="number">0</span>;</span><br><span class="line">       arg2 = <span class="number">0</span>;</span><br><span class="line">       obj = <span class="keyword">null</span>;</span><br><span class="line">       replyTo = <span class="keyword">null</span>;</span><br><span class="line">       sendingUid = -<span class="number">1</span>;</span><br><span class="line">       when = <span class="number">0</span>;</span><br><span class="line">       target = <span class="keyword">null</span>;</span><br><span class="line">       callback = <span class="keyword">null</span>;</span><br><span class="line">       data = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">synchronized</span> (sPoolSync) &#123;</span><br><span class="line">           <span class="keyword">if</span> (sPoolSize &lt; MAX_POOL_SIZE) &#123;</span><br><span class="line">               next = sPool;</span><br><span class="line">               sPool = <span class="keyword">this</span>;</span><br><span class="line">               sPoolSize++;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>这里其实就是把无用的Message实例,加入消息池的地方.</p>
<p><code>sPoolSize &lt; MAX_POOL_SIZE</code>只要当前消息池没有到极限,就<code>next = sPool;</code>且<code>sPool = this;</code></p>
<p>可以简单理解为把之前的<code>sPool</code>可复用对象向后移动一位,把当前这个要回收的Message置为第一个可复用对象</p>
</li>
</ul>
<p><strong>所以,Message主要就是装载数据,并且实现了Message的复用机制</strong></p>
<h4 id="MessageQueue类分析"><a href="#MessageQueue类分析" class="headerlink" title="MessageQueue类分析"></a>MessageQueue类分析</h4>]]></content>
      
        <categories>
            
            <category> Source Code </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Handler </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[RelativeLayout中Button覆盖其他View]]></title>
      <url>/Bug/RelativeLayout%E4%B8%ADButton%E8%A6%86%E7%9B%96%E5%85%B6%E4%BB%96View/</url>
      <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>布局文件中,RelativeLayout包裹时,在RelativeLayout中的View,应该是”层层压上”的.</p>
<p>越往底下写的Viwe,在视图上越在上层.</p>
<h4 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h4><h5 id="activity-main-xml"><a href="#activity-main-xml" class="headerlink" title="activity_main.xml"></a><em>activity_main.xml</em></h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><br><span class="line">&lt;layout</span><br><span class="line">    xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;</span><br><span class="line">    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;</span><br><span class="line">    xmlns:tools=&quot;http://schemas.android.com/tools&quot;&gt;</span><br><span class="line">    &lt;data&gt;</span><br><span class="line">        &lt;variable</span><br><span class="line">            name=&quot;click&quot;</span><br><span class="line">            type=&quot;com.wangzhumo.app.single.MainActivity.ClickFunc&quot;/&gt;</span><br><span class="line">    &lt;/data&gt;</span><br><span class="line">    &lt;RelativeLayout</span><br><span class="line">        android:layout_width=&quot;match_parent&quot;</span><br><span class="line">        android:layout_height=&quot;match_parent&quot;</span><br><span class="line">        tools:context=&quot;com.wangzhumo.app.single.MainActivity&quot;&gt;</span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            android:layout_marginBottom=&quot;50dp&quot;</span><br><span class="line">            tools:background=&quot;@tools:sample/backgrounds/scenic&quot;/&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button_finsh&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_alignParentTop=&quot;true&quot;</span><br><span class="line">            android:layout_centerHorizontal=&quot;true&quot;</span><br><span class="line">            android:onClick=&quot;@&#123;(v) -&gt; click.onFinshAct(v)&#125;&quot;</span><br><span class="line">            android:text=&quot;Finsh&quot; /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button_dis&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_alignParentEnd=&quot;true&quot;</span><br><span class="line">            android:layout_alignParentTop=&quot;true&quot;</span><br><span class="line">            android:onClick=&quot;@&#123;(v) -&gt; click.onStartAct(v)&#125;&quot;</span><br><span class="line">            android:text=&quot;Start&quot;</span><br><span class="line">            tools:ignore=&quot;MissingConstraints&quot;</span><br><span class="line">            tools:layout_editor_absoluteX=&quot;88dp&quot;</span><br><span class="line">            tools:layout_editor_absoluteY=&quot;0dp&quot; /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button_start&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:onClick=&quot;@&#123;(v) -&gt; click.onShowDialog(v)&#125;&quot;</span><br><span class="line">            android:text=&quot;Dialog&quot;</span><br><span class="line">            tools:ignore=&quot;MissingConstraints&quot;</span><br><span class="line">            tools:layout_editor_absoluteX=&quot;176dp&quot;</span><br><span class="line">            tools:layout_editor_absoluteY=&quot;0dp&quot; /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button2&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_alignParentStart=&quot;true&quot;</span><br><span class="line">            android:onClick=&quot;@&#123;(v) -&gt; click.onPxActivity(v)&#125;&quot;</span><br><span class="line">            android:layout_below=&quot;@+id/button_start&quot;</span><br><span class="line">            android:layout_marginTop=&quot;22dp&quot;</span><br><span class="line">            android:text=&quot;Pixe&quot; /&gt;</span><br><span class="line">        &lt;Button</span><br><span class="line">            android:id=&quot;@+id/button3&quot;</span><br><span class="line">            android:layout_width=&quot;wrap_content&quot;</span><br><span class="line">            android:layout_height=&quot;wrap_content&quot;</span><br><span class="line">            android:onClick=&quot;@&#123;(v) -&gt; click.onTralActivity(v)&#125;&quot;</span><br><span class="line">            android:layout_alignStart=&quot;@+id/button_finsh&quot;</span><br><span class="line">            android:layout_alignTop=&quot;@+id/button2&quot;</span><br><span class="line">            android:text=&quot;Tranl&quot;</span><br><span class="line">            tools:text=&quot;@tools:sample/lorem/random&quot;/&gt;</span><br><span class="line">        &lt;ImageView</span><br><span class="line">            android:layout_marginBottom=&quot;100dp&quot;</span><br><span class="line">            android:layout_width=&quot;match_parent&quot;</span><br><span class="line">            android:layout_height=&quot;match_parent&quot;</span><br><span class="line">            tools:background=&quot;@tools:sample/backgrounds/scenic&quot;/&gt;</span><br><span class="line">    &lt;/RelativeLayout&gt;</span><br><span class="line">&lt;/layout&gt;</span><br></pre></td></tr></table></figure>
<h5 id="View的结构如下"><a href="#View的结构如下" class="headerlink" title="View的结构如下:"></a>View的结构如下:</h5><p><img src="/images/button_tree.png" alt="tree"></p>
<h5 id="然而实际效果如下"><a href="#然而实际效果如下" class="headerlink" title="然而实际效果如下:"></a>然而实际效果如下:</h5><p><img src="/images/button_show.png" alt="views"></p>
<h5 id="分析如下"><a href="#分析如下" class="headerlink" title="分析如下:"></a>分析如下:</h5><p>造成这样效果,是Button的原因</p>
<p>分析:整个页面除了 2,3,4,5 这5个Button之外,其他的View都依旧遵循RelativeLayout的规则</p>
<h4 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h4><p>在stackoverflow上我找到了Button造成这个效果的原因</p>
<blockquote>
<p><a href="https://stackoverflow.com/questions/27080338/android-5-0-androidelevation-works-for-view-but-not-button/27112143#27112143" target="_blank" rel="noopener">https://stackoverflow.com/questions/27080338/android-5-0-androidelevation-works-for-view-but-not-button/27112143#27112143</a></p>
</blockquote>
<p>是因为Android5.0之后,Button默认添加了<a href="https://developer.android.com/reference/android/animation/StateListAnimator.html" target="_blank" rel="noopener">StateListAnimator</a>,具体就是对</p>
<p> <code>android:elevation</code> </p>
<p> <code>android:translationZ</code> </p>
<p>两个属性进行了修改,我们如何去掉这个默认的效果那?</p>
<p>##### </p>
<p><strong>android:stateListAnimator设置为null即可</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    ...</span><br><span class="line">    android:stateListAnimator=&quot;@null&quot; /&gt;</span><br></pre></td></tr></table></figure>
<p>如果你需要添加stateListAnimator效果的话</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;Button</span><br><span class="line">    ...</span><br><span class="line">    android:stateListAnimator=&quot;@anim/you_animator&quot; /&gt;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Bug </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Bug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[ConfigChanges的属性值]]></title>
      <url>/Android/ConfigChanges%E7%9A%84%E5%B1%9E%E6%80%A7%E5%80%BC/</url>
      <content type="html"><![CDATA[<p><strong>通过设置这个属性可以使Activity捕捉设备状态变化</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;mcc&quot; 国际移动用户识别码所属国家代号是改变了----- sim被侦测到了，去更新mcc mcc是移动用户所属国家代号</span><br><span class="line">&quot;mnc&quot; 国际移动用户识别码的移动网号码是改变了------ sim被侦测到了，去更新mnc MNC是移动网号码，最多由两位数字组成，用于识别移动用户所归属的移动通信网</span><br><span class="line">&quot;locale&quot; 地址改变了-----用户选择了一个新的语言会显示出来</span><br><span class="line">&quot;touchscreen&quot; 触摸屏是改变了------通常是不会发生的</span><br><span class="line">&quot;keyboard&quot; 键盘发生了改变----例如用户用了外部的键盘</span><br><span class="line">&quot;keyboardHidden&quot; 键盘的可用性发生了改变</span><br><span class="line">&quot;navigation&quot; 导航发生了变化-----通常也不会发生</span><br><span class="line">&quot;screenLayout&quot; 屏幕的显示发生了变化------不同的显示被激活</span><br><span class="line">&quot;fontScale&quot; 字体比例发生了变化----选择了不同的全局字体</span><br><span class="line">&quot;uiMode&quot; 用户的模式发生了变化</span><br><span class="line">&quot;orientation&quot; 屏幕方向改变了</span><br><span class="line">&quot;screenSize&quot; 屏幕大小改变了</span><br><span class="line">&quot;smallestScreenSize&quot; 屏幕的物理大小改变了，如：连接到一个外部的屏幕上</span><br></pre></td></tr></table></figure>
<blockquote>
<p><a href="http://www.cnblogs.com/carlo/p/4311010.html" target="_blank" rel="noopener">http://www.cnblogs.com/carlo/p/4311010.html</a></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Activity与Fragment的生命周期]]></title>
      <url>/Android/Activity%E4%B8%8EFragment%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      <content type="html"><![CDATA[<h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>做Android开发好些年了,这些基础的知识,完完整整的在博客上写一次.</p>
<h4 id="Activity生命周期"><a href="#Activity生命周期" class="headerlink" title="Activity生命周期"></a>Activity生命周期</h4><p>必不可少的一张图,来自Google Android developer 的文档上</p>
<p><img src="/images/activity_lifecycle.png" alt="activity_liferycle"></p>
<h5 id="回调方法简述"><a href="#回调方法简述" class="headerlink" title="回调方法简述"></a>回调方法简述</h5><ul>
<li><p>onCreate()  </p>
<p>当Activity创建时,会回调该方法,常用于初始化View 或其他的一些功能的初始化</p>
</li>
<li><p>onStart()</p>
<p>Activity已经初始化完毕,此时的页面是可见状态,则回调onStart();方法</p>
<p>Activity启动：onCreate() -&gt; onStart() -&gt; onResume()</p>
</li>
<li><p>onResume()</p>
<p>当Activity可见,并且获得焦点,可以与用户交互时回调</p>
<p>在我们处理一些视屏操作,或者是Fragment懒加载等都可以用到</p>
</li>
<li><p>onPause()</p>
<p>当调用onPause()时,说明Activity被阻挡,部分UI已经不可见了,但是Activity的UI并没有完全消失.</p>
</li>
<li><p>onStop()</p>
<p>当Activity完全不可见,且到了后台之后,如果系统内存不足,系统可能会杀死当前Activity</p>
<p>在这个方法中可以取消一些动画效果等</p>
</li>
<li><p>onDestory()</p>
<p>Activity退出,销毁</p>
<p>常用于销毁,回收资源</p>
</li>
</ul>
<h5 id="经典场景"><a href="#经典场景" class="headerlink" title="经典场景"></a>经典场景</h5><p>1.正常启动</p>
<p>系统调用onCreate方法 , 然后调用onStart() , 最后调用 onResume() ,用户可操作.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onCreate ----</span><br><span class="line">E/MainActivity: ---- onStart ----</span><br><span class="line">E/MainActivity: ---- onResume ----</span><br></pre></td></tr></table></figure>
<p>2.正常退出</p>
<p>Activity先失去焦点不可交互</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onPause ----</span><br><span class="line">E/MainActivity: ---- onStop ----</span><br><span class="line">E/MainActivity: ---- onDestroy ----</span><br></pre></td></tr></table></figure>
<p>2.弹出Dialog</p>
<p>MainActivity什么log也没有打印,说明不对Activity造成影响</p>
<p>3.跳转一个透明的Activity页面(1像素的同理)</p>
<p>MainActivity只调用了onPause()  因为MainActivity的UI被遮挡了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onPause ----</span><br></pre></td></tr></table></figure>
<p>4.从被遮挡状态恢复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onResume ----</span><br></pre></td></tr></table></figure>
<p>6.锁屏</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onPause ----</span><br><span class="line">E/MainActivity: ---- onStop ----</span><br></pre></td></tr></table></figure>
<p>此时,MainActivity已经在后台了.</p>
<p>7.从锁屏恢复</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onStart ----</span><br><span class="line">E/MainActivity: ---- onResume ----</span><br></pre></td></tr></table></figure>
<p>可以发现,不仅仅走了onResume() ,还走了一次onStart()</p>
<p>8.横竖屏切换</p>
<ul>
<li><p>正常切换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">E/MainActivity: ---- onPause ----</span><br><span class="line">E/MainActivity: ---- onStop ----</span><br><span class="line">E/MainActivity: ---- onDestroy ----</span><br><span class="line"></span><br><span class="line">E/MainActivity: ---- onCreate ----</span><br><span class="line">E/MainActivity: ---- onStart ----</span><br><span class="line">E/MainActivity: ---- onResume ----</span><br><span class="line"></span><br><span class="line">如果你什么都不设置,直接切换是这样的.</span><br></pre></td></tr></table></figure>
</li>
<li><p>保留Activity的切换</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">我在manifest.xml文件中,添加了</span><br><span class="line"></span><br><span class="line">&lt;activity</span><br><span class="line">	android:name=&quot;.MainActivity&quot;</span><br><span class="line">	android:configChanges=&quot;orientation|screenSize&quot;&gt;</span><br><span class="line">	&lt;intent-filter&gt;</span><br><span class="line">		&lt;action android:name=&quot;android.intent.action.MAIN&quot; /&gt;</span><br><span class="line">	&lt;category android:name=&quot;android.intent.category.LAUNCHER&quot; /&gt;</span><br><span class="line">&lt;/intent-filter&gt;</span><br><span class="line">&lt;/activity&gt;</span><br></pre></td></tr></table></figure>
<p>此时:</p>
<p>Activity不会被销毁,从而重新创建,而是调用onConfigurationChanged</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">  public void onConfigurationChanged(Configuration newConfig) &#123;</span><br><span class="line">     super.onConfigurationChanged(newConfig);</span><br><span class="line">     //do somethings</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="Fragment生命周期"><a href="#Fragment生命周期" class="headerlink" title="Fragment生命周期"></a>Fragment生命周期</h4><p>惯例,如图:</p>
<p><img src="/images/fragment_lifercycle.png" alt="fragment_lifecycle"></p>
<h5 id="回调方法简述-1"><a href="#回调方法简述-1" class="headerlink" title="回调方法简述"></a>回调方法简述</h5><p>其中onAttach()  onCreateView() onActivityCreated()  onDestroy() onDetach() 和Activity的不一致</p>
<ul>
<li><p>onAttach()</p>
<p>Fragment与它所依赖的Activity建立关联</p>
</li>
<li><p>onCreateView()</p>
<p>这里是给Fragment创建视图用的,在onCreate()中初始化Fragment,但是视图等还是没有加载上去的</p>
</li>
<li><p>onActivityCreated()</p>
<p>如果调用该方法,说明Fragment依赖的Activity中onCreate()已经执行完毕</p>
</li>
<li><p>onDestroyView()</p>
<p>Fragment中的布局销毁,移除</p>
<p>要注意的是,此时Fragment与它所依赖的Activity还是关联的</p>
</li>
<li><p>onDestroy()</p>
<p>此时,Fragment被销毁</p>
</li>
<li><p>onDetach()</p>
<p>解除与Activity的关联</p>
</li>
</ul>
<p>PS: Fragment中的onResume()并不十分准确,所以如果要做懒加载,要判断fragment不能使用onResume判断</p>
<h5 id="经典场景-1"><a href="#经典场景-1" class="headerlink" title="经典场景"></a>经典场景</h5><p>1.正常启动</p>
<p>真的是超级多啊</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onAttach ----   			关联Activity</span><br><span class="line">E/BlankFragment: ---- onCreate ----    			Fragment初始化</span><br><span class="line">E/BlankFragment: ---- onCreateView ----			创建Fragment的布局</span><br><span class="line">E/BlankFragment: ---- onViewCreated ----		onCreateView执行完后被触发</span><br><span class="line">E/BlankFragment: ---- onActivityCreated ----	关联的Activity OnCreate()执行完毕后触发</span><br><span class="line">E/BlankFragment: ---- onStart ----				Fragment可见</span><br><span class="line">E/BlankFragment: ---- onResume ----				Fragment可交互,一般不使用它来判断</span><br></pre></td></tr></table></figure>
<p>2.正常退出(或者是它关联的Activity被销毁了)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onPause ----</span><br><span class="line">E/BlankFragment: ---- onStop ----</span><br><span class="line">E/BlankFragment: ---- onDestroyView ----</span><br><span class="line">E/BlankFragment: ---- onDestroy ----</span><br><span class="line">E/BlankFragment: ---- onDetach ----</span><br></pre></td></tr></table></figure>
<p>3.进入后台</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onPause ----</span><br><span class="line">E/BlankFragment: ---- onStop ----</span><br></pre></td></tr></table></figure>
<p>4.从锁屏到解锁</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onPause ----</span><br><span class="line">E/BlankFragment: ---- onSaveInstanceState ----</span><br><span class="line">E/BlankFragment: ---- onStop ----</span><br><span class="line"></span><br><span class="line">E/BlankFragment: ---- onStart ----</span><br><span class="line">E/BlankFragment: ---- onResume ----</span><br></pre></td></tr></table></figure>
<p>5.切换到OtherFragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onPause ----</span><br><span class="line">E/BlankFragment: ---- onStop ----</span><br><span class="line">E/BlankFragment: ---- onDestroyView ----</span><br></pre></td></tr></table></figure>
<p>6.从OtherFragment切换回本Fragment</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">E/BlankFragment: ---- onCreateView ----</span><br><span class="line">E/BlankFragment: ---- onActivityCreated ----</span><br><span class="line">E/BlankFragment: ---- onStart ----   </span><br><span class="line">E/BlankFragment: ---- onResume ----</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Fragment </tag>
            
            <tag> Activity </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 单元测试(二)]]></title>
      <url>/Android-Test/Android-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-%E4%BA%8C/</url>
      <content type="html"><![CDATA[<p>后补.</p>
]]></content>
      
        <categories>
            
            <category> Android Test </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android单元测试 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Flutter安装指南MAC版]]></title>
      <url>/Flutter/Flutter%E5%AE%89%E8%A3%85%E6%8C%87%E5%8D%97MAC%E7%89%88/</url>
      <content type="html"><![CDATA[<h4 id="下载Flutter-SDK"><a href="#下载Flutter-SDK" class="headerlink" title="下载Flutter SDK"></a>下载Flutter SDK</h4><h5 id="使用Git安装"><a href="#使用Git安装" class="headerlink" title="使用Git安装"></a>使用Git安装</h5><p>如果已经下载过flutter的,切换到flutter目录去直接</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">git checkout beta</span><br><span class="line">git pull</span><br><span class="line">//可能会失败,因为这个目录中可能有修改过,要目放弃修改,要么暂存均可</span><br><span class="line"></span><br><span class="line">(如果失败,这里选择了暂存) -- Start</span><br><span class="line">git checkout beta</span><br><span class="line">git stash</span><br><span class="line">git pull</span><br><span class="line">(如果失败,这里选择了暂存)  -- End</span><br></pre></td></tr></table></figure>
<p>未下载过,第一次安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//克隆flutter的beta分支</span><br><span class="line">git clone -b beta https://github.com/flutter/flutter.git</span><br></pre></td></tr></table></figure>
<h5 id="配置”环境变量”"><a href="#配置”环境变量”" class="headerlink" title="配置”环境变量”"></a>配置”环境变量”</h5><p>熟悉命令的自己搞一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//把         安装目录/flutter/bin</span><br><span class="line">export PATH=`pwd`/flutter/bin:$PATH</span><br></pre></td></tr></table></figure>
<p>不熟悉的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">~ ⌚ 0:01:37</span><br><span class="line">$ vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line">//会进入vim编辑,如下配置即可</span><br><span class="line">export FLUTTER_HOME=/Users/phyooos/develop/flutter</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:$FLUTTER_HOME/bin:</span><br></pre></td></tr></table></figure>
<p>不会的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">open ~/.bash_profile</span><br><span class="line"></span><br><span class="line">//编辑器,总可以了吧,如下配置即可</span><br><span class="line">export FLUTTER_HOME=/Users/phyooos/develop/flutter</span><br><span class="line"></span><br><span class="line">export PATH=$PATH:$FLUTTER_HOME/bin:</span><br></pre></td></tr></table></figure>
<p>放一下我自己的配置:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">export JAVA_HOME=/Library/Java/JavaVirtualMachines/jdk1.8.0/Contents/Home</span><br><span class="line">export ANDROID_HOME=/Users/phyooos/Library/Android/sdk</span><br><span class="line">export TOMCAT_HOME=/Users/phyooos/develop/apache-tomcat-7.0.77</span><br><span class="line">export GRADLE_USER_HOME=/Users/phyooos/develop/gradle</span><br><span class="line">export MYSQL_HOME=/usr/local/mysql-5.7.18-macos10.12-x86_64</span><br><span class="line">export GOROOT=/usr/local/go</span><br><span class="line">export GOPATH=/Users/phyooos/develop/workspace</span><br><span class="line">export GOBIN=$GOPATH/bin</span><br><span class="line">export SCALA_HOME=/Users/phyooos/develop/scala-2.11.8</span><br><span class="line">export MAVEN_HOME=/Users/phyooos/develop/apache-maven-3.5.0</span><br><span class="line">export FLUTTER_HOME=/Users/phyooos/develop/flutter</span><br><span class="line">export PATH=/usr/local/Cellar/git/2.15.0/bin:$PATH:$JAVA_HOME/bin:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools:$TOMCAT_HOME/bin:$GRADLE_HOME/bin:$MYSQL_HOME/bin:$GOROOT/bin:$GOPATH:$GOBIN:$GOPATH/bin:$FLUTTER_HOME/bin:$MAVEN_HOME/bin:$SCALA_HOME/bin</span><br></pre></td></tr></table></figure>
<h4 id="安装Flutter"><a href="#安装Flutter" class="headerlink" title="安装Flutter"></a>安装Flutter</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">flutter doctor</span><br></pre></td></tr></table></figure>
<blockquote>
<p>这里要注意的是,这个配置需要”良好的网络环境”,最好翻墙下载为妙,但是<strong>终端不走代理</strong></p>
<p>所以,需要手动给终端配置一下,请看我另一篇文章</p>
<p><a href="http://www.wangzhumo.com/Flutter/Flutter-%E5%AE%89%E8%A3%85/">Flutter 安装</a></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Flutter </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Google </tag>
            
            <tag> Flutter </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 单元测试(一)]]></title>
      <url>/Android-Test/Android-%E5%8D%95%E5%85%83%E6%B5%8B%E8%AF%95-%E4%B8%80/</url>
      <content type="html"><![CDATA[<h4 id="初识单元测试"><a href="#初识单元测试" class="headerlink" title="初识单元测试"></a>初识单元测试</h4><p>当项目越来越大的时候,打包 &gt; 测试 &gt; 改代码 &gt; 打包 &gt; 测试 ….这样的流程既费时也费力.</p>
<p>所以,了解一下单元测试,看看是否能够解决这个问题.</p>
<p>(平时太懒了,就没正经的了解过Android这边的单元测试,没有一个确切的概念)</p>
<p>那么,我学习单元测试的原因竟然是 <strong>因为我懒</strong></p>
<p>当我们建立一个项目的时候,Android Studio总会去自动导入一个包</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">testImplementation &apos;junit:junit:4.12&apos;</span><br></pre></td></tr></table></figure>
<p>这个就是传说中的   Junit 了,这玩意针对Java的,所以不涉及到Android部分的测试可以使用</p>
<p>跟着介绍也打了一个例子:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//在commonlib中写了一个Calculator,里面简单的加法</span></span><br><span class="line"><span class="keyword">package</span> com.wangzhumo.app.commonlib.utils;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Calculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> a,<span class="keyword">int</span> b)</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a + b;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">verity</span><span class="params">(String phone)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (phone == <span class="keyword">null</span> || phone.isEmpty()) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"phone cannot be empty"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> phone;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//在主项目中</span></span><br><span class="line"><span class="comment">//test目录下</span></span><br><span class="line"><span class="keyword">package</span> com.wangzhumo.app.test;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CalculatorTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    Calculator calculator;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initCalculator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        calculator = <span class="keyword">new</span> Calculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculator</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = calculator.add(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">        Assert.assertEquals(<span class="number">6</span>,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 加入提示信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testCalculatorWithMessage</span><span class="params">()</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        <span class="keyword">int</span> sum = calculator.add(<span class="number">1</span>,<span class="number">5</span>);</span><br><span class="line">        <span class="comment">//assertEquals 方法前面加一个 string 当抛出异常的时候会输出这个message</span></span><br><span class="line">        <span class="comment">//可以让我们更清楚的明白是什么问题</span></span><br><span class="line">        Assert.assertEquals(<span class="string">"你的数学太烂了"</span>,<span class="number">5</span>,sum);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果抛出IllegalArgumentException异常才算通过</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span>(expected = IllegalArgumentException.class)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testVerity</span><span class="params">()</span></span>&#123;</span><br><span class="line">        calculator.verity(<span class="string">""</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>然后选中方法直接执行比如 : testCalculatorWithMessage()</p>
<p>选中Run ‘testCalculatorWithMessage()’ 就可以看到输出 (控制台中  Run 面板)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">java.lang.AssertionError: 你的数学太烂了 </span><br><span class="line">Expected :5</span><br><span class="line">Actual   :6</span><br><span class="line"> &lt;Click to see difference&gt;</span><br></pre></td></tr></table></figure>
<h4 id="Android-中的单元测试"><a href="#Android-中的单元测试" class="headerlink" title="Android 中的单元测试"></a>Android 中的单元测试</h4><p>上面简单的使用 Junit 就可以测试Java中的方法,但是与我的需求并不符合,所以继续看</p>
<p>使用<strong>robolectric</strong></p>
<blockquote>
<p><a href="https://github.com/robolectric/robolectric" target="_blank" rel="noopener">https://github.com/robolectric/robolectric</a></p>
<p><a href="http://robolectric.org/" target="_blank" rel="noopener">http://robolectric.org</a></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Android Test </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android单元测试 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio 中使用tools:sample]]></title>
      <url>/Android-Studio/Android-Studio-%E4%B8%AD%E4%BD%BF%E7%94%A8tools-sample/</url>
      <content type="html"><![CDATA[<blockquote>
<p>Google 官方文档</p>
<p><a href="https://developer.android.com/studio/write/tool-attributes.html#toolssample_resources" target="_blank" rel="noopener">https://developer.android.com/studio/write/tool-attributes.html#toolssample_resources</a></p>
</blockquote>
<p>他所能达到的效果就是,提供给你一些数据,并直接在 Preview 或者 Design面板中查看样式</p>
<h4 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h4><p>不如放一个图来的直观</p>
<p>item中使用 sample资源</p>
<p><img src="/images/tools_item.png" alt="item"></p>
<p>将item加入到list中查看效果</p>
<p><img src="/images/tools_list.png" alt="list"></p>
<h4 id="准备使用tools"><a href="#准备使用tools" class="headerlink" title="准备使用tools"></a>准备使用tools</h4><h5 id="Android-Studio"><a href="#Android-Studio" class="headerlink" title="Android Studio"></a>Android Studio</h5><p>注意要使用Android Studio 3.0 + 的版本</p>
<h5 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h5><p><code>xmlns:tools=&quot;http://schemas.android.com/tools&quot;</code></p>
<p>然后就可以使用tools的相关属性了</p>
<p>在google文档中我们可以看到有很多其他可用的,具体使用效果请自行查阅文档.</p>
<p>如:</p>
<p><strong>context</strong>   <strong>showIn</strong>  <strong>layout</strong>   <strong>listitem</strong>   <strong>layoutManager</strong>     <strong>itemCount</strong></p>
<p>使用方式为:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">layout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:tools</span>=<span class="string">"http://schemas.android.com/tools"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">tools:context</span>=<span class="string">"com.wangzhumo.app.tips.page.NearbyFragment"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">com.jcodecraeer.xrecyclerview.XRecyclerView</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/recycleview"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:layoutManager</span>=<span class="string">"GridLayoutManager"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:itemCount</span>=<span class="string">"5"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:spanCount</span>=<span class="string">"2"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">tools:listitem</span>=<span class="string">"@layout/nearby_list_item"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">com.jcodecraeer.xrecyclerview.XRecyclerView</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h4 id="可用资源"><a href="#可用资源" class="headerlink" title="可用资源"></a>可用资源</h4><h5 id="google已提供的资源"><a href="#google已提供的资源" class="headerlink" title="google已提供的资源"></a>google已提供的资源</h5><p><img src="/images/tools_google.png" alt="google"></p>
<p>这些资源可以在xml中直接使用,也可以在自定义的资源中使用</p>
<p>使用方式为:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 这里面的资源在</span></span><br><span class="line"><span class="comment">Android Studio/Applications/Android Studio.app/Contents/plugins/android/lib/sampleData/backgrounds/scenic--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:src</span>=<span class="string">"@tools:sample/backgrounds/scenic"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">ImageView</span>&gt;</span>    </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 这个是一段假文章 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">...</span>      </span></span><br><span class="line"><span class="tag">    <span class="attr">tools:text</span>=<span class="string">"@tools:sample/lorem/random"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">TextView</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h5 id="自定义的资源"><a href="#自定义的资源" class="headerlink" title="自定义的资源"></a>自定义的资源</h5><p><img src="/images/tools_new.png" alt="new"></p>
<p>创建一个 sampledata 文件夹</p>
<p><img src="/images/tools_files.png" alt="file"></p>
<ul>
<li><p><code>sampledata/images</code> 文件中都是些图片资源</p>
</li>
<li><p><code>description</code>文件中是描述性文字, 注意<strong>每一行为一项个元素</strong></p>
</li>
<li><p><code>hotels</code> 也是一些文字,不过是一些酒店名字</p>
</li>
<li><p><code>hotel.json</code></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"data"</span>:[</span><br><span class="line">    &#123;  </span><br><span class="line">      "name":"@sample/hotels",    //这里使用的是自己定义的  hotels 文件中的字段</span><br><span class="line">      "img":"@tools:sample/backgrounds/scenic",</span><br><span class="line">      "desc":"@sample/description"   //这里使用的是自己定义的  description 文件中的字段</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>:<span class="string">"@sample/hotels"</span>,</span><br><span class="line">      "img":"@tools:sample/backgrounds/scenic",  //这里的就是自带的资源了</span><br><span class="line">      "desc":"@sample/description"</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>:<span class="string">"@sample/hotels"</span>,</span><br><span class="line">      "img":"@sample/images",  //这种就是/images 文件中的资源</span><br><span class="line">      "desc":"@sample/description"</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>:<span class="string">"@sample/hotels"</span>,</span><br><span class="line">      <span class="attr">"img"</span>:<span class="string">"@tools:sample/backgrounds/scenic"</span>,</span><br><span class="line">      <span class="attr">"desc"</span>:<span class="string">"@sample/description"</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">"name"</span>:<span class="string">"@sample/hotels"</span>,</span><br><span class="line">      <span class="attr">"img"</span>:<span class="string">"@tools:sample/backgrounds/scenic"</span>,</span><br><span class="line">      <span class="attr">"desc"</span>:<span class="string">"@sample/description"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>使用方式为:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">	<span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:text</span>=<span class="string">"@sample/hotels"</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">ImageView</span></span></span><br><span class="line"><span class="tag">	<span class="attr">...</span></span></span><br><span class="line"><span class="tag">    <span class="attr">tools:src</span>=<span class="string">"@sample/images"</span>/&gt;</span></span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android Studio </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Studio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目中使用Timber + Logger日志输出]]></title>
      <url>/Android/Android%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8Timber-Logger%E6%97%A5%E5%BF%97%E8%BE%93%E5%87%BA/</url>
      <content type="html"><![CDATA[<p>不啰嗦了,直接开始.</p>
<h4 id="添加依赖"><a href="#添加依赖" class="headerlink" title="添加依赖"></a>添加依赖</h4><blockquote>
<p>Logger   <a href="https://github.com/orhanobut/logger" target="_blank" rel="noopener">orhanobut/Logger</a></p>
<p>Timber  <a href="https://github.com/JakeWharton/timber" target="_blank" rel="noopener">JakeWharton/timber</a></p>
</blockquote>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//logger</span></span><br><span class="line">implementation <span class="string">'com.orhanobut:logger:2.1.1'</span></span><br><span class="line"><span class="comment">//timber</span></span><br><span class="line">implementation <span class="string">'com.jakewharton.timber:timber:4.6.0'</span></span><br></pre></td></tr></table></figure>
<h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><p>我放在了我的Application.java中初始化的</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 初始化Timber</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">   <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">initTimber</span><span class="params">()</span> </span>&#123;</span><br><span class="line">     	<span class="comment">//配置Logger</span></span><br><span class="line">       FormatStrategy formatStrategy = PrettyFormatStrategy.newBuilder()</span><br><span class="line">               .showThreadInfo(<span class="keyword">true</span>)   </span><br><span class="line">               .methodCount(<span class="number">2</span>)</span><br><span class="line">               .methodOffset(<span class="number">7</span>)</span><br><span class="line">               .tag(<span class="string">"MY_LOG"</span>)</span><br><span class="line">               .build();</span><br><span class="line">     	<span class="comment">//配置Logger在Debug时不打印</span></span><br><span class="line">       Logger.addLogAdapter(<span class="keyword">new</span> AndroidLogAdapter(formatStrategy)&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isLoggable</span><span class="params">(<span class="keyword">int</span> priority, String tag)</span> </span>&#123;</span><br><span class="line">               <span class="keyword">return</span> BuildConfig.DEBUG;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">     	<span class="comment">//给Timber一个树...大神这么打比喻的 😆</span></span><br><span class="line">       Timber.plant(<span class="keyword">new</span> Timber.DebugTree()&#123;</span><br><span class="line">           <span class="meta">@Override</span></span><br><span class="line">           <span class="function"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title">log</span><span class="params">(<span class="keyword">int</span> priority, String tag, </span></span></span><br><span class="line"><span class="function"><span class="params">                              @NotNull String message, Throwable t)</span> </span>&#123;</span><br><span class="line">               Logger.log(priority,tag,message,t);</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><img src="https://github.com/orhanobut/logger/blob/master/art/logger_output.png" alt="logger"></p>
<p>其中:</p>
<p><code>showThreadInfo(true)</code>  是否显示ThreadInfo</p>
<p><code>methodCount(2)</code>        日志输出时显示几行</p>
<p><code>methodOffset(7)</code>      方法偏移量,默认是5,这个自己调大,调小看看就明白了</p>
<p><code>tag(&quot;MY_LOG&quot;)</code>          自定义的Tag,默认值是PRETTY_LOGGER</p>
<h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Timber.e(<span class="string">"下载状态发生改变 = %s"</span>, downLoadInfo.status )</span><br><span class="line">Timber.e(<span class="string">"下载进度 = %d"</span>, mBindingView.progressBar.progress )</span><br></pre></td></tr></table></figure>
<p>logger负责生成message的方法</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> String <span class="title">createMessage</span><span class="params">(String message, Object... args)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> args == <span class="keyword">null</span> || args.length == <span class="number">0</span> ? message : String.format(message, args);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>String.format(message, args)</code>这就赋予了我们在写信息的时候使用占位符.记得要符合format的格式哦</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><p>其实按我现在的需求,Logger完全符合我,为什么加上Timber那?</p>
<p>Timber可以做到分发,到时候我可以加上 DiskFileTree  …  什么的,方便后期有变化的时候修改</p>
<p>然而,我在Logger里发现了一个类</p>
<p><code>com.orhanobut.logger.DiskLogAdapter</code></p>
<p>原来它已经支持写到本地了.. 宝宝心里苦</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Jenkins搭建Android自动打包]]></title>
      <url>/Android/Jenkins%E6%90%AD%E5%BB%BAAndroid%E8%87%AA%E5%8A%A8%E6%89%93%E5%8C%85/</url>
      <content type="html"><![CDATA[<h4 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h4><ul>
<li><p>Jenkins的下载与安装</p>
<p><strong>下载</strong></p>
<blockquote>
<p> <a href="https://jenkins.io/download/" target="_blank" rel="noopener">https://jenkins.io/download/</a></p>
<p> 下载war包</p>
<p> <a href="http://mirrors.jenkins.io/war-stable/latest/jenkins.war" target="_blank" rel="noopener">Generic Java package (.war)</a></p>
</blockquote>
<p>因为打算使用Tomcat来部署,所以需要下载war包,也可以直接下对应版本的安装文件,直接安装</p>
</li>
</ul>
<p>​    <strong>安装</strong></p>
<p>​    war包放到<code>./apache-tomcat-7.0.77/webapps</code>    </p>
<p>​    Tomcat的wabapps包下即可</p>
<ul>
<li><p>Tomcat (略)</p>
<p>记得配置一下环境变量,等会方便启动</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">export TOMCAT_HOME=/Users/phyooos/develop/apache-tomcat-7.0.77</span><br><span class="line"></span><br><span class="line">export PATH.....:$TOMCAT/bin</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="初始化Jenkins"><a href="#初始化Jenkins" class="headerlink" title="初始化Jenkins"></a>初始化Jenkins</h4><ul>
<li><p>启动Jenkins,即启动tomcat</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> startup.sh</span><br><span class="line">Using CATALINA_BASE:   /Users/phyooos/develop/apache-tomcat-7.0.77</span><br><span class="line">Using CATALINA_HOME:   /Users/phyooos/develop/apache-tomcat-7.0.77</span><br><span class="line">Using CATALINA_TMPDIR: /Users/phyooos/develop/apache-tomcat-7.0.77/temp</span><br><span class="line">Using JRE_HOME:        /Library/Java/JavaVirtualMachines/jdk1.8.0/Contents/Home</span><br><span class="line">Using CLASSPATH:       /Users/phyooos/develop/apache-tomcat-7.0.77/bin/bootstrap.jar:/Users/phyooos/develop/apache-tomcat-7.0.77/bin/tomcat-juli.jar</span><br><span class="line">Tomcat started.</span><br></pre></td></tr></table></figure>
<p>看到这个就说明,已经正常启动</p>
</li>
<li><p>访问<a href="http://localhost:8080/jenkins/" target="_blank" rel="noopener">http://localhost:8080/jenkins/</a></p>
<p>打开后需要输入一个密钥,mac的在<code>jenkins/secrets/initialAdminPassword</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ ⌚ 10:11:03</span><br><span class="line"><span class="meta">$</span> cat ~/.jenkins/secrets/initialAdminPassword</span><br><span class="line">55ad44431f6d4ebdb53a7c1971d12df4</span><br></pre></td></tr></table></figure>
<p>输入此密钥即可.</p>
</li>
<li><p>创建用户</p>
</li>
</ul>
<h4 id="配置Jenkins"><a href="#配置Jenkins" class="headerlink" title="配置Jenkins"></a>配置Jenkins</h4><h5 id="1-安装插件"><a href="#1-安装插件" class="headerlink" title="1.安装插件"></a>1.安装插件</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">	</span><br><span class="line">Build Timeout</span><br><span class="line"></span><br><span class="line">build-name-setter</span><br><span class="line"></span><br><span class="line">Credentials Binding Plugin</span><br><span class="line"></span><br><span class="line">description setter plugin</span><br><span class="line"></span><br><span class="line">Dynamic Parameter Plug-in(这个插件,搜不到了,因为安全问题被屏蔽了)</span><br><span class="line"></span><br><span class="line">Environment Injector Plugin</span><br><span class="line"></span><br><span class="line">Git plugin</span><br><span class="line"></span><br><span class="line">GitHub Branch Source Plugin</span><br><span class="line">	</span><br><span class="line">Gitlab Authentication plugin</span><br><span class="line"></span><br><span class="line">GitLab Plugin</span><br><span class="line"></span><br><span class="line">Gradle Plugin</span><br><span class="line"></span><br><span class="line">Pipeline</span><br><span class="line"></span><br><span class="line">SSH Slaves plugin</span><br><span class="line">	</span><br><span class="line">SSH plugin</span><br><span class="line">	</span><br><span class="line">Timestamper</span><br><span class="line">	</span><br><span class="line">Upload to pgyer(上传到蒲公英,没有需要的不用安装)</span><br><span class="line">	</span><br><span class="line">Workspace Cleanup Plugin</span><br></pre></td></tr></table></figure>
<p>以上插件,是常用的插件,尽量全部安装</p>
<h5 id="2-配置环境变量"><a href="#2-配置环境变量" class="headerlink" title="2.配置环境变量"></a>2.配置环境变量</h5><p><strong>系统管理 - 全局工具配置</strong></p>
<p>需要配置</p>
<p>Java</p>
<p><img src="/images/jenkins_java.png" alt="Java"></p>
<p>Git</p>
<p><img src="/images/jenkins_git.png" alt="Git"></p>
<p>Gradle</p>
<p><img src="/images/jenkins_gradle.png" alt="Gradle"></p>
<p>配置好保存即可</p>
<p><strong>系统管理 - 系统设置</strong></p>
<p>记得配置gitlab或者 github账号</p>
<h5 id="3-初始化项目"><a href="#3-初始化项目" class="headerlink" title="3.初始化项目"></a>3.初始化项目</h5><p>创建项目</p>
<p><img src="/images/jenkins_init.png" alt="init"></p>
<hr>
<p><strong>General</strong></p>
<p>选择参数化构建过程</p>
<p>IS_JENKINS  是否Jenkins打包,这里肯定是一直true的</p>
<p>PRODUCT_FLAVORS  环境</p>
<p>BUILD_TYPE  构建版本</p>
<p>VERSION_NAME 版本名字</p>
<p>JENKINS_OUTPUT Apk生成目录</p>
<p>JENKINS_TIME  时间戳</p>
<p><img src="/images/jenkins_init1.png" alt="General"></p>
<p><img src="/images/jenkins_init2.png" alt="General"></p>
<p><img src="/images/jenkins_init3.png" alt="General"></p>
<p>这些参数定义完就可以使用了 ${参数名} 的形式,这些参数会写入到 App项目中的 gradle.properties文件</p>
<p>App项目中的 gradle.properties文件</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># When configured, Gradle will run in incubating parallel mode.</span><br><span class="line"># This option should only be used with decoupled projects. More details, visit</span><br><span class="line"># http://www.gradle.org/docs/current/userguide/multi_project_builds.html#sec:decoupled_projects</span><br><span class="line"># org.gradle.parallel=true</span><br><span class="line">org.gradle.jvmargs=-Xmx4608M</span><br><span class="line"></span><br><span class="line">VERSION_NAME=<span class="number">1.4</span>.0</span><br><span class="line">VERSION_CODE=<span class="number">12</span></span><br><span class="line">IS_JENKINS=<span class="keyword">false</span></span><br><span class="line">JENKINS_OUTPUT=<span class="string">'output/'</span></span><br><span class="line">JENKINS_TIME=<span class="string">'201802021231'</span></span><br></pre></td></tr></table></figure>
<hr>
<p>进入下一个配置页面,到<strong>源码管理</strong>那块</p>
<p><img src="/images/jenkins_gitlab.png" alt="gitlab"></p>
<p>只要你能下载到源码即可,无所谓非要和我这个一致,branch  就是指定分支了,我这儿是  dev 分支</p>
<hr>
<p>下一个配置<strong>构建</strong></p>
<p><img src="/images/jenkins_build.png" alt="build"></p>
<p>选择 Invoke Gradle </p>
<p>Tasks 里面的命令,我来解释一下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#清理</span><br><span class="line">clean  </span><br><span class="line">#打包</span><br><span class="line">assemble$&#123;PRODUCT_FLAVORS&#125;$&#123;BUILD_TYPE&#125;</span><br><span class="line">#这里的意思是 打包指定的一个FLAVOR版本(Release + 版本)</span><br><span class="line">#关于assemble ...  的,请搜 gradle 打包命令</span><br><span class="line"></span><br><span class="line">#其他参数</span><br><span class="line">-PVERSION_NAME=$&#123;VERSION_NAME&#125;</span><br><span class="line">-PVERSION_CODE=$&#123;VERSION_CODE&#125;</span><br><span class="line">-PJENKINS_OUTPUT=$&#123;JENKINS_OUTPUT&#125;</span><br><span class="line">-PJENKINS_TIME=$&#123;JENKINS_TIME&#125;</span><br><span class="line">-PIS_JENKINS=$&#123;IS_JENKINS&#125;</span><br><span class="line"></span><br><span class="line">#-P意味着参数</span><br><span class="line">#-P后面是参数名</span><br><span class="line">#=$&#123;&#125; 则为参数值,就是上面General里面配置的</span><br></pre></td></tr></table></figure>
<hr>
<p><strong>构建后操作</strong></p>
<p><img src="/images/jenkins_pgy.png" alt="pgy"></p>
<blockquote>
<p>参考 <a href="https://www.pgyer.com/doc/view/jenkins_plugin" target="_blank" rel="noopener">https://www.pgyer.com/doc/view/jenkins_plugin</a></p>
</blockquote>
<p>保存即可</p>
<h5 id="改造App"><a href="#改造App" class="headerlink" title="改造App"></a>改造App</h5><ul>
<li>./gradle.properties文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">VERSION_NAME=1.4.0</span><br><span class="line">VERSION_CODE=12</span><br><span class="line">IS_JENKINS=false</span><br><span class="line">JENKINS_OUTPUT=&apos;output/&apos;</span><br><span class="line">JENKINS_TIME=&apos;201802021231&apos;</span><br></pre></td></tr></table></figure>
<p>以上文件,写完请build一次,便于build.gradle中使用</p>
<p>使用jenkins时,jenkins会把定义的值注入到这里,覆盖这里定义的值</p>
<ul>
<li>app/build.gradle</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line">android&#123;</span><br><span class="line"></span><br><span class="line">	defaultConfig &#123;</span><br><span class="line">    	...</span><br><span class="line">    	<span class="comment">//此处使用gradle.properties中的值   VERSION_CODE和VERSION_NAME</span></span><br><span class="line">    	versionCode VERSION_CODE <span class="keyword">as</span> Integer</span><br><span class="line">    	versionName VERSION_NAME</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	</span><br><span class="line">	<span class="comment">//自定义apk名字</span></span><br><span class="line">    android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">    	<span class="comment">//获取时间戳</span></span><br><span class="line">        <span class="keyword">def</span> timeNow = getDate()</span><br><span class="line">        <span class="comment">//如果是IS_JENKINS构建,则修改打包apk的目录</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">'true'</span>.equals(IS_JENKINS)) &#123;</span><br><span class="line">        	<span class="comment">//使用JENKINS_OUTPUT的目录</span></span><br><span class="line">            <span class="keyword">def</span> outputFile = JENKINS_OUTPUT</span><br><span class="line">            <span class="comment">//使用JENKINS_TIME的时间戳</span></span><br><span class="line">            timeNow = JENKINS_TIME</span><br><span class="line">            <span class="comment">//定义apk目录</span></span><br><span class="line">            variant.getPackageApplication().outputDirectory = <span class="keyword">new</span> File(outputFile)</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        </span><br><span class="line">        variant.getPackageApplication().outputScope.apkDatas.forEach &#123; apkData -&gt;</span><br><span class="line">            <span class="comment">//这个修改输出APK的文件名</span></span><br><span class="line">            apkData.outputFileName = <span class="string">"一号车市_$&#123;variant.versionName&#125;_$&#123;timeNow&#125;.apk"</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	flavorDimensions <span class="string">'env'</span></span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        envapp &#123;</span><br><span class="line">            dimension <span class="string">'env'</span></span><br><span class="line">            <span class="comment">//此处使用jenkins传的VERSION_NAME</span></span><br><span class="line">            versionName VERSION_NAME</span><br><span class="line">            manifestPlaceholders = [<span class="string">UMENG_CHANNEL_VALUE:</span> <span class="string">"app"</span>]</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"SERVER_HOST"</span>, <span class="string">'"https://app.wangzhumo.com/"'</span></span><br><span class="line">        &#125;</span><br><span class="line">        envtest &#123;</span><br><span class="line">            dimension <span class="string">'env'</span></span><br><span class="line">            <span class="comment">//为了方便测试看出当前app环境,就不用VERSION_NAME了</span></span><br><span class="line">            versionName <span class="string">"Test"</span></span><br><span class="line">            manifestPlaceholders = [<span class="string">UMENG_CHANNEL_VALUE:</span> <span class="string">"app"</span>]</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"SERVER_HOST"</span>, <span class="string">'"http://app-test.wangzhumo.com/"'</span></span><br><span class="line">        &#125;</span><br><span class="line">        envpre &#123;</span><br><span class="line">            dimension <span class="string">'env'</span></span><br><span class="line">            versionName <span class="string">"Pre"</span></span><br><span class="line">            manifestPlaceholders = [<span class="string">UMENG_CHANNEL_VALUE:</span> <span class="string">"app"</span>]</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"SERVER_HOST"</span>, <span class="string">'"https://app-pre.wangzhumo.com/"'</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        envdev &#123;</span><br><span class="line">            dimension <span class="string">'env'</span></span><br><span class="line">            versionName <span class="string">"Dev"</span></span><br><span class="line">            manifestPlaceholders = [<span class="string">UMENG_CHANNEL_VALUE:</span> <span class="string">"app"</span>]</span><br><span class="line">            buildConfigField <span class="string">"String"</span>, <span class="string">"SERVER_HOST"</span>, <span class="string">'"http://192.168.1.16:8080/app2c/"'</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//其实UMENG_CHANNEL_VALUE    SERVER_HOST   也都可以使用jenkins定义参数,并使用</span></span><br><span class="line">    &#125; </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">//一个获取时间戳的方法</span></span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">def</span> getDate() &#123;</span><br><span class="line">    	<span class="keyword">def</span> date = <span class="keyword">new</span> Date()</span><br><span class="line">    	<span class="keyword">def</span> formattedDate = date.format(<span class="string">'yyyyMMddHHmm'</span>)</span><br><span class="line">    	<span class="keyword">return</span> formattedDate</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>记得改完app,上传代码哦</p>
<h4 id="Jenkins打包"><a href="#Jenkins打包" class="headerlink" title="Jenkins打包"></a>Jenkins打包</h4><p><img src="/images/jenkins_go.png" alt="打包"></p>
<p>OK了,可以愉快的打包了,打包完就会自动上传到蒲公英.</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Server </tag>
            
            <tag> Jenkins </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Java中String.format()的使用指北]]></title>
      <url>/Java/Java%E4%B8%ADString-format-%E7%9A%84%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97/</url>
      <content type="html"><![CDATA[<blockquote>
<p>本文非原创,来自<a href="http://blog.csdn.net/lonely_fireworks/article/details/7962171/" target="_blank" rel="noopener">http://blog.csdn.net/lonely_fireworks/article/details/7962171/</a></p>
<p>这里做一个备份,方便随时查询</p>
</blockquote>
<h4 id="常规类型的格式化"><a href="#常规类型的格式化" class="headerlink" title="常规类型的格式化"></a>常规类型的格式化</h4><p>String类的format()方法用于创建格式化的字符串以及连接多个字符串对象,format()方法有两种重载形式。</p>
<ul>
<li><p>format(String format, Object… args) </p>
<p>新字符串使用本地语言环境，制定字符串格式和参数生成格式化的新字符串。</p>
</li>
<li><p>format(Locale locale, String format, Object… args) </p>
<p>使用指定的语言环境，制定字符串格式和参数生成格式化的字符串。</p>
</li>
</ul>
<h5 id="显示不同转换符实现不同数据类型到字符串的转换，如图所示。"><a href="#显示不同转换符实现不同数据类型到字符串的转换，如图所示。" class="headerlink" title="显示不同转换符实现不同数据类型到字符串的转换，如图所示。"></a>显示不同转换符实现不同数据类型到字符串的转换，如图所示。</h5><table>
<thead>
<tr>
<th>转  换  符</th>
<th>说    明</th>
<th>示    例</th>
</tr>
</thead>
<tbody>
<tr>
<td>%s</td>
<td>字符串类型</td>
<td>“mingrisoft”</td>
</tr>
<tr>
<td>%c</td>
<td>字符类型</td>
<td>‘m’</td>
</tr>
<tr>
<td>%b</td>
<td>布尔类型</td>
<td>true</td>
</tr>
<tr>
<td>%d</td>
<td>整数类型（十进制）</td>
<td>99</td>
</tr>
<tr>
<td>%x</td>
<td>整数类型（十六进制）</td>
<td>FF</td>
</tr>
<tr>
<td>%o</td>
<td>整数类型（八进制）</td>
<td>77</td>
</tr>
<tr>
<td>%f</td>
<td>浮点类型</td>
<td>99.99</td>
</tr>
<tr>
<td>%a</td>
<td>十六进制浮点类型</td>
<td>FF.35AE</td>
</tr>
<tr>
<td>%e</td>
<td>指数类型</td>
<td>9.38e+5</td>
</tr>
<tr>
<td>%g</td>
<td>通用浮点类型（f和e类型中较短的）</td>
<td></td>
</tr>
<tr>
<td>%h</td>
<td>散列码</td>
<td></td>
</tr>
<tr>
<td>%%</td>
<td>百分比类型</td>
<td>％</td>
</tr>
<tr>
<td>%n</td>
<td>换行符</td>
<td></td>
</tr>
<tr>
<td>%tx</td>
<td>日期与时间类型（x代表不同的日期与时间转换符</td>
</tr>
</tbody>
</table>
<p>测试用例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    String str=<span class="keyword">null</span>;</span><br><span class="line">    str=String.format(<span class="string">"Hi,%s"</span>, <span class="string">"王力"</span>);</span><br><span class="line">    System.out.println(str);</span><br><span class="line">    str=String.format(<span class="string">"Hi,%s:%s.%s"</span>, <span class="string">"王南"</span>,<span class="string">"王力"</span>,<span class="string">"王张"</span>);          </span><br><span class="line">    System.out.println(str);                         </span><br><span class="line">    System.out.printf(<span class="string">"字母a的大写是：%c %n"</span>, <span class="string">'A'</span>);</span><br><span class="line">    System.out.printf(<span class="string">"3&gt;7的结果是：%b %n"</span>, <span class="number">3</span>&gt;<span class="number">7</span>);</span><br><span class="line">    System.out.printf(<span class="string">"100的一半是：%d %n"</span>, <span class="number">100</span>/<span class="number">2</span>);</span><br><span class="line">    System.out.printf(<span class="string">"100的16进制数是：%x %n"</span>, <span class="number">100</span>);</span><br><span class="line">    System.out.printf(<span class="string">"100的8进制数是：%o %n"</span>, <span class="number">100</span>);</span><br><span class="line">    System.out.printf(<span class="string">"50元的书打8.5折扣是：%f 元%n"</span>, <span class="number">50</span>*<span class="number">0.85</span>);</span><br><span class="line">    System.out.printf(<span class="string">"上面价格的16进制数是：%a %n"</span>, <span class="number">50</span>*<span class="number">0.85</span>);</span><br><span class="line">    System.out.printf(<span class="string">"上面价格的指数表示：%e %n"</span>, <span class="number">50</span>*<span class="number">0.85</span>);</span><br><span class="line">    System.out.printf(<span class="string">"上面价格的指数和浮点数结果的长度较短的是：%g %n"</span>, <span class="number">50</span>*<span class="number">0.85</span>);</span><br><span class="line">    System.out.printf(<span class="string">"上面的折扣是%d%% %n"</span>, <span class="number">85</span>);</span><br><span class="line">    System.out.printf(<span class="string">"字母A的散列码是：%h %n"</span>, <span class="string">'A'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">Hi,王力</span><br><span class="line">Hi,王南:王力.王张</span><br><span class="line">字母a的大写是：A </span><br><span class="line"><span class="number">3</span>&gt;<span class="number">7</span>的结果是：<span class="keyword">false</span> </span><br><span class="line"><span class="number">100</span>的一半是：<span class="number">50</span> </span><br><span class="line"><span class="number">100</span>的<span class="number">16</span>进制数是：<span class="number">64</span> </span><br><span class="line"><span class="number">100</span>的<span class="number">8</span>进制数是：<span class="number">144</span> </span><br><span class="line"><span class="number">50</span>元的书打<span class="number">8.5</span>折扣是：<span class="number">42.500000</span> 元</span><br><span class="line">上面价格的<span class="number">16</span>进制数是：<span class="number">0x1</span>.54p5 </span><br><span class="line">上面价格的指数表示：<span class="number">4.250000e+01</span> </span><br><span class="line">上面价格的指数和浮点数结果的长度较短的是：<span class="number">42.5000</span> </span><br><span class="line">上面的折扣是<span class="number">85</span>% </span><br><span class="line">字母A的散列码是：<span class="number">41</span></span><br></pre></td></tr></table></figure>
<h5 id="搭配转换符的标志"><a href="#搭配转换符的标志" class="headerlink" title="搭配转换符的标志"></a>搭配转换符的标志</h5><table>
<thead>
<tr>
<th>标    志</th>
<th>说    明</th>
<th>示    例</th>
<th>结    果</th>
</tr>
</thead>
<tbody>
<tr>
<td>+</td>
<td>为正数或者负数添加符号</td>
<td>(“%+d”,15)</td>
<td>+15</td>
</tr>
<tr>
<td>−</td>
<td>左对齐</td>
<td>(“%-5d”,15)</td>
<td>\</td>
<td>15   \</td>
<td></td>
</tr>
<tr>
<td>0</td>
<td>数字前面补0</td>
<td>(“%04d”, 99)</td>
<td>0099</td>
</tr>
<tr>
<td>空格</td>
<td>在整数之前添加指定数量的空格</td>
<td>(“% 4d”, 99)</td>
<td>\</td>
<td>99\</td>
<td></td>
</tr>
<tr>
<td>,</td>
<td>以“,”对数字分组</td>
<td>(“%,f”, 9999.99)</td>
<td>9,999.990000</td>
</tr>
<tr>
<td>(</td>
<td>使用括号包含负数</td>
<td>(“%(f”, -99.99)</td>
<td>(99.990000)</td>
</tr>
<tr>
<td>#</td>
<td>如果是浮点数则包含小数点，如果是16进制或8进制则添加0x或0</td>
<td>(“%#x”, 99)(“%#o”, 99)</td>
<td>0x630143</td>
</tr>
<tr>
<td>&lt;</td>
<td>格式化前一个转换符所描述的参数</td>
<td>(“%f和%&lt;3.2f”, 99.45)</td>
<td>99.450000和99.45</td>
</tr>
<tr>
<td>$</td>
<td>被格式化的参数索引</td>
<td>(“%1$d,%2$s”, 99,”abc”)</td>
<td>99,abc</td>
</tr>
</tbody>
</table>
<p>测试用例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;  </span><br><span class="line"></span><br><span class="line">    String str=<span class="keyword">null</span>;  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//$使用  </span></span><br><span class="line">    str=String.format(<span class="string">"格式参数的使用：%1d,%2$s"</span>, <span class="number">99</span>,<span class="string">"abc"</span>);             </span><br><span class="line">    System.out.println(str);                       </span><br><span class="line">   	</span><br><span class="line">   	<span class="comment">//+使用  </span></span><br><span class="line">    System.out.printf(<span class="string">"显示正负数的符号：%+d与%d%n"</span>, <span class="number">99</span>,-<span class="number">99</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//补O使用  </span></span><br><span class="line">    System.out.printf(<span class="string">"最牛的编号是：%03d%n"</span>, <span class="number">7</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//空格使用  </span></span><br><span class="line">    System.out.printf(<span class="string">"Tab键的效果是：% 8d%n"</span>, <span class="number">7</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//.使用  </span></span><br><span class="line">    System.out.printf(<span class="string">"整数分组的效果是：%,d%n"</span>, <span class="number">9989997</span>);  </span><br><span class="line"></span><br><span class="line">    <span class="comment">//空格和小数点后面个数  </span></span><br><span class="line">    System.out.printf(<span class="string">"一本书的价格是：% 50.5f元%n"</span>, <span class="number">49.8</span>);  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">格式参数$的使用：<span class="number">99</span>,abc</span><br><span class="line">显示正负数的符号：+<span class="number">99</span>与-<span class="number">99</span></span><br><span class="line">最牛的编号是：<span class="number">007</span></span><br><span class="line">Tab键的效果是：       <span class="number">7</span></span><br><span class="line">整数分组的效果是：<span class="number">9</span>,<span class="number">989</span>,<span class="number">997</span></span><br><span class="line">一本书的价格是： <span class="number">49.80000</span>元</span><br></pre></td></tr></table></figure>
<h4 id="日期和事件字符串格式化"><a href="#日期和事件字符串格式化" class="headerlink" title="日期和事件字符串格式化"></a>日期和事件字符串格式化</h4><p>字符串格式中还有%tx转换符没有详细介绍，它是专门用来格式化日期和时 间的。%tx转换符中的x代表另外的处理日期和时间格式的转换符，它们的组合能够将日期和时间格式化成多种格式。</p>
<h5 id="常见日期和时间组合的格式"><a href="#常见日期和时间组合的格式" class="headerlink" title="常见日期和时间组合的格式"></a>常见日期和时间组合的格式</h5><table>
<thead>
<tr>
<th>转  换  符</th>
<th>说    明</th>
<th>示    例</th>
</tr>
</thead>
<tbody>
<tr>
<td>c</td>
<td>包括全部日期和时间信息</td>
<td>星期六 十月 27 14:21:20 CST 2007</td>
</tr>
<tr>
<td>F</td>
<td>“年-月-日”格式</td>
<td>2007-10-27</td>
</tr>
<tr>
<td>D</td>
<td>“月/日/年”格式</td>
<td>10/27/07</td>
</tr>
<tr>
<td>r</td>
<td>“HH:MM:SS PM”格式（12时制）</td>
<td>02:25:51 下午</td>
</tr>
<tr>
<td>T</td>
<td>“HH:MM:SS”格式（24时制）</td>
<td>14:28:16</td>
</tr>
<tr>
<td>R</td>
<td>“HH:MM”格式（24时制）</td>
<td>14:28</td>
</tr>
</tbody>
</table>
<p>测试用例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	Date date=<span class="keyword">new</span> Date();                                </span><br><span class="line">	<span class="comment">//c的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"全部日期和时间信息：%tc%n"</span>,date);        </span><br><span class="line">	<span class="comment">//f的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"年-月-日格式：%tF%n"</span>,date);</span><br><span class="line">	<span class="comment">//d的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"月/日/年格式：%tD%n"</span>,date);</span><br><span class="line">	<span class="comment">//r的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"HH:MM:SS PM格式（12时制）：%tr%n"</span>,date);</span><br><span class="line">	<span class="comment">//t的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"HH:MM:SS格式（24时制）：%tT%n"</span>,date);</span><br><span class="line">	<span class="comment">//R的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"HH:MM格式（24时制）：%tR"</span>,date);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">全部日期和时间信息：星期一 九月 10 10:43:36 CST 2012</span><br><span class="line">年-月-日格式：2012-09-10</span><br><span class="line">月/日/年格式：09/10/12</span><br><span class="line">HH:MM:SS PM格式（12时制）：10:43:36 上午</span><br><span class="line">HH:MM:SS格式（24时制）：10:43:36</span><br><span class="line">HH:MM格式（24时制）：10:43</span><br></pre></td></tr></table></figure>
<p>定义日期格式的转换符可以使日期通过指定的转换符生成新字符串。这些日期转换符如图所示。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  Date date=<span class="keyword">new</span> Date();                                    </span><br><span class="line">  <span class="comment">//b的使用，月份简称</span></span><br><span class="line">  String str=String.format(Locale.US,<span class="string">"英文月份简称：%tb"</span>,date);     </span><br><span class="line">  System.out.println(str);                                                                            </span><br><span class="line">  System.out.printf(<span class="string">"本地月份简称：%tb%n"</span>,date);</span><br><span class="line">  <span class="comment">//B的使用，月份全称</span></span><br><span class="line">  str=String.format(Locale.US,<span class="string">"英文月份全称：%tB"</span>,date);</span><br><span class="line">  System.out.println(str);</span><br><span class="line">  System.out.printf(<span class="string">"本地月份全称：%tB%n"</span>,date);</span><br><span class="line">  <span class="comment">//a的使用，星期简称</span></span><br><span class="line">  str=String.format(Locale.US,<span class="string">"英文星期的简称：%ta"</span>,date);</span><br><span class="line">  System.out.println(str);</span><br><span class="line">  <span class="comment">//A的使用，星期全称</span></span><br><span class="line">  System.out.printf(<span class="string">"本地星期的简称：%tA%n"</span>,date);</span><br><span class="line">  <span class="comment">//C的使用，年前两位</span></span><br><span class="line">  System.out.printf(<span class="string">"年的前两位数字（不足两位前面补0）：%tC%n"</span>,date);</span><br><span class="line">  <span class="comment">//y的使用，年后两位</span></span><br><span class="line">  System.out.printf(<span class="string">"年的后两位数字（不足两位前面补0）：%ty%n"</span>,date);</span><br><span class="line">  <span class="comment">//j的使用，一年的天数</span></span><br><span class="line">  System.out.printf(<span class="string">"一年中的天数（即年的第几天）：%tj%n"</span>,date);</span><br><span class="line">  <span class="comment">//m的使用，月份</span></span><br><span class="line">  System.out.printf(<span class="string">"两位数字的月份（不足两位前面补0）：%tm%n"</span>,date);</span><br><span class="line">  <span class="comment">//d的使用，日（二位，不够补零）</span></span><br><span class="line">  System.out.printf(<span class="string">"两位数字的日（不足两位前面补0）：%td%n"</span>,date);</span><br><span class="line">  <span class="comment">//e的使用，日（一位不补零）</span></span><br><span class="line">  System.out.printf(<span class="string">"月份的日（前面不补0）：%te"</span>,date);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">英文月份简称：Sep</span><br><span class="line">本地月份简称：九月</span><br><span class="line">英文月份全称：September</span><br><span class="line">本地月份全称：九月</span><br><span class="line">英文星期的简称：Mon</span><br><span class="line">本地星期的简称：星期一</span><br><span class="line">年的前两位数字（不足两位前面补0）：20</span><br><span class="line">年的后两位数字（不足两位前面补0）：12</span><br><span class="line">一年中的天数（即年的第几天）：254</span><br><span class="line">两位数字的月份（不足两位前面补0）：09</span><br><span class="line">两位数字的日（不足两位前面补0）：10</span><br><span class="line">月份的日（前面不补0）：10</span><br></pre></td></tr></table></figure>
<h5 id="和日期格式转换符相比，时间格式的转换符要更多、更精确。它可以将时间格式化成时、分、秒甚至时毫秒等单位。格式化时间字符串的转换符如图所示。"><a href="#和日期格式转换符相比，时间格式的转换符要更多、更精确。它可以将时间格式化成时、分、秒甚至时毫秒等单位。格式化时间字符串的转换符如图所示。" class="headerlink" title="和日期格式转换符相比，时间格式的转换符要更多、更精确。它可以将时间格式化成时、分、秒甚至时毫秒等单位。格式化时间字符串的转换符如图所示。"></a>和日期格式转换符相比，时间格式的转换符要更多、更精确。它可以将时间格式化成时、分、秒甚至时毫秒等单位。格式化时间字符串的转换符如图所示。</h5><table>
<thead>
<tr>
<th>转  换  符</th>
<th>说    明</th>
<th>示    例</th>
</tr>
</thead>
<tbody>
<tr>
<td>H</td>
<td>2位数字24时制的小时（不足2位前面补0）</td>
<td>15</td>
</tr>
<tr>
<td>I</td>
<td>2位数字12时制的小时（不足2位前面补0）</td>
<td>03</td>
</tr>
<tr>
<td>k</td>
<td>2位数字24时制的小时（前面不补0）</td>
<td>15</td>
</tr>
<tr>
<td>l</td>
<td>2位数字12时制的小时（前面不补0）</td>
<td>3</td>
</tr>
<tr>
<td>M</td>
<td>2位数字的分钟（不足2位前面补0）</td>
<td>03</td>
</tr>
<tr>
<td>S</td>
<td>2位数字的秒（不足2位前面补0）</td>
<td>09</td>
</tr>
<tr>
<td>L</td>
<td>3位数字的毫秒（不足3位前面补0）</td>
<td>015</td>
</tr>
<tr>
<td>N</td>
<td>9位数字的毫秒数（不足9位前面补0）</td>
<td>562000000</td>
</tr>
<tr>
<td>p</td>
<td>小写字母的上午或下午标记</td>
<td>中：下午英：pm</td>
</tr>
<tr>
<td>z</td>
<td>相对于GMT的RFC822时区的偏移量</td>
<td>+0800</td>
</tr>
<tr>
<td>Z</td>
<td>时区缩写字符串</td>
<td>CST</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>s</th>
<th>1970-1-1 00:00:00 到现在所经过的秒数</th>
<th>1193468128</th>
</tr>
</thead>
<tbody>
<tr>
<td>Q</td>
<td>1970-1-1 00:00:00 到现在所经过的毫秒数</td>
<td>1193468128984</td>
</tr>
</tbody>
</table>
<p>测试代码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">	Date date = <span class="keyword">new</span> Date();</span><br><span class="line">	<span class="comment">//H的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字24时制的小时（不足2位前面补0）:%tH%n"</span>, date);</span><br><span class="line">	<span class="comment">//I的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字12时制的小时（不足2位前面补0）:%tI%n"</span>, date);</span><br><span class="line">	<span class="comment">//k的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字24时制的小时（前面不补0）:%tk%n"</span>, date);</span><br><span class="line">	<span class="comment">//l的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字12时制的小时（前面不补0）:%tl%n"</span>, date);</span><br><span class="line">	<span class="comment">//M的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字的分钟（不足2位前面补0）:%tM%n"</span>, date);</span><br><span class="line">	<span class="comment">//S的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"2位数字的秒（不足2位前面补0）:%tS%n"</span>, date);</span><br><span class="line">	<span class="comment">//L的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"3位数字的毫秒（不足3位前面补0）:%tL%n"</span>, date);</span><br><span class="line">	<span class="comment">//N的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"9位数字的毫秒数（不足9位前面补0）:%tN%n"</span>, date);</span><br><span class="line">	<span class="comment">//p的使用</span></span><br><span class="line">	String str = String.format(Locale.US, <span class="string">"小写字母的上午或下午标记(英)：%tp"</span>, date);</span><br><span class="line">	System.out.println(str); </span><br><span class="line">	System.out.printf(<span class="string">"小写字母的上午或下午标记（中）：%tp%n"</span>, date);</span><br><span class="line">	<span class="comment">//z的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"相对于GMT的RFC822时区的偏移量:%tz%n"</span>, date);</span><br><span class="line">	<span class="comment">//Z的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"时区缩写字符串:%tZ%n"</span>, date);</span><br><span class="line">	<span class="comment">//s的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"1970-1-1 00:00:00 到现在所经过的秒数：%ts%n"</span>, date);</span><br><span class="line">	<span class="comment">//Q的使用</span></span><br><span class="line">	System.out.printf(<span class="string">"1970-1-1 00:00:00 到现在所经过的毫秒数：%tQ%n"</span>, date);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span>位数字<span class="number">24</span>时制的小时（不足<span class="number">2</span>位前面补<span class="number">0</span>）:<span class="number">11</span></span><br><span class="line"><span class="number">2</span>位数字<span class="number">12</span>时制的小时（不足<span class="number">2</span>位前面补<span class="number">0</span>）:<span class="number">11</span></span><br><span class="line"><span class="number">2</span>位数字<span class="number">24</span>时制的小时（前面不补<span class="number">0</span>）:<span class="number">11</span></span><br><span class="line"><span class="number">2</span>位数字<span class="number">12</span>时制的小时（前面不补<span class="number">0</span>）:<span class="number">11</span></span><br><span class="line"><span class="number">2</span>位数字的分钟（不足<span class="number">2</span>位前面补<span class="number">0</span>）:<span class="number">03</span></span><br><span class="line"><span class="number">2</span>位数字的秒（不足<span class="number">2</span>位前面补<span class="number">0</span>）:<span class="number">52</span></span><br><span class="line"><span class="number">3</span>位数字的毫秒（不足<span class="number">3</span>位前面补<span class="number">0</span>）:<span class="number">773</span></span><br><span class="line"><span class="number">9</span>位数字的毫秒数（不足<span class="number">9</span>位前面补<span class="number">0</span>）:<span class="number">773000000</span></span><br><span class="line">小写字母的上午或下午标记(英)：am</span><br><span class="line">小写字母的上午或下午标记（中）：上午</span><br><span class="line">相对于GMT的RFC822时区的偏移量:+<span class="number">0800</span></span><br><span class="line">时区缩写字符串:CST</span><br><span class="line"><span class="number">1970</span>-<span class="number">1</span>-<span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> 到现在所经过的秒数：<span class="number">1347246232</span></span><br><span class="line"><span class="number">1970</span>-<span class="number">1</span>-<span class="number">1</span> <span class="number">00</span>:<span class="number">00</span>:<span class="number">00</span> 到现在所经过的毫秒数：<span class="number">1347246232773</span></span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Java </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Java </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Room --AppDatabase_Impl does not exist的异常解决]]></title>
      <url>/Bug/Room-AppDatabase-Impl-does-not-exist%E7%9A%84%E5%BC%82%E5%B8%B8%E8%A7%A3%E5%86%B3/</url>
      <content type="html"><![CDATA[<p>Bug如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.RuntimeException: cannot find implementation for com.wangzhumo.app.datasource.database.AppDB. AppDB_Impl does not exist</span><br></pre></td></tr></table></figure></p>
<h4 id="寻找原因"><a href="#寻找原因" class="headerlink" title="寻找原因"></a>寻找原因</h4><p>debug依次发现:</p>
<ul>
<li><p>getInstance()为空</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppDB <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">      <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="keyword">synchronized</span> (AppDB.class) &#123;</span><br><span class="line">              <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">              </span><br><span class="line">              	<span class="comment">//此处返回为空</span></span><br><span class="line">                  sInstance = buildDatabase(context);</span><br><span class="line">                  sInstance.updateDatabaseCreated(context);</span><br><span class="line">              &#125;</span><br><span class="line">          &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> sInstance;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>buildDatabase(context) 返回为空</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Build the database.</span></span><br><span class="line"><span class="comment"> * creates a new instance of the database.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AppDB <span class="title">buildDatabase</span><span class="params">(<span class="keyword">final</span> Context appContext)</span> </span>&#123;</span><br><span class="line">     AppDB appDB = Room.databaseBuilder(appContext, AppDB.class, DATABASE_NAME)</span><br><span class="line">            .addCallback(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@NonNull SupportSQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.onCreate(db);</span><br><span class="line">                    AppDB database = AppDB.getInstance(appContext);</span><br><span class="line">                    database.setDatabaseCreated();</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="meta">@Override</span></span><br><span class="line">                <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(@NonNull SupportSQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">                    <span class="keyword">super</span>.onOpen(db);</span><br><span class="line">                    Log.e(TAG, <span class="string">"onOpen: "</span> + db.getPath());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).build();</span><br><span class="line">    <span class="keyword">return</span> appDB;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>databaseBuilder是创建数据库的方法,但是它构建失败了,那么剩下的就是源码了</p>
</li>
</ul>
<h4 id="Debug源码"><a href="#Debug源码" class="headerlink" title="Debug源码"></a>Debug源码</h4><ul>
<li>databaseBuilder 方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SuppressWarnings</span>(<span class="string">"WeakerAccess"</span>)</span><br><span class="line">    <span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T extends RoomDatabase&gt; RoomDatabase.<span class="function">Builder&lt;T&gt; <span class="title">databaseBuilder</span><span class="params">(</span></span></span><br><span class="line"><span class="function"><span class="params">            @NonNull Context context, @NonNull Class&lt;T&gt; klass, @NonNull String name)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//noinspection ConstantConditions</span></span><br><span class="line">        <span class="keyword">if</span> (name == <span class="keyword">null</span> || name.trim().length() == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException</span><br><span class="line">              (<span class="string">"Cannot build a database with null or empty name."</span></span><br><span class="line">                    + <span class="string">" If you are trying to create an in memory database, use Room"</span></span><br><span class="line">                    + <span class="string">".inMemoryDatabaseBuilder"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RoomDatabase.Builder&lt;&gt;(context, klass, name);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>我们可以明显的看出,此处抛出的异常不是AppDB_Impl does not exist 的提示,可以肯定并不是此处的问题</p>
<p>应该是正常返回的 return new RoomDatabase.Builder&lt;&gt;(context, klass, name);</p>
<p><code>RoomDatabase.Builder</code></p>
<p>那么出问题的就可以肯定是</p>
<ul>
<li><p>build()方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">@NonNull</span><br><span class="line">        public T build() &#123;</span><br><span class="line">            //noinspection ConstantConditions</span><br><span class="line">            if (mContext == null) &#123;</span><br><span class="line">                throw new IllegalArgumentException</span><br><span class="line">                (&quot;Cannot provide null context for the database.&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            //noinspection ConstantConditions</span><br><span class="line">            if (mDatabaseClass == null) &#123;</span><br><span class="line">                throw new IllegalArgumentException</span><br><span class="line">                (&quot;Must provide an abstract class that&quot;</span><br><span class="line">                        + &quot; extends RoomDatabase&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if (mFactory == null) &#123;</span><br><span class="line">                mFactory = new FrameworkSQLiteOpenHelperFactory();</span><br><span class="line">            &#125;</span><br><span class="line">            DatabaseConfiguration configuration =</span><br><span class="line">                    new DatabaseConfiguration(mContext, mName, mFactory, mMigrationContainer,</span><br><span class="line">                            mCallbacks, mAllowMainThreadQueries, mRequireMigration);</span><br><span class="line">            T db = Room.getGeneratedImplementation(mDatabaseClass, DB_IMPL_SUFFIX);</span><br><span class="line">            db.init(configuration);</span><br><span class="line">            return db;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<p>此处,debug发现,是到</p>
<p><code>T db = Room.getGeneratedImplementation(mDatabaseClass, DB_IMPL_SUFFIX);</code></p>
<p>抛出异常的.</p>
</li>
</ul>
<h4 id="锁定问题"><a href="#锁定问题" class="headerlink" title="锁定问题"></a>锁定问题</h4><p><code>getGeneratedImplementation</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@NonNull</span></span><br><span class="line">    <span class="keyword">static</span> &lt;T, C&gt; <span class="function">T <span class="title">getGeneratedImplementation</span><span class="params">(Class&lt;C&gt; klass, String suffix)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> String fullPackage = klass.getPackage().getName();</span><br><span class="line">        String name = klass.getCanonicalName();</span><br><span class="line">        <span class="keyword">final</span> String postPackageName = fullPackage.isEmpty()</span><br><span class="line">                ? name</span><br><span class="line">                : (name.substring(fullPackage.length() + <span class="number">1</span>));</span><br><span class="line">        <span class="keyword">final</span> String implName = postPackageName.replace(<span class="string">'.'</span>, <span class="string">'_'</span>) + suffix;</span><br><span class="line">        <span class="comment">//noinspection TryWithIdenticalCatches</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line"></span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">            <span class="keyword">final</span> Class&lt;T&gt; aClass = (Class&lt;T&gt;) Class.forName(</span><br><span class="line">                    fullPackage.isEmpty() ? implName : fullPackage + <span class="string">"."</span> + implName);</span><br><span class="line">            <span class="keyword">return</span> aClass.newInstance();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">        </span><br><span class="line">        	</span><br><span class="line">        	<span class="comment">//**很明显,就是这个地方了**</span></span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"cannot find implementation for "</span></span><br><span class="line">                    + klass.getCanonicalName() + <span class="string">". "</span> + implName + <span class="string">" does not exist"</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IllegalAccessException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Cannot access the constructor"</span></span><br><span class="line">                    + klass.getCanonicalName());</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InstantiationException e) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">"Failed to create an instance of "</span></span><br><span class="line">                    + klass.getCanonicalName());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>其实就是,生成类失败了</p>
<p>其他参数都正常,偏偏生成失败,所以就怀疑到 </p>
<p> Java  -&gt;     <code>apt</code> 的问题</p>
<p>Kotlin -&gt;  <code>kapt</code>的问题</p>
<p>这两个就是用来生成代码的,这里的生成失败,有很大概率是这个问题</p>
<h4 id="解决问题"><a href="#解决问题" class="headerlink" title="解决问题"></a>解决问题</h4><p>查看项目的依赖  <code>lib_opensource  -&gt; build.gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//arch</span><br><span class="line">api deps.archLibs.archExtensions</span><br><span class="line">api deps.archLibs.archLifecycleCommon</span><br><span class="line">api deps.archLibs.archRoomRuntime</span><br><span class="line">kapt deps.archLibs.archRoomCompiler</span><br></pre></td></tr></table></figure>
<p>查看发现,我已经添加了,那么什么鬼问题呢?</p>
<p><strong>怀疑是library的问题,打开我使用Room的library</strong>    ,查看 <code>lib_datasource -&gt; build.gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;com.android.library&apos;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class="line">    api project(&apos;:lib_opensource&apos;)</span><br><span class="line"></span><br><span class="line">//    kapt deps.archLibs.archRoomCompiler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>果然忘了加</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;com.android.library&apos;</span><br><span class="line">apply plugin: &apos;kotlin-android&apos;</span><br><span class="line">apply plugin: &apos;kotlin-kapt&apos;</span><br><span class="line"></span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">dependencies &#123;</span><br><span class="line">    implementation fileTree(dir: &apos;libs&apos;, include: [&apos;*.jar&apos;])</span><br><span class="line">    api project(&apos;:lib_opensource&apos;)</span><br><span class="line"></span><br><span class="line">//    kapt deps.archLibs.archRoomCompiler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>就Ok了,我又可以愉快的玩耍了</p>
<h4 id="记得-kapt"><a href="#记得-kapt" class="headerlink" title="记得:  kapt"></a>记得:  kapt</h4>]]></content>
      
        <categories>
            
            <category> Bug </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Bug </tag>
            
            <tag> Room </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[使用Charles抓Https的数据请求]]></title>
      <url>/uncategorized/%E4%BD%BF%E7%94%A8Charles%E6%8A%93Https%E7%9A%84%E6%95%B0%E6%8D%AE%E8%AF%B7%E6%B1%82/</url>
      <content type="html"><![CDATA[<p>之前的文章中给项目中加入了Https,此时使用charles珠宝就是一堆乱码,</p>
<p>但是我们还需要常常使用Charles,调试接口,查找问题等.</p>
<h4 id="导出证书"><a href="#导出证书" class="headerlink" title="导出证书"></a>导出证书</h4><p>1.打开Charles</p>
<p>2.Help -&gt; SSL Proxying -&gt; Save Charles Root Certificate…</p>
<p>3.保存到~/Downloads/charles-ssl-proxying-certificate.pem</p>
<h4 id="安装证书到设备"><a href="#安装证书到设备" class="headerlink" title="安装证书到设备"></a>安装证书到设备</h4><p>1.把证书推送到设备</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb push charles-ssl-proxying-certificate.pem /sdcard/Download/</span><br><span class="line">charles-ssl-proxying-certificate.pem: 1 file pushed. 0.1 MB/s (1921 bytes in 0.012s)</span><br></pre></td></tr></table></figure>
<p>2.安装证书</p>
<p>设置 -&gt; 安全 -&gt; 设备管理与凭证 -&gt; 从存储安装 -&gt; charles-ssl-proxying-certificate.pem’</p>
<h4 id="设置Charles"><a href="#设置Charles" class="headerlink" title="设置Charles"></a>设置Charles</h4><p>1.Proxy -&gt; SSL Proxying Settings</p>
<p>2.打开手机,开始请求</p>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Https </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android开发中常用的Adb命令]]></title>
      <url>/Android/Android%E5%BC%80%E5%8F%91%E4%B8%AD%E5%B8%B8%E7%94%A8%E7%9A%84Adb%E5%91%BD%E4%BB%A4/</url>
      <content type="html"><![CDATA[<p>在做这些之前,先配置好adb环境变量,以我的配置为例</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> vim ~/.bash_profile</span><br><span class="line"></span><br><span class="line">export ANDROID_HOME=/Users/phyooos/Library/Android/sdk</span><br><span class="line">...</span><br><span class="line">export PATH=&#123;省略&#125;:$ANDROID_HOME/tools:$ANDROID_HOME/platform-tools</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> source ~/.bas</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span> adb</span><br><span class="line">Android Debug Bridge version 1.0.39</span><br><span class="line">Version 0.0.1-4500957</span><br><span class="line">Installed as /Users/phyooos/Library/Android/sdk/platform-tools/adb</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<p>补充</p>
<blockquote>
<p>adb shell pm list packages   当前手机安装的所有app包名<br>adb shell pm list packages | grep ‘google’  在所有包名中查找带’google’的</p>
</blockquote>
<h4 id="连接设备"><a href="#连接设备" class="headerlink" title="连接设备"></a>连接设备</h4><p>打开开发者 -&gt; 打开调试 -&gt; 允许调试</p>
<ul>
<li><p>通过usb连接</p>
</li>
<li><p>通过wifi连接</p>
<p>保证Android设备与电脑在局域网中,网段好像也要一致 eg:  <code>192.168.2.98 , 192.168.2.111</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">~ ⌚ 9:44:55</span><br><span class="line"><span class="meta">$</span> adb connect 192.168.6.51</span><br><span class="line">unable to connect to 192.168.6.51:5555: Connection refused</span><br></pre></td></tr></table></figure>
<p>此时是连接不上的,要先tcpip 5555,如下:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>使用Tcp并监听端口5555</span><br><span class="line">adb tcpip 5555</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>连接设备</span><br><span class="line">adb connect 192.168.6.51</span><br></pre></td></tr></table></figure>
<p>如果你想用usb调试</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>使用usb调试  </span><br><span class="line">adb usb</span><br></pre></td></tr></table></figure>
<p>PS:有的设备直接adb connect  即可,所以不妨先试试</p>
<p>​</p>
</li>
</ul>
<h4 id="查看设备"><a href="#查看设备" class="headerlink" title="查看设备"></a>查看设备</h4><ul>
<li><p>查看所有连接的设备</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb devices</span><br><span class="line">List of devices attached</span><br><span class="line">3080b82d	device</span><br><span class="line">860BCML228J8	device</span><br></pre></td></tr></table></figure>
</li>
<li><p>指定设备(adb 命令必须指定一个设备使用)</p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">abd -s 编号 命令</span><br><span class="line">比如我要连接3080b82d	device 这个设备,安装一个apk</span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line"><span class="meta">$</span> adb -s 3080b82d install Test.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>
<h4 id="安装-卸载apk"><a href="#安装-卸载apk" class="headerlink" title="安装,卸载apk"></a>安装,卸载apk</h4><ul>
<li>安装<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb -s 3080b82d install Users/phyooos/develop/Test.apk</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>install 跟上apk的path即可</p>
<p>install 可以搭配几个参数使用,比较常用的是</p>
<p><code>install -r</code>   替换掉原来的apk.(被称为强制安装)    至于其他的参数去google官网看吧</p>
<p><code>install -t</code>  可以安装测试包</p>
<ul>
<li>卸载</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adb uninstall [软件包名]</span><br><span class="line"></span><br><span class="line">adb uninstall -k [软件包名]</span><br></pre></td></tr></table></figure>
<p>-k 参数,卸载软件但是保留配置和缓存文件.</p>
<p>包名使用文章开始的命令查找即可(当前有两个手机,还要指定设备)<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb -s 3080b82d shell pm list packages | grep 'miui'</span><br><span class="line">package:com.miui.screenrecorder</span><br><span class="line">package:com.miui.contentextension</span><br><span class="line">package:com.miui.powerkeeper</span><br><span class="line">...</span><br></pre></td></tr></table></figure></p>
<h4 id="拉取-推送文件"><a href="#拉取-推送文件" class="headerlink" title="拉取,推送文件"></a>拉取,推送文件</h4><ul>
<li>发送文件到Android设备</li>
</ul>
<p>　　<code>adb push [本地路径] [远程路径]</code></p>
<ul>
<li>从Android设备中下载文件</li>
</ul>
<p>　　<code>adb pull [远程路径] [本地路径]</code></p>
<h4 id="截图录屏"><a href="#截图录屏" class="headerlink" title="截图录屏"></a>截图录屏</h4><ul>
<li><p>截图<code>adb shell screencap [path]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell screencap /sdcard/screen.png</span><br><span class="line">#截图并保存到/sdcard/screen.png</span><br></pre></td></tr></table></figure>
</li>
<li><p>录屏<code>adb shell screenrecord [path]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">adb shell screenrecord /sdcard/demo.mp4</span><br><span class="line">#录屏</span><br></pre></td></tr></table></figure>
<p>注意:   按Ctrl-C 结束录制</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">adb shell screenrecord --size &lt;WIDTHxHEIGHT&gt;</span><br><span class="line"></span><br><span class="line">adb shell screenrecord --bit-rate &lt;RATE&gt;</span><br><span class="line">adb shell screenrecord --bit-rate 5000000 /sdcard/demo.mp4</span><br><span class="line"></span><br><span class="line">adb shell screenrecord --time-limit &lt;TIME&gt;</span><br><span class="line"></span><br><span class="line">adb shell screenrecord --rotate</span><br><span class="line"></span><br><span class="line">adb shell screenrecord --verbose</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="Package"><a href="#Package" class="headerlink" title="Package"></a>Package</h4><ul>
<li><p>查看系统内app信息  <code>adb shell pm list packages</code></p>
<ul>
<li><p>查看当前所有包</p>
<p><code>adb shell pm list packages</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb shell pm list packages</span><br><span class="line">package:com.flyme.roamingpay</span><br><span class="line">package:com.android.cts.priv.ctsshim</span><br><span class="line">package:com.meizu.pps</span><br><span class="line">package:com.meizu.net.pedometer</span><br><span class="line">package:com.android.providers.telephony</span><br></pre></td></tr></table></figure>
</li>
<li><p>系统应用</p>
<p><code>adb shell pm list packages -s</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb shell pm list packages -s</span><br><span class="line">package:com.miui.screenrecorder</span><br><span class="line">package:com.android.cts.priv.ctsshim</span><br><span class="line">package:com.qualcomm.qti.auth.sampleextauthservice</span><br><span class="line">package:com.qualcomm.qti.perfdump</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
</li>
<li><p>普通外来应用</p>
<p><code>adb shell pm list packages -3</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb shell pm list packages -3</span><br><span class="line">package:com.google.android.youtube</span><br><span class="line">package:com.hpbr.bosszhipin</span><br><span class="line">package:de.blinkt.openvpn</span><br><span class="line">package:org.iggymedia.periodtracker</span><br><span class="line">package:com.daimajia.gold</span><br></pre></td></tr></table></figure>
</li>
<li><p>其他参数</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>See their associated file.</span><br><span class="line">adb shell pm list packages -f </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Filter to only show disabled packages.</span><br><span class="line">adb shell pm list packages -d </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Filter to only show enabled packages.</span><br><span class="line">adb shell pm list packages -e </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>See the installer for the packages.</span><br><span class="line">adb shell pm list packages -i </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>Also include uninstalled packages.</span><br><span class="line">adb shell pm list packages -u</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>通过包名查找app位置 <code>adb shell pm path [packagename]</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell pm path com.miui.screenrecorder</span><br><span class="line">package:/system/app/MiuiScreenRecorder/MiuiScreenRecorder.apk</span><br></pre></td></tr></table></figure>
</li>
<li><p>清除缓存<code>adb shell pm clear  [packageName]</code></p>
<p>清除了该app的  data  cache</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell pm clear com.yhcs.carmart</span><br><span class="line">Success</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
</ul>
<h4 id="shell"><a href="#shell" class="headerlink" title="shell"></a>shell</h4><p>我们知道android其实精简了linux的命令,有一大部分linux命令没法用的</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb shell</span><br><span class="line"><span class="meta">#</span>即可进入</span><br><span class="line"></span><br><span class="line">如果要root权限,国内手机好像不一致,我是用过的为</span><br><span class="line"><span class="meta">$</span> adb root</span><br><span class="line"><span class="meta">$</span> adb shell</span><br><span class="line"></span><br><span class="line">此时权限就是root</span><br><span class="line"></span><br><span class="line">进入shell后,就可以为所欲为,一般和linux一致</span><br></pre></td></tr></table></figure>
<p>不过这些,还是管用的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ls , cd , rm , mkdir , touch , pwd ,cp , mv ,netstat , ping, ip</span><br></pre></td></tr></table></figure>
<p>举一个例子,我想查看当前wifi的ip是多少.</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span> adb shell</span><br><span class="line">sagit:/ $ ip -f inet addr show wlan0</span><br><span class="line">23: wlan0: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc mq state UP group default qlen 3000</span><br><span class="line">    inet 192.168.6.51/23 brd 192.168.7.255 scope global wlan0</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">sagit:/ $</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>ip  inet 192.168.6.51  这个就是</span><br></pre></td></tr></table></figure>
<h4 id="Logcat"><a href="#Logcat" class="headerlink" title="Logcat"></a>Logcat</h4><p><code>adb logcat [option] [filter]</code></p>
<ul>
<li><p>查看log <code>adb logcat</code></p>
<p>通过  control + c  退出</p>
<p>​</p>
</li>
<li><p>查看Debug的log <code>adb logcat *:D</code></p>
</li>
</ul>
<p>Logcat,还是Android studio 看起来方便,所以没有继续去看,也就不说了</p>
<h4 id="dumpsys"><a href="#dumpsys" class="headerlink" title="dumpsys"></a>dumpsys</h4><p>这是一个很强大的命令</p>
<ul>
<li><p>电量 <code>adb shell dumpsys battery</code></p>
<p>​</p>
</li>
<li><p>服务列表 <code>adb shell dumpsys</code></p>
<p>下面的命令  <code>| more</code> 是为了显示所有的数据 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys | more</span><br><span class="line">Currently running services:</span><br><span class="line">  DockObserver</span><br><span class="line">  MiuiBackup</span><br><span class="line">  MiuiInit</span><br><span class="line">  SurfaceFlinger</span><br><span class="line">  accessibility</span><br><span class="line">  account</span><br><span class="line">  activity</span><br><span class="line">  alarm</span><br><span class="line">  ...</span><br></pre></td></tr></table></figure>
<p>这个Currently running services   所有的项目,都可以详细查询</p>
</li>
<li><p>查询单个service  <code>adb shell dumpsys [service name]</code></p>
<p>搞几个例子看看:</p>
<ul>
<li>屏幕分辨率<code>adb shell dumpsys window displays</code></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys window displays</span><br><span class="line"></span><br><span class="line">WINDOW MANAGER DISPLAY CONTENTS (dumpsys window displays)</span><br><span class="line">  Display: mDisplayId=0</span><br><span class="line">    init=1080x1920 480dpi cur=1080x1920 app=1080x1920 rng=1080x1020-1920x1860</span><br><span class="line">    deferred=false mLayoutNeeded=false</span><br></pre></td></tr></table></figure>
<p>其中:</p>
<p>init=1080x1920  分辨率</p>
<p>480dpi   dpi值</p>
<p>​</p>
<ul>
<li><p>activity信息<code>adb shell dumpsys activity</code></p>
<p>比如我想看看我activity的信息<code>adb shell dumpsys activity | grep &#39;com.yhcs.carmart&#39;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys activity | grep &quot;com.yhcs.carmart&quot;</span><br><span class="line">  * com.yhcs.carmart: 2 items</span><br><span class="line">    #0: PendingIntentRecord&#123;c526be3 com.yhcs.carmart startService&#125;</span><br><span class="line">    #1: PendingIntentRecord&#123;8949e0 com.yhcs.carmart broadcastIntent&#125;</span><br><span class="line">      -&gt; 8161:com.yhcs.carmart/u0a460 s1/1 u0/0 +44s372ms</span><br><span class="line">      -&gt; 8556:com.yhcs.carmart:channel/u0a460 s1/1 u0/0 +33s684ms</span><br><span class="line">      </span><br><span class="line">      ...</span><br><span class="line">      </span><br><span class="line">  * Recent #0: TaskRecord&#123;6019b81 #14799 A=com.yhcs.carmart U=0 StackId=1 sz=1&#125;</span><br><span class="line">   packageName=com.yhcs.carmart processName=com.yhcs.carmart</span><br><span class="line">   launchedFromUid=10460 launchedFromPackage=com.yhcs.carmart userId=0</span><br><span class="line">   app=ProcessRecord&#123;3c52934 8161:com.yhcs.carmart/u0a460&#125;</span><br><span class="line">   Intent &#123; cmp=com.yhcs.carmart/.ui.main.MainActivity &#125;</span><br><span class="line">   frontOfTask=true task=TaskRecord&#123;6019b81 #14799 A=com.yhcs.carmart U=0 StackId=1 sz=1&#125;</span><br><span class="line">   taskAffinity=com.yhcs.carmart</span><br><span class="line">   realActivity=com.yhcs.carmart/.ui.main.MainActivity</span><br></pre></td></tr></table></figure>
<p>现在指定查看这个activity</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ adb shell dumpsys activity com.yhcs.carmart/.ui.main.MainActivity</span><br><span class="line">TASK com.yhcs.carmart id=14799 userId=0</span><br><span class="line">  ACTIVITY com.yhcs.carmart/.ui.main.MainActivity a99200b pid=8161</span><br><span class="line">    Local Activity 90efa41 State:</span><br><span class="line">      mResumed=false mStopped=true mFinished=false</span><br><span class="line">      mChangingConfigurations=false</span><br><span class="line">      mCurrentConfig=&#123;1.0 460mcc11mnc [zh_CN] ldltr sw360dp w360dp h620dp 480dpi nrml long port finger -keyb/v/h -nav/h appBounds=Rect(0, 0 - 1080, 1920) s.12 themeChanged=0 themeChangedFlags=0&#125;</span><br><span class="line">      ...</span><br><span class="line">View Hierarchy:</span><br><span class="line">      DecorView@ce71c9e[MainActivity]</span><br><span class="line">        android.widget.LinearLayout&#123;6106377 V.E...... ......ID 0,0-1080,1920&#125;</span><br><span class="line">      ...</span><br><span class="line">Active Fragments </span><br><span class="line">	  ...</span><br></pre></td></tr></table></figure>
<p>里面有很多信息</p>
<p>​</p>
</li>
</ul>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[OkHttp中添加https支持]]></title>
      <url>/uncategorized/OkHttp%E4%B8%AD%E6%B7%BB%E5%8A%A0https%E6%94%AF%E6%8C%81/</url>
      <content type="html"><![CDATA[<p><strong>基础知识</strong></p>
<p>感觉就是一堆有信誉的机构,说: 我们这些机构的公钥是可信的,我们下面的小弟当然也是可以信任的啦</p>
<p>然后大家就去当人家小弟,就是可信的了….</p>
<p>当然这里面有的大佬不高兴,就自己搞一套证书,比如12306</p>
<p>Https中,值得注意的密钥有:</p>
<ul>
<li>服务器端的<code>公钥</code>和<code>私钥</code></li>
</ul>
<ul>
<li>客户端的<code>随机密钥</code></li>
</ul>
<p>值得注意的是一个HTTPS请求实际上就是两次HTTP传输.</p>
<p>1.客户端向服务器发起HTTPS请求，连接到服务器的443端口。</p>
<p>2.服务端收到请求,向客户端发送自己的<code>公钥</code></p>
<p>3.客户端收到服务器公钥,开始验证证书的合法性,我们知道系统内置了一些证书,应该是叫顶级证书吧</p>
<p>我们的证书并不是啥大机构发的,肯定不在里面,那么就没法验证合法.</p>
<p>​     合法 &gt; 继续</p>
<p>​     不合法 &gt; 此次Https请求终止</p>
<p>4.客户端验证公钥合格后(也就是给你发消息的服务器是正经服务器)，那么客户端会生成一个 随机密码,客户端会拿着这个随机密码和刚才收到的服务器密钥做非对称加密 &gt;&gt; 得到密文的密码</p>
<p>——–以上第一次http请求结束了——–</p>
<p>5.客户端会发起HTTPS中的第二个HTTP请求,发送客户端密钥(密文)给服务器。</p>
<p>6.服务器收到密文，会用自己的私钥对其进行非对称解密,得到客户端刚才生成的客户端随机密码.</p>
<p>此时服务器使用客户端随机密码,对数据进行对称加密</p>
<p>7.把对称加密后的数据返回给客户端,客户端对称解密,OK    此次Https完美结束</p>
<p>——–整个https请求结束了——–</p>
<p>其中 , <code>对称加密</code>和<code>非对称加密</code>,  各司其职,共同完成整个请求.</p>
<p>  对称加密: 最快速,最简单</p>
<p>  非对称加密:速度慢,很安全,不需要把秘钥分发,客户端利用公钥加密的数据,只能是拥有秘钥的服务器解密</p>
<p>利用非对称加密的特性传递  客户端生成的随机密钥 ,达到只有服务器和客户端互相知道的密钥,从而使用密钥进行(高速简单的)对称加密数据.</p>
<p><strong>第一部分:信任所有</strong></p>
<p>这就是,我不管是谁传递的消息,不是你家服务器传递的消息,你也会信</p>
<p><strong>Api.java</strong> (提供okhttp实例,并创建Retroit服务)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient okHttpClient = new OkHttpClient.Builder()</span><br><span class="line">               .hostnameVerifier(new HostnameVerifier() &#123;</span><br><span class="line">                   @Override</span><br><span class="line">                   public boolean verify(String hostname, SSLSession session) &#123;</span><br><span class="line">                       return true;</span><br><span class="line">                   &#125;</span><br><span class="line">               &#125;)</span><br><span class="line">               .sslSocketFactory(createSSLSocketFactory())</span><br><span class="line">               .build();</span><br><span class="line">               </span><br><span class="line">...</span><br><span class="line"></span><br><span class="line">//这里是创建一个SSLSocketFactory,提供给上面的 .sslSocketFactory()</span><br><span class="line">private  SSLSocketFactory createSSLSocketFactory() &#123;</span><br><span class="line">       SSLSocketFactory ssfFactory = null;</span><br><span class="line">       try &#123;</span><br><span class="line">           SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);</span><br><span class="line">           sc.init(null, new TrustManager[]&#123;new TrustAllCerts()&#125;, new SecureRandom());</span><br><span class="line">           ssfFactory = sc.getSocketFactory();</span><br><span class="line">       &#125; catch (Exception e) &#123;</span><br><span class="line">       &#125;</span><br><span class="line"></span><br><span class="line">       return ssfFactory;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p>其中涉及到<strong>TrustAllCerts.java</strong>,可以看到只是实现X509TrustManager,所有方法都是默认实现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2018/1/8 下午2:25</span><br><span class="line"> */</span><br><span class="line">public class TrustAllCerts implements X509TrustManager &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void checkClientTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void checkServerTrusted(X509Certificate[] chain, String authType) throws CertificateException &#123;&#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public X509Certificate[] getAcceptedIssuers() &#123;</span><br><span class="line">        return new X509Certificate[0];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这里就以及可以了,信任所有的连接</p>
<hr>
<p><strong>第二部分:(强验证)</strong></p>
<p>我只信任证书合法的服务器传递的数据.</p>
<ul>
<li>查看Https的证书</li>
</ul>
<p><img src="images/https_zhengshu.png" alt="https证书"></p>
<p>在浏览器上看到这个,这个已经是我把证书添加为信任了,所以他是一个 <code>安全</code> 的标志</p>
<ul>
<li>分析</li>
</ul>
<p><img src="images/https_root.png" alt="https证书"></p>
<p>这里是我查看当前网站证书的结构</p>
<p>最顶—是根证书,到期时间是2028年</p>
<p>最底—是我司证书,到期时间是2018.12.9日</p>
<p>这里我们可以发现,我们网站的证书是有时间限制的,那么就会有一个问题,到了2018.12.9这一天怎么办.</p>
<blockquote>
<p>我也不知道会怎么样,应该是续签吧!那么万一这个证书变化了怎么办?</p>
</blockquote>
<p>所以,我们应该把根证书置为信任.</p>
<ul>
<li>下载保存</li>
</ul>
<p><img src="images/https_save.png" alt="https证书"></p>
<p>Mac的在  钥匙串访问  中</p>
<p>Windows 没法放图,在chrome上查看证书的时候应该就能保存.</p>
<p><strong>HttpsUtils.java </strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2018/1/10 下午5:07</span><br><span class="line"> * 支持https的工具类</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class HttpsUtils &#123;</span><br><span class="line">    private static final String TAG = &quot;OkHttp&quot;;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 创建一个空白的KeyStore</span><br><span class="line">     * @return KeyStore</span><br><span class="line">     * @throws GeneralSecurityException</span><br><span class="line">     */</span><br><span class="line">    private static KeyStore createEmptyKeyStore() throws GeneralSecurityException &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            KeyStore keystore = KeyStore.getInstance(KeyStore.getDefaultType());</span><br><span class="line">            //此处密码随意,不会产生问题</span><br><span class="line">            keystore.load(null, &quot;password&quot;.toCharArray());</span><br><span class="line">            return keystore;</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * TrustManager  生成</span><br><span class="line">     * @return</span><br><span class="line">     * @throws GeneralSecurityException</span><br><span class="line">     */</span><br><span class="line">    private static TrustManager[] generateTrustManager() throws GeneralSecurityException &#123;</span><br><span class="line"></span><br><span class="line">        //创建一个X.509格式的CertificateFactory</span><br><span class="line">        CertificateFactory certificateFactory = CertificateFactory.getInstance(&quot;X.509&quot;);</span><br><span class="line"></span><br><span class="line">        Certificate ca;</span><br><span class="line">        //证书工厂根据证书文件的流生成证书Certificate</span><br><span class="line">        InputStream assets = App.getContext().getResources().openRawResource(R.raw.rootca);</span><br><span class="line">        ca = certificateFactory.generateCertificate(assets);</span><br><span class="line">        Log.e(TAG, &quot;trustManager: ca = &quot; + ((X509Certificate) ca).getSubjectDN() );</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //创建KeyStore，用来存储信任证书</span><br><span class="line">        KeyStore keyStor = createEmptyKeyStore();</span><br><span class="line">        keyStor.setCertificateEntry(&quot;ca&quot;,ca);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        //创建一个默认类型的TrustManagerFactory</span><br><span class="line">        String defaultAlgorithm = TrustManagerFactory.getDefaultAlgorithm();</span><br><span class="line">        TrustManagerFactory tmf = TrustManagerFactory.getInstance(defaultAlgorithm);</span><br><span class="line"></span><br><span class="line">        //用keyStore实例初始化TrustManagerFactory,此时TrustManagerFactory会信任我们保存的证书</span><br><span class="line">        tmf.init(keyStor);</span><br><span class="line"></span><br><span class="line">        //通过tmf获取TrustManager数组，TrustManager也会信任keyStor中的证书</span><br><span class="line"></span><br><span class="line">        return tmf.getTrustManagers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 提供一个一个SSLSocketFactory</span><br><span class="line">     * @return SSLSocketFactory实例</span><br><span class="line">     */</span><br><span class="line">    public static SSLSocketFactory generateSSLSocketFactory()  &#123;</span><br><span class="line">        try &#123;</span><br><span class="line">            SSLContext sc = SSLContext.getInstance(&quot;TLS&quot;);</span><br><span class="line">            sc.init(null, generateTrustManager(), new SecureRandom());</span><br><span class="line">            Log.e(TAG, &quot;generateSSLSocketFactory &quot;);</span><br><span class="line">            return sc.getSocketFactory();</span><br><span class="line">        &#125; catch (GeneralSecurityException e) &#123;</span><br><span class="line">            return null;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注释很清楚了.</p>
<p><strong>关键:</strong></p>
<p>1.拿到帧数的流</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputStream assets = App.getContext().getResources().openRawResource(R.raw.rootca);</span><br></pre></td></tr></table></figure>
<p>2.保存到keystore</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">KeyStore keyStor = createEmptyKeyStore();</span><br><span class="line">keyStor.setCertificateEntry(&quot;ca&quot;,ca);</span><br></pre></td></tr></table></figure>
<p>3.初始化并拿到TrustManager[]</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">tmf.init(keyStor);</span><br><span class="line">tmf.getTrustManagers()</span><br></pre></td></tr></table></figure>
<p><strong>使用即可:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">//这样就Ok</span><br><span class="line">OkHttpClient okHttpClient = new OkHttpClient.Builder()</span><br><span class="line">                .hostnameVerifier((hostname, session) -&gt; true)</span><br><span class="line">                .sslSocketFactory(HttpsUtils.generateSSLSocketFactory())</span><br><span class="line">                .build();</span><br></pre></td></tr></table></figure>
<blockquote>
<p>超好的两篇</p>
<p><a href="http://blog.csdn.net/lmj623565791/article/details/48129405" target="_blank" rel="noopener">http://blog.csdn.net/lmj623565791/article/details/48129405</a></p>
<p><a href="http://blog.csdn.net/iispring/article/details/51615631" target="_blank" rel="noopener">http://blog.csdn.net/iispring/article/details/51615631</a></p>
</blockquote>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[WebView播放H5视屏没有画面,只有声音]]></title>
      <url>/Bug/WebView%E6%92%AD%E6%94%BEH5%E8%A7%86%E5%B1%8F%E6%B2%A1%E6%9C%89%E7%94%BB%E9%9D%A2-%E5%8F%AA%E6%9C%89%E5%A3%B0%E9%9F%B3/</url>
      <content type="html"><![CDATA[<p><strong>描述:点击播放按钮后,只能听到声音,而画面是白的….一直白…想到应该是硬件加速的问题</strong></p>
<p><strong>1.确认硬件加速(非此因素)</strong></p>
<p>在WebViewActivity.java中发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">webView.setLayerType(View.LAYER_TYPE_HARDWARE, null);</span><br></pre></td></tr></table></figure>
<p><strong>2.确认AndroidManifest.xml(非此因素)</strong></p>
<p>application节点下并没有发现</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android:hardwareAccelerated=&quot;true&quot;</span><br></pre></td></tr></table></figure>
<p>在WebViewActivity中,也无该配置</p>
<ul>
<li>尝试: WebViewActivity.java中,注释</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#webView.setLayerType(View.LAYER_TYPE_HARDWARE, null);</span><br></pre></td></tr></table></figure>
<p>在AndroidManifest.xml节点下加入<code>android:hardwareAccelerated=&quot;true&quot;</code></p>
<ul>
<li>结果……没用</li>
</ul>
<p><strong>3.检查activity_web_view.xml</strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:id</span>=<span class="string">"@+id/webView"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:scrollbars</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:visibility</span>=<span class="string">"@&#123;showError?View.GONE:View.VISIBLE&#125;"</span> /&gt;</span></span><br></pre></td></tr></table></figure>
<p>没问题.</p>
<p>BUT….</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">LinearLayout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layerType</span>=<span class="string">"software"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">android:orientation</span>=<span class="string">"vertical"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">include</span> <span class="attr">layout</span>=<span class="string">"@layout/layout_toolbar"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">ProgressBar</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/web_load_progress"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">style</span>=<span class="string">"?android:attr/progressBarStyleHorizontal"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"2dp"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:indeterminateOnly</span>=<span class="string">"false"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:max</span>=<span class="string">"100"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:progress</span>=<span class="string">"@&#123;progress&#125;"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:progressDrawable</span>=<span class="string">"@drawable/progress_bar_states"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"gone"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">WebView</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:id</span>=<span class="string">"@+id/webView"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:scrollbars</span>=<span class="string">"none"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:visibility</span>=<span class="string">"@&#123;showError?View.GONE:View.VISIBLE&#125;"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">LinearLayout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>####父布局竟然<code>android:layerType=&quot;software&quot;</code></p>
<ul>
<li>解决,删掉该属性即可</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Bug </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Bug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Room中List<>使用详解]]></title>
      <url>/Android/Room%E4%B8%ADList-%E4%BD%BF%E7%94%A8%E8%AF%A6%E8%A7%A3/</url>
      <content type="html"><![CDATA[<blockquote>
<p>手摸手教你在Room中使用List<object>.</object></p>
</blockquote>
<p>实际项目有很多这样的结构:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  &quot;id&quot;: &quot;001&quot;,</span><br><span class="line">  &quot;name&quot;: &quot;王诛魔&quot;,</span><br><span class="line">  &quot;age&quot;: 2018,</span><br><span class="line">  &quot;books&quot;: [</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;bookId&quot;: 10081,</span><br><span class="line">      &quot;userId&quot;: 1,</span><br><span class="line">      &quot;book&quot;: &quot;断罪小学&quot;,</span><br><span class="line">      &quot;desc&quot;: &quot;漫画讲述了李杀神、王诛魔和刘斩仙三位少年，为了十万小学生的未来、为了改变被诅咒的命运，相聚在狼牙区飞虎路私立断罪小学，誓死打败四年级的魔神赵日天的故事。&quot;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      &quot;bookId&quot;: 10088,</span><br><span class="line">      &quot;userId&quot;: 1,</span><br><span class="line">      &quot;book&quot;: &quot;狂霸天下之断罪学园&quot;,</span><br><span class="line">      &quot;desc&quot;: &quot;《狂霸天下之断罪学园》，后来因为名字太长，而且“学园”和“学院”容易混淆的原因而改名。&quot;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也就是,类似books这样的,List<object>作为一个元素存在.</object></p>
<blockquote>
<p>下面就以上面的结构为例,做一个简单的演示,按照最简答的方法实现.</p>
</blockquote>
<p><strong>1.添加依赖</strong></p>
<p><a href="https://developer.android.google.cn/topic/libraries/architecture/adding-components.html" target="_blank" rel="noopener">https://developer.android.google.cn/topic/libraries/architecture/adding-components.html</a></p>
<p>值得注意的是,如果你在kotlin中使用</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: <span class="string">'kotlin-kapt'</span></span><br><span class="line">...</span><br><span class="line">dependencies&#123;</span><br><span class="line">  </span><br><span class="line">  ...</span><br><span class="line">  	<span class="comment">//这个无法生成代码,要用下面的那一条,不要疏忽忘掉了.</span></span><br><span class="line">    <span class="comment">//annotationProcessor "android.arch.persistence.room:compiler:1.0.0"</span></span><br><span class="line">    </span><br><span class="line">    kapt <span class="string">"android.arch.persistence.room:compiler:1.0.0"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>一定记得使用kapt,要不然就会遇到这个BUG.</p>
<p><strong>2.创建表</strong></p>
<ul>
<li><p>User.java表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 王诛魔 2018/1/3 下午1:31</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span>(tableName = <span class="string">"users"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Entity 中指定了表名</p>
<p>@PrimaryKey 主键</p>
<p>这张表users 用于保存用户数据</p>
</li>
</ul>
<ul>
<li><p>Book.java表</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 王诛魔 2018/1/3 下午1:30</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Entity</span>(foreignKeys = &#123;</span><br><span class="line">        <span class="meta">@ForeignKey</span>(</span><br><span class="line">                entity = User.class,</span><br><span class="line">                parentColumns =&#123;<span class="string">"id"</span>&#125;,</span><br><span class="line">                childColumns = &#123;<span class="string">"userId"</span>&#125;)</span><br><span class="line">&#125;,tableName = <span class="string">"books"</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Book</span> </span>&#123;</span><br><span class="line">    <span class="meta">@PrimaryKey</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> bookId;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> userId;<span class="comment">//同User.java中的id</span></span><br><span class="line">    <span class="keyword">public</span> String book;</span><br><span class="line">    <span class="keyword">public</span> String desc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Entity 中</p>
<ul>
<li>foreignKeys = {} 中外键,可以是多个,这里只关联了User表</li>
<li>tableName = “books” 指定了表名</li>
</ul>
<p>@PrimaryKey 该表主键</p>
<p>​</p>
<p>​</p>
</li>
<li><p>UserAndBook.java表 —-UserAndBook只是辅助,不作为一张表存在.</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 王诛魔 2018/1/3 下午1:43</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAndBook</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Embedded</span>   <span class="comment">//请看之前的文章,这是指把User中所有元素带入到这里作为元素存在</span></span><br><span class="line">    <span class="keyword">public</span> User userEntity;</span><br><span class="line"></span><br><span class="line">  	<span class="comment">//@Relation</span></span><br><span class="line">    <span class="meta">@Relation</span>(parentColumn = <span class="string">"id"</span>,entityColumn = <span class="string">"userId"</span>,entity = Book.class)</span><br><span class="line">    <span class="keyword">public</span> List&lt;Book&gt; books;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>@Embedded   请看另一篇,有解释</p>
<p>​</p>
<p>@Relation <a href="https://developer.android.google.cn/reference/android/arch/persistence/room/Relation.html" target="_blank" rel="noopener"> 点这里去看官方文档  </a></p>
<blockquote>
<p>A convenience annotation which can be used in a Pojo to automatically fetch relation entities. When the Pojo is returned from a query, all of its relations are also fetched by Room.</p>
</blockquote>
<p>个人以为就是一注解,指明关系,可以把实体关联起来,然后自动组装起来.   </p>
<p>​</p>
<p>并且在文档中还展示了一种高端的功能,用上面做例</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//@Relation</span></span><br><span class="line">    <span class="meta">@Relation</span>(parentColumn = <span class="string">"id"</span>,entityColumn = <span class="string">"userId"</span>,</span><br><span class="line">              entity = Book.class ,projection = &#123;<span class="string">"book"</span>&#125;)</span><br><span class="line">    <span class="keyword">public</span> List&lt;String&gt; bookNames;</span><br></pre></td></tr></table></figure>
<p>解释一下,projection指定了要取出的值,当前指明要在 books表中寻找符合条件parentColumn = “id”,entityColumn = “userId”   的项,找到之后会拿到book这个值并返回.</p>
</li>
</ul>
<p><strong>3.Dao实现</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 王诛魔 2018/1/3 下午4:20</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Dao</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">UserAndBookDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(onConflict = OnConflictStrategy.REPLACE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(User user)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Insert</span>(onConflict = OnConflictStrategy.REPLACE)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(List&lt;Book&gt; books)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transaction</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">(UserAndBook userAndBook)</span></span>&#123;</span><br><span class="line">        insert(userAndBook.userEntity);</span><br><span class="line">        insert(userAndBook.books);</span><br><span class="line">    &#125;</span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Query</span>(<span class="string">"SELECT * FROM users"</span>)</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> List&lt;UserAndBook&gt; <span class="title">getAll</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>insert(User user);</code>  ,<code>insert(List&lt;Book&gt; books);</code></p>
<p>两个方法,也可以私有化,只对外提供<code>insert(UserAndBook userAndBook)</code></p>
<p>最近换公司项目的数据库,用sql,真的有意思,可以很方便的实现很多功能</p>
<p><strong>4.建立数据库</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> 王诛魔 2017/10/24 上午10:13</span></span><br><span class="line"><span class="comment"> * 数据库</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Database</span>(entities = &#123;Book.class, User.class&#125;, </span><br><span class="line">          version = <span class="number">1</span>, exportSchema = <span class="keyword">false</span>)</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">AppDB</span> <span class="keyword">extends</span> <span class="title">RoomDatabase</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String TAG = <span class="string">"AppDB"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据库实例</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> AppDB sInstance;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> String DATABASE_NAME = <span class="string">"developer.db"</span>;</span><br><span class="line">    <span class="keyword">private</span> ObservableBoolean mIsDatabaseCreated = <span class="keyword">new</span> ObservableBoolean(<span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">  	</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> UserAndBookDao <span class="title">userbook</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 单例</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppDB <span class="title">getInstance</span><span class="params">(Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (AppDB.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (sInstance == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    sInstance = buildDatabase(context);</span><br><span class="line">                    sInstance.updateDatabaseCreated(context);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build the database.</span></span><br><span class="line"><span class="comment">     * creates a new instance of the database.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> AppDB <span class="title">buildDatabase</span><span class="params">(Context appContext)</span> </span>&#123;</span><br><span class="line">         AppDB appDB = Room.databaseBuilder(appContext, AppDB.class, DATABASE_NAME)</span><br><span class="line">                .addCallback(<span class="keyword">new</span> Callback() &#123;</span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCreate</span><span class="params">(@NonNull SupportSQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.onCreate(db);</span><br><span class="line">                        AppDB database = AppDB.getInstance(appContext);</span><br><span class="line">                        database.setDatabaseCreated();</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    <span class="meta">@Override</span></span><br><span class="line">                    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onOpen</span><span class="params">(@NonNull SupportSQLiteDatabase db)</span> </span>&#123;</span><br><span class="line">                        <span class="keyword">super</span>.onOpen(db);</span><br><span class="line">                        Log.e(TAG, <span class="string">"onOpen: "</span> + db.getPath());</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;).build();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> appDB;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Check whether the database already exists and expose it via </span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">updateDatabaseCreated</span><span class="params">(<span class="keyword">final</span> Context context)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (context.getDatabasePath(DATABASE_NAME).exists()) &#123;</span><br><span class="line">            setDatabaseCreated();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">setDatabaseCreated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        mIsDatabaseCreated.set(<span class="keyword">true</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ObservableBoolean <span class="title">getDatabaseCreated</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> mIsDatabaseCreated;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为了方便使用,在Application中添加了</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> AppDB <span class="title">getDatabase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> AppDB.getInstance(context);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>5.使用</strong></p>
<p>这里的使用方式,不建议使用,太粗暴了.</p>
<p>可以学学Demo,Google出的<a href="https://github.com/googlesamples/android-architecture-components" target="_blank" rel="noopener">googlesamples/android-architecture-components</a></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line">class RoomActivity : BindingActivity&lt;ActivityRoomBinding, RoomViewModel&gt;() &#123;</span><br><span class="line">    val gson = Gson()</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">getBundle</span><span class="params">(extras: Bundle)</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">layoutID</span><span class="params">()</span>: Int </span>= R.layout.activity_room</span><br><span class="line"></span><br><span class="line">    <span class="function">override fun <span class="title">initViews</span><span class="params">(savedInstanceState: Bundle?)</span> </span>&#123;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//点击事件  ADD按钮,添加数据到数据库</span></span><br><span class="line">        mBindingView.button.setOnClickListener(&#123;</span><br><span class="line">            val userBook = UserAndBook()</span><br><span class="line">            val jsonStr = FileUtils.getJson(<span class="keyword">this</span>, <span class="string">"data.txt"</span>)</span><br><span class="line">            val objectJson = JsonParser().parse(jsonStr).asJsonObject</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取用户</span></span><br><span class="line">            val user = objectJson.get(<span class="string">"user"</span>)</span><br><span class="line">            userBook.userEntity = gson.fromJson&lt;User&gt;(user, User::<span class="class"><span class="keyword">class</span>.<span class="title">java</span>)</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">            //保存用户</span></span><br><span class="line"><span class="class">            <span class="title">Observable</span></span></span><br><span class="line"><span class="class">            	.<span class="title">empty</span>&lt;<span class="title">Any</span>&gt;()</span></span><br><span class="line"><span class="class">            	.<span class="title">observeOn</span>(<span class="title">Schedulers</span>.<span class="title">io</span>())</span></span><br><span class="line">            	.subscribe(object : EmptyObserver&lt;Any?&gt;() &#123;</span><br><span class="line">                	<span class="function">override fun <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    	App.getDatabase().userbook().insert(userBook.userEntity)</span><br><span class="line">                	&#125;</span><br><span class="line">            	&#125;)</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取书籍</span></span><br><span class="line">            val books = objectJson.get(<span class="string">"books"</span>)</span><br><span class="line">            userBook.books = gson.fromJson&lt;ArrayList&lt;Book&gt;&gt;</span><br><span class="line">            					(books, object : TypeToken&lt;List&lt;Book&gt;&gt;() &#123;&#125;.type)</span><br><span class="line">            <span class="comment">//保存书籍</span></span><br><span class="line">            Observable</span><br><span class="line">            	.empty&lt;Any&gt;()</span><br><span class="line">            	.observeOn(Schedulers.io())</span><br><span class="line">            	.subscribe(object : EmptyObserver&lt;Any?&gt;() &#123;</span><br><span class="line">               		 <span class="function">override fun <span class="title">onComplete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                    	App.getDatabase().userbook().insert(userBook.books)</span><br><span class="line">                	&#125;</span><br><span class="line">            	&#125;)</span><br><span class="line">        &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">		<span class="comment">//点击事件,按钮QUERY   查询数据</span></span><br><span class="line">        mBindingView.button2.setOnClickListener &#123;</span><br><span class="line">            Flowable.create(FlowableOnSubscribe&lt;List&lt;UserAndBook&gt;&gt; &#123; e -&gt;</span><br><span class="line">                val userBook = App.getDatabase().userbook().all</span><br><span class="line">                e.onNext(userBook)</span><br><span class="line">                e.onComplete()</span><br><span class="line">            &#125;, BackpressureStrategy.DROP)</span><br><span class="line">                    .compose(DatabaseTransformer())</span><br><span class="line">                    .subscribe(object : DatabaseSubscriber&lt;List&lt;UserAndBook&gt;&gt;() &#123;</span><br><span class="line">                        <span class="function">override fun <span class="title">onNext</span><span class="params">(userAndBooks: List&lt;UserAndBook&gt;)</span> </span>&#123;</span><br><span class="line">                            mBindingView.data = userAndBooks[<span class="number">0</span>]</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span><br><span class="line"><span class="tag">&lt;<span class="name">layout</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:android</span>=<span class="string">"http://schemas.android.com/apk/res/android"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">data</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.wangzhumo.app.data.UserAndBook"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.wangzhumo.app.data.User"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">import</span> <span class="attr">type</span>=<span class="string">"com.wangzhumo.app.data.Book"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">variable</span></span></span><br><span class="line"><span class="tag">            <span class="attr">name</span>=<span class="string">"data"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">type</span>=<span class="string">"com.wangzhumo.app.data.UserAndBook"</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">data</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">        <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentLeft</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentTop</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginLeft</span>=<span class="string">"57dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginStart</span>=<span class="string">"57dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">"125dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Add"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">Button</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:id</span>=<span class="string">"@+id/button2"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignBaseline</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignBottom</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentEnd</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentRight</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginEnd</span>=<span class="string">"56dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginRight</span>=<span class="string">"56dp"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:text</span>=<span class="string">"Query"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">RelativeLayout</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_width</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_height</span>=<span class="string">"match_parent"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentLeft</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_below</span>=<span class="string">"@+id/button"</span></span></span><br><span class="line"><span class="tag">            <span class="attr">android:layout_marginTop</span>=<span class="string">"68dp"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/textView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentLeft</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentStart</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignParentTop</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginLeft</span>=<span class="string">"36dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginStart</span>=<span class="string">"36dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"32dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"@&#123;data.userEntity.name&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/textView2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignLeft</span>=<span class="string">"@+id/textView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignStart</span>=<span class="string">"@+id/textView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_below</span>=<span class="string">"@+id/textView"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_marginTop</span>=<span class="string">"41dp"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"@&#123;data.books.get(0).book&#125;"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">            <span class="tag">&lt;<span class="name">TextView</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:id</span>=<span class="string">"@+id/textView3"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_width</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_height</span>=<span class="string">"wrap_content"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignLeft</span>=<span class="string">"@+id/textView2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_alignStart</span>=<span class="string">"@+id/textView2"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:layout_centerVertical</span>=<span class="string">"true"</span></span></span><br><span class="line"><span class="tag">                <span class="attr">android:text</span>=<span class="string">"@&#123;data.books.get(0).desc&#125;"</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">RelativeLayout</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p><img src="images/room_shot.png" alt="如图"></p>
<p>​    </p>
<p>​     </p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Room </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android字体不跟随系统变化]]></title>
      <url>/Android/Android%E5%AD%97%E4%BD%93%E4%B8%8D%E8%B7%9F%E9%9A%8F%E7%B3%BB%E7%BB%9F%E5%8F%98%E5%8C%96/</url>
      <content type="html"><![CDATA[<p>已知的方法有两种:</p>
<p><strong>第一种</strong></p>
<p>不使用sp 而使用 dp</p>
<p><strong>第二种</strong></p>
<p>在Application中加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public void onConfigurationChanged(Configuration newConfig) &#123;</span><br><span class="line">    if (newConfig.fontScale != 1)</span><br><span class="line">        getResources();</span><br><span class="line">    super.onConfigurationChanged(newConfig);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@Override</span><br><span class="line">public Resources getResources() &#123;</span><br><span class="line">     Resources res = super.getResources();</span><br><span class="line">     if (res.getConfiguration().fontScale != 1) &#123;</span><br><span class="line">        Configuration newConfig = new Configuration();</span><br><span class="line">        newConfig.setToDefaults();</span><br><span class="line">        res.updateConfiguration(newConfig, res.getDisplayMetrics()); </span><br><span class="line">     &#125;</span><br><span class="line">     return res;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Apk Install 的各种问题]]></title>
      <url>/Bug/Apk-Install-%E7%9A%84%E5%90%84%E7%A7%8D%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p><strong>[INSTALL_FAILED_TEST_ONLY: installPackageLI]</strong></p>
<ul>
<li><p>方法1：<br>AndroidManifest.xml 加入android:testOnly=”false”。</p>
</li>
<li><p>方法2：<br>adb install -t *.apk</p>
</li>
</ul>
]]></content>
      
        <categories>
            
            <category> Bug </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Bug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio报错Error Running app: cannot debug application]]></title>
      <url>/Bug/Android-Studio%E6%8A%A5%E9%94%99Error-Running-app-cannot-debug-application/</url>
      <content type="html"><![CDATA[<p>Android Studio报错Error Running app: cannot debug application</p>
<p>这里有一位仁兄帮忙翻译了.</p>
<blockquote>
<p><a href="http://blog.csdn.net/yishichangan1/article/details/77451486" target="_blank" rel="noopener">http://blog.csdn.net/yishichangan1/article/details/77451486</a></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">Cannot debug application xx.xxx.xxx.app on device lge_nexus_5x(此处表示你的手机型号).</span><br><span class="line">你的xxxapp不能在型号为Nexus 5x的LGE手机上调试。</span><br><span class="line"></span><br><span class="line">This application does not have the debuggable attribute enabled in its manifest.</span><br><span class="line">这个项目在清单文件（AndroidManifest.xml）中没有设置可以调试的参数。</span><br><span class="line"></span><br><span class="line">If you have manually set it in the manifest, then remove it and let the IDE automatically assign it.</span><br><span class="line">如果你已经手动在清单文件种设置了这个属性，请remove掉，让IDE自动生成。</span><br><span class="line"></span><br><span class="line">If you are using Gradle, make sure that your current variant is debuggable.</span><br><span class="line">如果你使用Gradle，确认你现在的变体是可调试的。</span><br></pre></td></tr></table></figure>
<p>####我就知道是我自己选了release….果然</p>
<p><img src="/images/canot_debug.png" alt="cannotdebug"></p>
]]></content>
      
        <categories>
            
            <category> Bug </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Studio </tag>
            
            <tag> Bug </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Centos 创建用户并实现免密码登录]]></title>
      <url>/Server/Centos%20%E5%88%9B%E5%BB%BA%E7%94%A8%E6%88%B7%E5%B9%B6%E5%AE%9E%E7%8E%B0%E5%85%8D%E5%AF%86%E7%A0%81%E7%99%BB%E5%BD%95/</url>
      <content type="html"><![CDATA[<blockquote>
<p>比如,创建一个名为wzm的账号</p>
</blockquote>
<p>####创建账号</p>
<p>1.创建</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# adduser wzm</span><br><span class="line">[root@localhost ~]# passwd wzm</span><br><span class="line"></span><br><span class="line">#此时,输入两次密码即可</span><br></pre></td></tr></table></figure>
<p>2.赋予sudo</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#找到sudoers</span><br><span class="line">[root@localhost ~]# whereis sudoers</span><br><span class="line"></span><br><span class="line">#修改sudoers的读写权限</span><br><span class="line">[root@localhost ~]# chmod -v u+w /etc/sudoers</span><br><span class="line"></span><br><span class="line">#加入新用户</span><br><span class="line"></span><br><span class="line">## Allow root to run any commands anywher  </span><br><span class="line">root    ALL=(ALL)       ALL  </span><br><span class="line">linuxidc  ALL=(ALL)       ALL  #这个是新增的用户</span><br><span class="line"></span><br><span class="line">#把sudoers权限还给他</span><br><span class="line">[root@localhost ~]# chmod -v u-w /etc/sudoers</span><br></pre></td></tr></table></figure>
<p>3.尽情享用吧</p>
<p>####ssh免密码登录</p>
<p>1.修改配置文件<br><code>sudo vim /etc/ssh/sshd_config</code></p>
<p>2.重启ssh服务<br><code>service sshd restart</code></p>
<p>3.生成密钥<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">     默认在 ~/.ssh目录生成两个文件：</span><br><span class="line">    id_rsa      ：私钥</span><br><span class="line">    id_rsa.pub  ：公钥</span><br></pre></td></tr></table></figure></p>
<p>4.导入本机<br><code>cat ~/.ssh/id_rsa.pub &gt;&gt; ~/.ssh/authorized_keys</code></p>
<p>5.下载到客户端并设置<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">scp [-r] 用户名@ip:文件路径 本地路径</span><br><span class="line">#下载文件</span><br><span class="line"></span><br><span class="line">scp [-r] 本地文件 用户名@ip:上传路径 </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">eg:</span><br><span class="line">~/.ssh ⌚ 16:27:33</span><br><span class="line">$ scp id_rsa.pub root@45.XX.XX.XX:/home/</span><br><span class="line">id_rsa.pub</span><br></pre></td></tr></table></figure></p>
<p>6.改权限<br>如果希望ssh公钥生效需满足至少下面两个条件：　　　　　<br>1) .ssh目录的权限必须是700<br>2) .ssh/authorized_keys文件权限必须是600</p>
<p>eg:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">~ ⌚ 16:33:21</span><br><span class="line">$ ssh wzm@45.XX.XX.XX</span><br><span class="line">Last login: Mon Dec 25 16:21:11 2017 from 118.102.XXX.XXX</span><br><span class="line">[wzm@wangzhumo ~]$</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Server </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目中使用RxBus进行通讯]]></title>
      <url>/Android/Android%E9%A1%B9%E7%9B%AE%E4%B8%AD%E4%BD%BF%E7%94%A8RxBus%E8%BF%9B%E8%A1%8C%E9%80%9A%E8%AE%AF/</url>
      <content type="html"><![CDATA[<p>加入JakeWharton大神的RxRelay</p>
<p><a href="https://github.com/JakeWharton/RxRelay" target="_blank" rel="noopener">JakeWharton/RxRelay</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.jakewharton.rxrelay2:rxrelay:2.0.0&apos;</span><br></pre></td></tr></table></figure></p>
<p>RxBus.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/11/30 下午6:09</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class RxBus &#123;</span><br><span class="line"></span><br><span class="line">    private Relay&lt;Object&gt; mBus = null;</span><br><span class="line">    private static volatile RxBus mDefaultInstance;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public RxBus() &#123;</span><br><span class="line">        mBus = PublishRelay.create().toSerialized();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static RxBus getDefault() &#123;</span><br><span class="line">        if (mDefaultInstance == null) &#123;</span><br><span class="line">            synchronized (RxBus.class) &#123;</span><br><span class="line">                if (mDefaultInstance == null) &#123;</span><br><span class="line">                    mDefaultInstance = new RxBus();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return mDefaultInstance;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 发送事件</span><br><span class="line">     */</span><br><span class="line">    public void post(Object event) &#123;</span><br><span class="line">        mBus.accept(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 根据传递的 eventType 类型返回特定类型(eventType)的 被观察者</span><br><span class="line">     */</span><br><span class="line">    public &lt;T&gt; Observable&lt;T&gt; toObservable(Class&lt;T&gt; eventType) &#123;</span><br><span class="line">        return mBus.ofType(eventType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 判断是否有订阅者</span><br><span class="line">     */</span><br><span class="line">    public boolean hasObservers() &#123;</span><br><span class="line">        return mBus.hasObservers();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 取消订阅</span><br><span class="line">     * @param disposable</span><br><span class="line">     */</span><br><span class="line">    public void unregister(Disposable disposable) &#123;</span><br><span class="line">        if (disposable != null &amp;&amp; !disposable.isDisposed()) &#123;</span><br><span class="line">            disposable.dispose();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Scheduler scheduler, Consumer&lt;T&gt; onNext) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(scheduler).subscribe(onNext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Scheduler scheduler, Consumer&lt;T&gt; onNext, Consumer onError,</span><br><span class="line">                                   Action onComplete, Consumer onSubscribe) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(scheduler).subscribe(onNext, onError, onComplete, onSubscribe);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Scheduler scheduler, Consumer&lt;T&gt; onNext, Consumer onError,</span><br><span class="line">                                   Action onComplete) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(scheduler).subscribe(onNext, onError, onComplete);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Scheduler scheduler, Consumer&lt;T&gt; onNext, Consumer onError) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(scheduler).subscribe(onNext, onError);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Consumer&lt;T&gt; onNext) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(AndroidSchedulers.mainThread()).subscribe(onNext);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Consumer&lt;T&gt; onNext, Consumer onError, Action onComplete, Consumer onSubscribe) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(AndroidSchedulers.mainThread()).subscribe(onNext, onError, onComplete, onSubscribe);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Consumer&lt;T&gt; onNext, Consumer onError, Action onComplete) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(AndroidSchedulers.mainThread()).subscribe(onNext, onError, onComplete);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public &lt;T&gt; Disposable register(Class&lt;T&gt; eventType, Consumer&lt;T&gt; onNext, Consumer onError) &#123;</span><br><span class="line">        return toObservable(eventType).observeOn(AndroidSchedulers.mainThread()).subscribe(onNext, onError);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>还有一个通用的Event.java<br>依据自己的需要制定即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/19 下午5:38</span><br><span class="line"> *</span><br><span class="line"> * 发送事件包装类</span><br><span class="line"> */</span><br><span class="line">public class Event&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">	public static final int EVENT_CLOSE_ALL_ACTIVITY = 10001;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">	 * reserved data</span><br><span class="line">	 */</span><br><span class="line">	private T data;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * this code distinguish between different events</span><br><span class="line">	 */</span><br><span class="line">	private int eventCode = -1;</span><br><span class="line"></span><br><span class="line">	public Event(int eventCode) &#123;</span><br><span class="line">		this(eventCode, null);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	public Event(int eventCode, T data) &#123;</span><br><span class="line">		this.eventCode = eventCode;</span><br><span class="line">		this.data = data;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * get event code</span><br><span class="line">	 *</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public int getCode() &#123;</span><br><span class="line">		return this.eventCode;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	/**</span><br><span class="line">	 * get event reserved data</span><br><span class="line">	 *</span><br><span class="line">	 * @return</span><br><span class="line">	 */</span><br><span class="line">	public T getData() &#123;</span><br><span class="line">		return this.data;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>RxBus的使用</strong></p>
<p><strong>注册</strong></p>
<p>最好是再基类中,加上.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">if (useEventBus()) &#123;</span><br><span class="line">            //注册eventbus</span><br><span class="line">            Disposable disposable = RxBus.getDefault()</span><br><span class="line">                    .register(Event.class, new Consumer&lt;Event&gt;() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        public void accept(Event event)  &#123;</span><br><span class="line">                            int eventCode = event.getCode();</span><br><span class="line">                            Log.e(&quot;RxBus&quot;, event.toString());</span><br><span class="line">                            switch (eventCode) &#123;</span><br><span class="line">                                case Event.EVENT_CLOSE_ALL_ACTIVITY:</span><br><span class="line"></span><br><span class="line">                                    break;</span><br><span class="line">                                default:</span><br><span class="line">                                    onEvent(event);</span><br><span class="line">                                    break;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">            addDispose(disposable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中:</p>
<ul>
<li><p>useEventBus()<br>由子类实现,是否开启RxBus,避免浪费</p>
</li>
<li><p>addDispose(disposable);<br>addDispose 是基类的方法</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * RxJava 添加订阅</span><br><span class="line"> */</span><br><span class="line">protected void addDispose(Disposable disposable) &#123;</span><br><span class="line">    if (mDisposables == null) &#123;</span><br><span class="line">        mDisposables = new CompositeDisposable();</span><br><span class="line">    &#125;</span><br><span class="line">    //将所有disposable放入,集中处理</span><br><span class="line">    mDisposables.add(disposable);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>统一管理,销毁时一起销毁,避免爆内存</p>
<ul>
<li>onEvent(event);<br>是一个空方法,如果子类重写就把事件交给子类处理</li>
</ul>
<p><strong>发送</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">RxBus.getDefault().post(new Event(100,&quot;message&quot;))</span><br><span class="line"></span><br><span class="line">//code最好在Event.java中统一定义,方便管理</span><br></pre></td></tr></table></figure>
<p><strong>处理</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">override fun onEvent(event: Event&lt;*&gt;?) &#123;</span><br><span class="line">    super.onEvent(event)</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这一部分,其实在 <strong>注册</strong> 中已经完成,只要子类自己重写方法,就能取到数据</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Rxjava </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Nginx安装及其简单配置]]></title>
      <url>/Server/Nginx%E5%AE%89%E8%A3%85%E5%8F%8A%E5%85%B6%E7%AE%80%E5%8D%95%E9%85%8D%E7%BD%AE/</url>
      <content type="html"><![CDATA[<p>环境: centos7</p>
<p><strong>1.下载安装</strong></p>
<p>下载nginx-1.12.0,官网<br><code>sudo wget http://nginx.org/download/nginx-1.12.0.tar.gz</code></p>
<p>解压<br><code>sudo tar -zxvf nginx-1.12.0.tar.gz</code></p>
<p>其他的库,nginx依赖的库</p>
<ul>
<li>安装gcc<br><code>yum -y install gcc</code></li>
<li>安装pcre<br><code>yum -y install pcre pcre-devel</code></li>
<li>安装zlib<br><code>yum -y install zlib zlib-devel</code></li>
<li>安装openssl<br><code>yum -y install openssl openssl-devel</code></li>
</ul>
<p>安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">sudo ./configure</span><br><span class="line">  </span><br><span class="line">sudo make</span><br><span class="line">  </span><br><span class="line">sudo make install</span><br></pre></td></tr></table></figure>
<blockquote>
<p>默认位置 /usr/local/nginx</p>
</blockquote>
<p>如果安装过程中出现文件目录权限问题,百度即可解决.</p>
<p><strong>2.系统中配置</strong></p>
<p>1.在系统服务目录里创建nginx.service文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /lib/systemd/system/nginx.service</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[Unit]</span><br><span class="line">Description=nginx</span><br><span class="line">After=network.target</span><br><span class="line">  </span><br><span class="line">[Service]</span><br><span class="line">Type=forking</span><br><span class="line">ExecStart=/usr/local/nginx/sbin/nginx</span><br><span class="line">ExecReload=/usr/local/nginx/sbin/nginx -s reload</span><br><span class="line">ExecStop=/usr/local/nginx/sbin/nginx -s quit</span><br><span class="line">PrivateTmp=true</span><br><span class="line">  </span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br></pre></td></tr></table></figure>
<p>2.设置开机启动</p>
<p><code>systemctl enable nginx.service</code></p>
<p>3.其他命令</p>
<p>启动nginx服务<code>systemctl start nginx.service</code></p>
<p>设置开机自启动<code>systemctl enable nginx.service</code></p>
<p>停止开机自启动<code>systemctl disable nginx.service</code></p>
<p>查看服务当前状态<code>systemctl status nginx.service</code></p>
<p>重新启动服务<code>systemctl restart nginx.service</code></p>
<p>查看所有已启动的服务 <code>systemctl list-units --type=service</code></p>
<p><strong>3.nginx.conf的配置</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@wangzhumo hooks]# cd /usr/local/nginx/</span><br><span class="line">[root@wangzhumo nginx]# ll</span><br><span class="line">total 96</span><br><span class="line">drwx------ 2 root root  4096 Dec 24 20:57 client_body_temp</span><br><span class="line">drwxr-xr-x 3 root root  4096 Dec 24 23:24 conf</span><br><span class="line">drwx------ 2 root root  4096 Dec 24 20:57 fastcgi_temp</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 23 10:38 html</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 24 22:43 logs</span><br><span class="line">-rw-r--r-- 1 root root 53861 Dec 25 13:37 on</span><br><span class="line">drwx------ 2 root root  4096 Dec 24 20:57 proxy_temp</span><br><span class="line">drwxr-xr-x 2 root root  4096 Dec 23 10:38 sbin</span><br><span class="line">drwx------ 2 root root  4096 Dec 24 20:57 scgi_temp</span><br><span class="line">drwx------ 2 root root  4096 Dec 24 20:57 uwsgi_temp</span><br></pre></td></tr></table></figure>
<p>其中/conf存放配置文件/conf/nginx.conf<br><code>vim /conf/nginx.conf</code></p>
<p>什么都不要动,在nginx.conf第一条server配置下面写入:<br><code>include vhost/*.conf;</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&#125;</span><br><span class="line">#此处是第一条可用的server的结束</span><br><span class="line"></span><br><span class="line">   #加入这句,其实是把其他地方配置的配置文件加载到里面来</span><br><span class="line">   #主要是为了方便管理,修改</span><br><span class="line">   include vhost/*.conf;</span><br><span class="line">   # another virtual host using mix of IP-, name-, and port-based configuration</span><br><span class="line">   #</span><br><span class="line">   #server &#123;</span><br><span class="line">   #    listen       8000;</span><br><span class="line">   #    listen       somename:8080;</span><br><span class="line">   #    server_name  somename  alias  another.alias;</span><br><span class="line"></span><br><span class="line">   #    location / &#123;</span><br><span class="line">   #        root   html;</span><br><span class="line">   #        index  index.html index.htm;</span><br><span class="line">   #    &#125;</span><br><span class="line">   #&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.1 /vhost/*.conf的配置</strong></p>
<p>当前目录到<br><code>cd /usr/local/nginx/conf</code></p>
<p>创建目录vhost<br><code>mkdir /usr/local/nginx/conf/vhost</code></p>
<p>创建.conf文件(我只用到hexo的配置,所以只有一个配置文件)<br><code>vim /usr/local/nginx/conf/vhost/hexo.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">server</span><br><span class="line">&#123;</span><br><span class="line">    listen 80;</span><br><span class="line">    #listen [::]:80;</span><br><span class="line">    server_name www.phyooos.top phyooos.top;</span><br><span class="line">    index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">    #web root path</span><br><span class="line">    root  /home/wzm/hexo;</span><br><span class="line"></span><br><span class="line">    #error_page   404   /404.html;</span><br><span class="line">    location ~ .*\.(ico|gif|jpg|jpeg|png|bmp|swf)$</span><br><span class="line">    &#123;</span><br><span class="line">        access_log   on;</span><br><span class="line">        expires      1d;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location ~ .*\.(js|css|txt|xml)?$</span><br><span class="line">    &#123;</span><br><span class="line">        access_log   on;</span><br><span class="line">        expires      12h;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    location / &#123;</span><br><span class="line">        try_files $uri $uri/ =404;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    access_log  /usr/local/nginx/logs/hexo.log  combined;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4.重启</strong><br><code>systemctl reload nginx</code></p>
<p>在外面访问即可</p>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Server </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Room数据库使用指北List<>的问题]]></title>
      <url>/Android/Room%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8C%97List%3C%3E%E7%9A%84%E9%97%AE%E9%A2%98/</url>
      <content type="html"><![CDATA[<p>Room依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">implementation &quot;android.arch.persistence.room:runtime:1.0.0&quot;</span><br><span class="line">annotationProcessor &quot;android.arch.persistence.room:compiler:1.0.0&quot;</span><br></pre></td></tr></table></figure>
<p><strong>查找</strong></p>
<ul>
<li>查找表中所有数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line">   * 查找user</span><br><span class="line">   * @return</span><br><span class="line">   */</span><br><span class="line">  @Query(&quot;SELECT * FROM banners&quot;)</span><br><span class="line">  List&lt;BannerModel&gt; findBanners();</span><br></pre></td></tr></table></figure>
<ul>
<li>按条件查找</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * filters</span><br><span class="line"> * @return</span><br><span class="line"> * @param typeSort</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;SELECT * FROM filters WHERE type != :typeSort&quot;)</span><br><span class="line">List&lt;FilterItemModel&gt; findFilters(String typeSort);</span><br></pre></td></tr></table></figure>
<ul>
<li>限制条数的条件查找</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取排序</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;SELECT * FROM filters WHERE type = :name LIMIT 0,1&quot;)</span><br><span class="line">FilterItemModel findSort(String name);</span><br></pre></td></tr></table></figure>
<p>现在获取的是第一条数据</p>
<p>//文档中的例子</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">public interface MyDao &#123;</span><br><span class="line">    @Query(&quot;SELECT first_name, last_name FROM user WHERE region IN (:regions)&quot;)</span><br><span class="line">    public List&lt;NameTuple&gt; loadUsersFromRegions(List&lt;String&gt; regions);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在user表中查找满足集合List<string> regions中条件的元素</string></p>
<ul>
<li>获取总行数</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 获取数据库表中总条数</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;SELECT count(*) FROM search_history&quot;)</span><br><span class="line">long findHistoryCount();</span><br></pre></td></tr></table></figure>
<ul>
<li>获取某一列的和</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 求和</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;SELECT sum(count) FROM status_stock&quot;)</span><br><span class="line">long findStatusStockCount();</span><br></pre></td></tr></table></figure>
<ul>
<li>按照降序排列(ASC升序  DESC降序)</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 查找user</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;SELECT * FROM search_history ORDER BY time DESC&quot;)</span><br><span class="line">List&lt;SearchHistoryModel&gt; findSearchHistory();</span><br></pre></td></tr></table></figure>
<hr>
<p>文档中的例子:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">public interface MyDao &#123;</span><br><span class="line"></span><br><span class="line">    //正常的查询</span><br><span class="line">    @Query(&quot;SELECT * FROM user WHERE age != :minAge&quot;)</span><br><span class="line">    public User[] loadAllUsersOlderThan(int minAge);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Dao</span><br><span class="line">public interface MyDao &#123;</span><br><span class="line"></span><br><span class="line">    //区间中的值</span><br><span class="line">    @Query(&quot;SELECT * FROM user WHERE age BETWEEN :minAge AND :maxAge&quot;)</span><br><span class="line">    public User[] loadAllUsersBetweenAges(int minAge, int maxAge);</span><br><span class="line"></span><br><span class="line">    //或关系的查询</span><br><span class="line">    @Query(&quot;SELECT * FROM user WHERE first_name LIKE :search &quot;</span><br><span class="line">           + &quot;OR last_name LIKE :search&quot;)</span><br><span class="line">    public List&lt;User&gt; findUserWithName(String search);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>如果,你不想查到表 行中所有字段,则</strong><br>1.定义一个实体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public class NameTuple &#123;</span><br><span class="line">    @ColumnInfo(name=&quot;first_name&quot;)</span><br><span class="line">    public String firstName;</span><br><span class="line"></span><br><span class="line">    @ColumnInfo(name=&quot;last_name&quot;)</span><br><span class="line">    public String lastName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>2.查询<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">public interface MyDao &#123;</span><br><span class="line">    @Query(&quot;SELECT first_name, last_name FROM user&quot;)</span><br><span class="line">    public List&lt;NameTuple&gt; loadFullName();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<ul>
<li>多表查询Querying multiple tables</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">@Dao</span><br><span class="line">public interface MyDao &#123;</span><br><span class="line">   @Query(&quot;SELECT user.name AS userName, pet.name AS petName &quot;</span><br><span class="line">          + &quot;FROM user, pet &quot;</span><br><span class="line">          + &quot;WHERE user.id = pet.user_id&quot;)</span><br><span class="line">   public LiveData&lt;List&lt;UserPet&gt;&gt; loadUserAndPetNames();</span><br><span class="line"></span><br><span class="line">   // You can also define this class in a separate file, as long as you add the</span><br><span class="line">   // &quot;public&quot; access modifier.</span><br><span class="line">   //注意 public</span><br><span class="line">   static class UserPet &#123;</span><br><span class="line">       public String userName;</span><br><span class="line">       public String petName;</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>更新</strong></p>
<ul>
<li>更新指定条目</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 更新时间</span><br><span class="line"> * @param time</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;UPDATE search_history SET time = :time WHERE content = :content&quot;)</span><br><span class="line">void updateSearchHistory(String content,long time);</span><br></pre></td></tr></table></figure>
<p><strong>删除数据</strong></p>
<ul>
<li>删除所有数据</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除表</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;DELETE FROM filters&quot;)</span><br><span class="line">void delectFilters();</span><br></pre></td></tr></table></figure>
<ul>
<li>删除最后一条</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除最后一个</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;DELETE FROM search_history WHERE time in(SELECT time FROM search_history ORDER BY time ASC LIMIT 1 )&quot;)</span><br><span class="line">void delectLastHistory();</span><br></pre></td></tr></table></figure>
<ul>
<li>按条件删除</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 删除表by listtype</span><br><span class="line"> * @return</span><br><span class="line"> */</span><br><span class="line">@Query(&quot;DELETE FROM vehicle_model WHERE listType = :type&quot;)</span><br><span class="line">void delectVehicleByType(String type);</span><br></pre></td></tr></table></figure>
<p>####补充</p>
<p><strong><code>1.List&lt;String&gt;</code>这样的元素</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">private ArrayList&lt;String&gt; tags;</span><br></pre></td></tr></table></figure></p>
<p>这样的元素,可以通过Converter搞定</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">/**</span><br><span class="line">* If you have any questions, you can contact by email &#123; wangzhumoo@gmail.com&#125;</span><br><span class="line">*</span><br><span class="line">* @author 王诛魔 2017/12/27 上午11:51</span><br><span class="line">*/</span><br><span class="line"></span><br><span class="line">public class TagsConverter &#123;</span><br><span class="line">    @TypeConverter</span><br><span class="line">    public static ArrayList&lt;String&gt; fromString(String value) &#123;</span><br><span class="line">        Type listType = new TypeToken&lt;ArrayList&lt;String&gt;&gt;() &#123;&#125;.getType();</span><br><span class="line">        return new Gson().fromJson(value, listType);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @TypeConverter</span><br><span class="line">    public static String fromArrayList(ArrayList&lt;String&gt; list) &#123;</span><br><span class="line">        Gson gson = new Gson();</span><br><span class="line">        String json = gson.toJson(list);</span><br><span class="line">        return json;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在db中,会存为 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[&quot;精选&quot;]</span><br><span class="line">[&quot;精选&quot;,&quot;急售&quot;]</span><br><span class="line">[&quot;准新&quot;,&quot;SUV&quot;]</span><br></pre></td></tr></table></figure>
<p><strong>3.@Embedded</strong></p>
<p>作用是,把已经写好的普通的类添加到数据表中.<br>用Room的文档做说明:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//这是一个标准的数据表</span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">class User &#123;</span><br><span class="line">    @PrimaryKey</span><br><span class="line">    public int id;</span><br><span class="line"></span><br><span class="line">    public String firstName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>其中只有id , firstName</p>
<p>而我想添加<br>    street;<br>    state;<br>    city;<br>    postCode;<br>刚好之前写了一个类叫Address</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">class Address &#123;</span><br><span class="line">    public String street;</span><br><span class="line">    public String state;</span><br><span class="line">    public String city;</span><br><span class="line">    @Ignore</span><br><span class="line">    public String nothing;</span><br><span class="line">    @ColumnInfo(name = &quot;post_code&quot;)</span><br><span class="line">    public int postCode;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>那么我通过 @Embedded</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">class User &#123;</span><br><span class="line">    @PrimaryKey</span><br><span class="line">    public int id;</span><br><span class="line"></span><br><span class="line">    public String firstName;</span><br><span class="line"></span><br><span class="line">    @Embedded</span><br><span class="line">    public Address address;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>表中就会有:<br><code>names: id, firstName, street, state, city, and post_code</code></p>
<p>如果你想给@Embedded的类中所有元素前面加上统一的标志</p>
<p><code>@Embedded(prefix = &quot;address_&quot;)</code></p>
<p>表中就会有:</p>
<p><code>names: id, firstName, address_street, address_state, address_city, and address_post_code</code></p>
<p><strong>3.<code>List&lt;Object&gt;</code>这样的数据</strong></p>
<ul>
<li>解决方法<br><a href="https://developer.android.com/reference/android/arch/persistence/room/Relation.html" target="_blank" rel="noopener">google developer</a></li>
</ul>
<p>真的给谷歌跪了,什么鬼文档</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line">@Entity</span><br><span class="line">public class User &#123;</span><br><span class="line"></span><br><span class="line">    // 这里是用户的 Id</span><br><span class="line">    @PrimaryKey</span><br><span class="line">    public int id;</span><br><span class="line"></span><br><span class="line">    //省略</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">@Entity</span><br><span class="line">public class Book &#123;</span><br><span class="line"></span><br><span class="line">    //书的id</span><br><span class="line">    @PrimaryKey</span><br><span class="line">    public int bookId;</span><br><span class="line">    </span><br><span class="line">    //这里就是这本书与 User的关系,这里的是User.id</span><br><span class="line">    public int userId;</span><br><span class="line">    public String name;</span><br><span class="line">    public String desc;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//注意,什么注解也不要加</span><br><span class="line">public class UserAndBooks &#123;</span><br><span class="line"></span><br><span class="line">    //加入所有的user的属性</span><br><span class="line">   @Embedded</span><br><span class="line">   public User user;</span><br><span class="line"></span><br><span class="line">    //这里定义User 和 Book的关系</span><br><span class="line">   @Relation(parentColumn = &quot;id&quot;, entityColumn = &quot;userId&quot;, entity = Book.class)</span><br><span class="line">   public List&lt;Book&gt; books; </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//文档上还讲了一个比较牛逼的功能,这里不讨论</span><br><span class="line"></span><br><span class="line">public class UserAndAllPets &#123;</span><br><span class="line">   @Embedded</span><br><span class="line">   public User user;</span><br><span class="line">   @Relation(parentColumn = &quot;id&quot;, entityColumn = &quot;userId&quot;, entity = Book.class,</span><br><span class="line">           projection = &#123;&quot;name&quot;&#125;)</span><br><span class="line">   public List&lt;String&gt; bookNames;</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//然后,dao是这样的</span><br><span class="line"></span><br><span class="line">@Dao</span><br><span class="line">public interface UserDao &#123;</span><br><span class="line">    @Query(&quot;SELECT * FROM User&quot;)</span><br><span class="line">    public List&lt;UserAndBooks&gt; loadUserWithBooks();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">PS:当然你存的时候,分辨别存User  和 Book 即可</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Room </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Retrofit2 + Okhttp3 + Rxjava2 网络请求封装(下)]]></title>
      <url>/Android/Retrofit2-Okhttp3-Rxjava2-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%B0%81%E8%A3%85-%E4%B8%8B/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">//请求:</span><br><span class="line"></span><br><span class="line">RetrofitApis.getNetworkApis().getFriendsCircle(userBean.token, String.valueOf(45),null,lastId)</span><br><span class="line">	.compose(new DefaultTransformer&lt;&gt;())</span><br><span class="line">	.subscribe(new Defaultubscriber&lt;List&lt;FriendItem&gt;&gt;() &#123;</span><br><span class="line">		@Override</span><br><span class="line">		protected void onError(ApiException ex) &#123;</span><br><span class="line">                //请求错误,ex中可以拿到code 和 msg  便于展示给用户</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		@Override</span><br><span class="line">		public void onNext(List&lt;FriendItem&gt; friends) &#123;</span><br><span class="line">		    //请求成功,friends就是数据</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		@Override</span><br><span class="line">		public void onComplete() &#123;</span><br><span class="line">                    //没有错误的话,最后会走着</span><br><span class="line">		&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>compose()  转化<br>subscribe() 订阅</p>
<p>DefaultTransformer.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/11/3 下午5:06</span><br><span class="line"> *</span><br><span class="line"> * 默认的切换线程,并返回实体类</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class DefaultTransformer&lt;T extends ResultResponse&lt;RP&gt;, RP&gt; implements FlowableTransformer&lt;T, RP&gt; &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Publisher&lt;RP&gt; apply(Flowable&lt;T&gt; upstream) &#123;</span><br><span class="line">        return upstream</span><br><span class="line">                .map(t -&gt; t.getResult())</span><br><span class="line">                .subscribeOn(Schedulers.io())</span><br><span class="line">                .observeOn(AndroidSchedulers.mainThread());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.map 将返回的ResultResponse&lt;&gt;  转化,直接取ResultResponse的泛型实体<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&#123;&quot;result&quot;:&#123;&#125;</span><br><span class="line">&quot;code&quot;:&quot;&quot;,</span><br><span class="line">&quot;msg&quot;:&quot;&quot;&#125;</span><br></pre></td></tr></table></figure></p>
<p>中的result</p>
<p>2.subscribeOn(Schedulers.io())  网络请求的耗时操作,放在方便io操作的线程里面<br>3.observeOn(AndroidSchedulers.mainThread())  后面的操作,都在主线程进行</p>
<p>Defaultubscriber.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/24 上午10:36</span><br><span class="line"> *</span><br><span class="line"> * 用于没有网络时停止网络请求</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public abstract class Defaultubscriber&lt;T&gt; extends DisposableSubscriber&lt;T&gt; &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @CallSuper</span><br><span class="line">    @Override</span><br><span class="line">    public void onError(Throwable e) &#123;</span><br><span class="line">        if (e instanceof ApiException) &#123;</span><br><span class="line">            onError((ApiException) e);</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            onError(new ApiException(&quot;&quot;,&quot;&quot;));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    protected void onStart() &#123;</span><br><span class="line">        if (!SystemUtils.isNetworkConnected()) &#123;</span><br><span class="line">            onError(new ApiException(Utils.getString(R.string.net_error_title),&quot;999&quot;));</span><br><span class="line">            cancel();</span><br><span class="line">            return;</span><br><span class="line">        &#125;</span><br><span class="line">        super.onStart();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 错误回调</span><br><span class="line">     *</span><br><span class="line">     * @param ex 异常信息</span><br><span class="line">     */</span><br><span class="line">    protected abstract void onError(ApiException ex);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>1.extends DisposableSubscriber  便于通过CompositeDisposable管理请求,此处没有展示,不用管<br>2.onStart()  中,判断是否有网络</p>
<ul>
<li><p>没有网络<br>onError(new ApiException(Utils.getString(R.string.net_error), false));<br>抛出没有网络的错误,由各个页面自行处理</p>
<p>cancel(); 取消</p>
<ul>
<li>有网络则继续</li>
</ul>
</li>
</ul>
<p>3.重写的 onError()中.<br>    是ApiException实例的,是自己抛出的异常,已经处理过了,直接onError给各个页面处理<br>    不是的再处理一次,在分发给各个页面处理</p>
<p>####未完待续…</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Rxjava </tag>
            
            <tag> Okhttp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Retrofit2 + Okhttp3 + Rxjava2 网络请求封装(上)]]></title>
      <url>/Android/Retrofit2-Okhttp3-Rxjava2-%E7%BD%91%E7%BB%9C%E8%AF%B7%E6%B1%82%E5%B0%81%E8%A3%85(%E4%B8%8A)/</url>
      <content type="html"><![CDATA[<p>最终结构</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">net</span><br><span class="line">├── RequestBuilder.java</span><br><span class="line">├── RetrofitApis.java</span><br><span class="line">├── base</span><br><span class="line">│   ├── ApiException.java</span><br><span class="line">│   ├── CustomGsonConverter.java</span><br><span class="line">│   ├── DefaultSubscriber.java</span><br><span class="line">│   └── DefaultTransformer.java</span><br><span class="line">└── response</span><br><span class="line">    ├── BaseResponse.java</span><br><span class="line">    └── ResultResponse.java</span><br><span class="line"></span><br><span class="line">NetworkApis.java</span><br></pre></td></tr></table></figure>
<p><strong>1.添加依赖</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">implementation &quot;io.reactivex.rxjava2:rxjava:2.1.7&quot;</span><br><span class="line">implementation &quot;io.reactivex.rxjava2:rxandroid:2.0.1&quot;</span><br><span class="line">implementation &quot;com.squareup.okhttp3:okhttp:3.9.0&quot;</span><br><span class="line">implementation &quot;com.squareup.okhttp3:logging-interceptor:3.9.0&quot;</span><br><span class="line">implementation &quot;com.squareup.retrofit2:retrofit:2.3.0&quot;</span><br><span class="line">implementation &quot;com.squareup.retrofit2:converter-gson:2.3.0&quot;</span><br><span class="line">implementation &quot;com.squareup.retrofit2:adapter-rxjava2:2.3.0&quot;</span><br></pre></td></tr></table></figure>
<p><strong>2.请求服务构建</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/11/1 下午11:13</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">public class RetrofitApis &#123;</span><br><span class="line">    private static OkHttpClient okHttpClient = null;</span><br><span class="line">    private static NetworkApis networkApis = null;</span><br><span class="line">    private static Gson gson = new Gson();</span><br><span class="line">    private static final String TAG = &quot;RetrofitApis&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 为HOST创建一个请求客户端</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    public static NetworkApis getNetworkApis() &#123;</span><br><span class="line">        initOkhttp();</span><br><span class="line">        if (networkApis == null) &#123;</span><br><span class="line">            Retrofit retrofit = new Retrofit.Builder()</span><br><span class="line">                    .client(okHttpClient)</span><br><span class="line">                    .baseUrl(Constants.HOST)</span><br><span class="line">                    .addConverterFactory(CustomGsonConverter.create(gson))</span><br><span class="line">                    .addCallAdapterFactory(RxJava2CallAdapterFactory.create())</span><br><span class="line">                    .build();</span><br><span class="line">            networkApis = retrofit.create(NetworkApis.class);</span><br><span class="line">        &#125;</span><br><span class="line">        return networkApis;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 初始化一个OkHttpClient</span><br><span class="line">     */</span><br><span class="line">    private static void initOkhttp()&#123;</span><br><span class="line">        //没有创建就实例一个</span><br><span class="line">        if(okHttpClient == null)&#123;</span><br><span class="line">            final OkHttpClient.Builder builder = new OkHttpClient.Builder();</span><br><span class="line">            //设置log等级</span><br><span class="line">            if(BuildConfig.DEBUG)&#123;</span><br><span class="line">                HttpLoggingInterceptor interceptor = new HttpLoggingInterceptor();</span><br><span class="line"></span><br><span class="line">                //BODY  包含请求url 参数  response ,会打印在logcat</span><br><span class="line">                interceptor.setLevel(HttpLoggingInterceptor.Level.BODY);</span><br><span class="line">                builder.addInterceptor(interceptor);</span><br><span class="line">            &#125;</span><br><span class="line">            //打开一个File用于缓存</span><br><span class="line">            File cacheFile = new File(Constants.PATH_CACHE);</span><br><span class="line">            Cache cache = new Cache(cacheFile,1024*1024*50);</span><br><span class="line">            //一个拦截器</span><br><span class="line">                Interceptor cacheInterceptor = new Interceptor() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                public Response intercept(Chain chain) throws IOException &#123;</span><br><span class="line">                    Request.Builder builder = chain.request().newBuilder();</span><br><span class="line"></span><br><span class="line">                    if(SystemUtils.isNetworkConnected())&#123;</span><br><span class="line">                        int maxAge = 0 ;</span><br><span class="line">                        //有网络,不缓存,最长保存时间为0</span><br><span class="line">                        builder.removeHeader(&quot;Pragma&quot;)</span><br><span class="line">                                .header(&quot;Cache-Control&quot;, &quot;public, max-age=&quot; + maxAge)</span><br><span class="line">                                .build();</span><br><span class="line">                    &#125; else &#123;</span><br><span class="line">                        // 无网络时，设置超时为2周</span><br><span class="line">                        int maxStale = 60 * 60 * 24 * 14;</span><br><span class="line">                        builder.removeHeader(&quot;Pragma&quot;)</span><br><span class="line">                                .header(&quot;Cache-Control&quot;, &quot;public, only-if-cached, max-stale=&quot; + maxStale)</span><br><span class="line">                                .build();</span><br><span class="line">                      throw new ApiException(false);</span><br><span class="line">                    &#125;</span><br><span class="line">                    return chain.proceed(builder.build());</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;;</span><br><span class="line">            //设置缓存拦截器</span><br><span class="line">            builder.addInterceptor(cacheInterceptor);</span><br><span class="line">            builder.addNetworkInterceptor(cacheInterceptor);</span><br><span class="line"></span><br><span class="line">            //这里通过Interceptor 可以实现添加公共参数,不详细说明了</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            //stetho,如果使用则需要添加</span><br><span class="line">            //builder.addNetworkInterceptor(new StethoInterceptor());</span><br><span class="line"></span><br><span class="line">            builder.cache(cache);</span><br><span class="line">            //错误重连</span><br><span class="line">            builder.retryOnConnectionFailure(true);</span><br><span class="line">            //设置超时</span><br><span class="line">            builder.connectTimeout(15, TimeUnit.SECONDS);</span><br><span class="line">            builder.readTimeout(15, TimeUnit.SECONDS);</span><br><span class="line">            builder.writeTimeout(15, TimeUnit.SECONDS);</span><br><span class="line">            okHttpClient = builder.build();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上;</p>
<p>使用 <code>CustomGsonConverter.java / NetworkApis.java</code><br>通过getNetworkApis()方法,向外提供了一个请求服务.<br>其中 .addConverterFactory(CustomGsonConverter.create(gson))<br>是使用自定义的Converter替代了默认提供的</p>
<p>CustomGsonConverter.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/24 上午10:31</span><br><span class="line"> *</span><br><span class="line"> * GsonConverter 用于在不解析返回正文的前提下获取请求成功失败和 返回信息</span><br><span class="line"> */</span><br><span class="line">public class CustomGsonConverter extends Converter.Factory &#123;</span><br><span class="line"></span><br><span class="line">    private final Gson gson;</span><br><span class="line"></span><br><span class="line">    private CustomGsonConverter(Gson gson) &#123;</span><br><span class="line">        if (gson == null) &#123;</span><br><span class="line">            throw new NullPointerException(&quot;gson == null&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        this.gson = gson;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static CustomGsonConverter create() &#123;</span><br><span class="line">        return create(new Gson());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static CustomGsonConverter create(Gson gson) &#123;</span><br><span class="line">        return new CustomGsonConverter(gson);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public Converter&lt;ResponseBody, ?&gt; responseBodyConverter(Type type, Annotation[] annotations, Retrofit retrofit) &#123;</span><br><span class="line">        TypeAdapter&lt;?&gt; adapter = gson.getAdapter(TypeToken.get(type));</span><br><span class="line">        return new CustomGsonResponseBodyConverter&lt;&gt;(gson, adapter);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    private class CustomGsonResponseBodyConverter&lt;T&gt; implements Converter&lt;ResponseBody, T&gt; &#123;</span><br><span class="line">        private final Gson gson;</span><br><span class="line">        private final TypeAdapter&lt;T&gt; adapter;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        public CustomGsonResponseBodyConverter(Gson gson, TypeAdapter&lt;T&gt; adapter) &#123;</span><br><span class="line">            this.gson = gson;</span><br><span class="line">            this.adapter = adapter;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public T convert(ResponseBody value) throws IOException &#123;</span><br><span class="line">            String response = value.string();</span><br><span class="line">            BaseResponse baseResponse = gson.fromJson(response,BaseResponse.class);</span><br><span class="line">            if (!baseResponse.isCodeSuccess()) &#123;</span><br><span class="line">                value.close();</span><br><span class="line">                throw new ApiException(baseResponse.error);</span><br><span class="line">            &#125;</span><br><span class="line">            MediaType contentType = value.contentType();</span><br><span class="line">            Charset charset = contentType != null ? contentType.charset(UTF_8) : UTF_8;</span><br><span class="line">            InputStream inputStream = new ByteArrayInputStream(response.getBytes());</span><br><span class="line">            Reader reader = new InputStreamReader(inputStream, charset);</span><br><span class="line">            JsonReader jsonReader = gson.newJsonReader(reader);</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                return adapter.read(jsonReader);</span><br><span class="line">            &#125; finally &#123;</span><br><span class="line">                value.close();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Nullable</span><br><span class="line">    @Override</span><br><span class="line">    public Converter&lt;?, RequestBody&gt; requestBodyConverter(Type type, Annotation[] parameterAnnotations, Annotation[] methodAnnotations, Retrofit retrofit) &#123;</span><br><span class="line">        return super.requestBodyConverter(type,parameterAnnotations,methodAnnotations,retrofit);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>requestBodyConverter没有重写,后面发现了一个bug,上传文件+文字参数时,可能会造成 Length出错.<br>responseBodyConverter 重写,先把response解析,如果有问题则<br><code>throw new ApiException(baseResponse.error);</code><br>会主动走RxJava的 onError()</p>
<p>如果没有问题,则继续,好像有点多余……</p>
<p>ApiException.java  就是用于封装异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/24 上午10:29</span><br><span class="line"> *</span><br><span class="line"> * 此类作为网络请求异常的基</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class ApiException extends IOException &#123;</span><br><span class="line"></span><br><span class="line">    String code;</span><br><span class="line">    String msg;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ApiException(String code)&#123;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public ApiException(String msg, String code)&#123;</span><br><span class="line">        super(msg);</span><br><span class="line">        this.msg = msg;</span><br><span class="line">        this.code = code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    public boolean getCode() &#123;</span><br><span class="line">        return code;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public String getMessage() &#123;</span><br><span class="line">        return msg;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.Response返回数据的封装</strong></p>
<blockquote>
<p>这里根据后台返回数据结构</p>
</blockquote>
<p>我们的返回是<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;result&quot;:&#123;</span><br><span class="line"></span><br><span class="line">    &#125;,</span><br><span class="line">    &quot;msg&quot;:&quot;请求成功&quot;,</span><br><span class="line">    &quot;code&quot;:&quot;0000&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>BaseResponse.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/19 下午5:41</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class BaseResponse&#123;</span><br><span class="line"></span><br><span class="line">    public String code;</span><br><span class="line">    public String msg;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * API是否请求失败</span><br><span class="line">     *</span><br><span class="line">     * @return 失败返回true, 成功返回false</span><br><span class="line">     */</span><br><span class="line">    public boolean isCodeSuccess() &#123;</span><br><span class="line">        return &quot;0000&quot;.equals(code);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>所有的返回数据类,都要继承它,便于CustomGsonConverter 中判断返回数据的正确性</p>
<p>ResultResponse.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/19 下午5:37</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class ResultResponse&lt;T&gt; extends BaseResponse &#123;</span><br><span class="line"></span><br><span class="line">    private T result;</span><br><span class="line"></span><br><span class="line">    public T getResult() &#123;</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>通过T泛型,指定返回result的结构,让gson解析成实体对象</p>
<p>T 可能是 实体对象  可能是 List&lt;实体对象&gt;  ….</p>
<p><strong>4.请求数据</strong></p>
<p>NetworkApis.java</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * If you have any questions, you can contact by email &#123;wangzhumoo@gmail.com&#125;</span><br><span class="line"> * @author 王诛魔 2017/10/19 下午5:40</span><br><span class="line"> *</span><br><span class="line"> * 所有网络请求</span><br><span class="line"> */</span><br><span class="line">public interface NetworkApis &#123;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 获取朋友圈列表</span><br><span class="line">     * @param token</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @POST(&quot;QCRL/qcrl?command=getFriendsCircle&quot;)</span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    Flowable&lt;ResultResponse&lt;List&lt;FriendItem&gt;&gt;&gt; getFriendsCircle(</span><br><span class="line">            @Field(&quot;token&quot;) String token,</span><br><span class="line">            @Field(&quot;number&quot;) String number,</span><br><span class="line">            @Field(&quot;userId&quot;) String userId,</span><br><span class="line">            @Field(&quot;lastDate&quot;) String lastId);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 删除</span><br><span class="line">     * @param token</span><br><span class="line">     * @param circleId</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @POST(&quot;QCRL/qcrl?command=updateFriendsCircle&quot;)</span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    Flowable&lt;ResultResponse&lt;String&gt;&gt; updateFriendsCircle(</span><br><span class="line">            @Field(&quot;token&quot;) String token,</span><br><span class="line">            @Field(&quot;circleId&quot;) String circleId);</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 赞</span><br><span class="line">     * @param token</span><br><span class="line">     * @param circleId</span><br><span class="line">     * @param userId</span><br><span class="line">     * @return</span><br><span class="line">     */</span><br><span class="line">    @POST(&quot;QCRL/qcrl?command=addFavor&quot;)</span><br><span class="line">    @FormUrlEncoded</span><br><span class="line">    Flowable&lt;ResultResponse&lt;Object&gt;&gt; addFavor(</span><br><span class="line">            @Field(&quot;token&quot;) String token,</span><br><span class="line">            @Field(&quot;circleId&quot;) String circleId,</span><br><span class="line">            @Field(&quot;toId&quot;) String userId);</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>根据自己的接口编写即可<br>@POST() 指请求方式为 POST  </p>
<blockquote>
<p>注意,括号中的网址,开头不可以使用/QCRL/…<br>否则会直接拼到HOST后面,url可能会错误 </p>
</blockquote>
<p>@FormUrlEncoded  表示form表单提交,会Encoded编码参数</p>
<p>@Field 每一个参数</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Rxjava </tag>
            
            <tag> Okhttp </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android项目的build.gradle通用设置]]></title>
      <url>/Android/Android%E9%A1%B9%E7%9B%AE%E7%9A%84build-gradle%E9%80%9A%E7%94%A8%E8%AE%BE%E7%BD%AE/</url>
      <content type="html"><![CDATA[<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line">apply plugin: &apos;com.android.application&apos;</span><br><span class="line"></span><br><span class="line">android &#123;</span><br><span class="line"></span><br><span class="line">    //开启dataBinding</span><br><span class="line">    dataBinding&#123;</span><br><span class="line">        enabled = true</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        //开启multiDex</span><br><span class="line">        multiDexEnabled true</span><br><span class="line"></span><br><span class="line">        //使用jni</span><br><span class="line">        ndk &#123;</span><br><span class="line">            //设置支持的SO库架构,这里的意思是只支持&apos;armeabi&apos;, &apos;armeabi-v7a&apos;, &apos;x86&apos;</span><br><span class="line">            //这三种架构</span><br><span class="line">            abiFilters &apos;armeabi&apos;, &apos;armeabi-v7a&apos;, &apos;x86&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //设置一个编译的配置</span><br><span class="line">    signingConfigs &#123;</span><br><span class="line">        //名为release的配置项</span><br><span class="line">        release &#123;</span><br><span class="line">            //签名文件的位置,当前位置是根目录</span><br><span class="line">            storeFile file(&quot;/keyfile.jks&quot;)</span><br><span class="line">            //storePassword</span><br><span class="line">            storePassword &quot;xxxxxxxx&quot;</span><br><span class="line">            //keyAlias</span><br><span class="line">            keyAlias &quot;wangzhumo&quot;</span><br><span class="line">            //keyPassword</span><br><span class="line">            keyPassword &quot;xxxxxxxx&quot;</span><br><span class="line">            //是否使用v2Signing</span><br><span class="line">            v2SigningEnabled false</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //编译的版本</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        //debug时的配置</span><br><span class="line">        debug &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            //这里使用上面配置的签名,可以做到debug时,也使用的是正式签名,而不是debug的 keystore</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            //buildConfig 的一个参数,是否开启log</span><br><span class="line">            buildConfigField &quot;boolean&quot;, &quot;LOG_DEBUG&quot;, &quot;true&quot;</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        release &#123;</span><br><span class="line">            // 显示Log</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            buildConfigField &quot;boolean&quot;, &quot;LOG_DEBUG&quot;, &quot;false&quot;</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //adb的配置项</span><br><span class="line">    adbOptions &#123;</span><br><span class="line">        //超时时间</span><br><span class="line">        timeOutInMs = 5 * 1000</span><br><span class="line">        //adb install -r /path..apk</span><br><span class="line">        installOptions &apos;-r&apos;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    flavorDimensions &apos;env&apos;</span><br><span class="line"></span><br><span class="line">    productFlavors &#123;</span><br><span class="line">        //正式版本</span><br><span class="line">        envydemo&#123;</span><br><span class="line">            dimension &apos;env&apos;</span><br><span class="line">            //此处是versionName</span><br><span class="line">            versionName &quot;V1.1&quot;</span><br><span class="line">            //manifestPlaceholders</span><br><span class="line">            //是manifest已经定义的参数,这里给该参数赋值</span><br><span class="line">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;wangzhumoo&quot;]</span><br><span class="line">            //buildConfig 的参数,App当前的HOST地址</span><br><span class="line">            buildConfigField &quot;String&quot;,&quot;SERVER_HOST&quot;,&apos;&quot;http://app....com/&quot;&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        envtest &#123;</span><br><span class="line">            dimension &apos;env&apos;</span><br><span class="line">            versionName &quot;Test&quot;</span><br><span class="line">            manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;wangzhumoo&quot;]</span><br><span class="line">            buildConfigField &quot;String&quot;,&quot;SERVER_HOST&quot;,&apos;&quot;http://app.test....com/&quot;&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    //自定义apk名字</span><br><span class="line">    android.applicationVariants.all &#123; variant -&gt;</span><br><span class="line">        variant.outputs.all &#123;</span><br><span class="line">            //apk的名字</span><br><span class="line">            outputFileName = &quot;App_$&#123;variant.versionName&#125;.apk&quot;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    android &#123;</span><br><span class="line">         //排除</span><br><span class="line">        configurations.all &#123;</span><br><span class="line">            resolutionStrategy.force &apos;com.google.code.findbugs:jsr305:1.3.9&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    //使用java8 </span><br><span class="line">    compileOptions &#123;</span><br><span class="line">        sourceCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">        targetCompatibility JavaVersion.VERSION_1_8</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上代码,删除了常见的部分.</p>
<ul>
<li>buildConfigField</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 常量类</span><br><span class="line"> */</span><br><span class="line"></span><br><span class="line">public class Constants &#123;</span><br><span class="line">    //取到在productFlavors.envyhcs配置的参数</span><br><span class="line">    //buildConfigField &quot;String&quot;,&quot;SERVER_HOST&quot;,&apos;&quot;http://app....com/&quot;&apos;</span><br><span class="line">    public static final String BASE_URL = BuildConfig.SERVER_HOST;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>manifestPlaceholders</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;manifest&gt;</span><br><span class="line">    &lt;application&gt;</span><br><span class="line">        //取到在productFlavors.envyhcs配置的参数</span><br><span class="line">        //manifestPlaceholders = [UMENG_CHANNEL_VALUE: &quot;wangzhumo&quot;]</span><br><span class="line">        &lt;meta-data</span><br><span class="line">            android:name=&quot;UMENG_CHANNEL&quot;</span><br><span class="line">            android:value=&quot;$&#123;UMENG_CHANNEL_VALUE&#125;&quot; /&gt;</span><br><span class="line">    &lt;/application&gt;</span><br><span class="line">&lt;/manifest&gt;</span><br></pre></td></tr></table></figure>
<ul>
<li>Build Variants<br>在build.gradle中配置了productFlavors{  envdemo{} , envtest{}}</li>
</ul>
<p>其中dimension一个维度<br>其中buildTypes一个维度</p>
<p>debug + evndemo<br>debug + evntest<br>release + evndeme<br>release + evntest</p>
<p>共4种,其他的并没有使用到,所以不做说明</p>
<p><img src="/images/build_var.png" alt="Build Variants"></p>
<p>可以选择debug默认的版本…</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Gradle </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android 项目统一管理依赖版本]]></title>
      <url>/Android/Android-%E9%A1%B9%E7%9B%AE%E7%BB%9F%E4%B8%80%E7%AE%A1%E7%90%86%E4%BE%9D%E8%B5%96%E7%89%88%E6%9C%AC/</url>
      <content type="html"><![CDATA[<p>准备引入Arouter,做一个组件的demo,就开始慢慢的改造项目</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">.</span><br><span class="line">|-- app</span><br><span class="line">|   |-- build.gradle</span><br><span class="line">|   |-- libs</span><br><span class="line">|   |-- src</span><br><span class="line">|   |   |-- androidTest</span><br><span class="line">|   |   |-- main</span><br><span class="line">|   |   `-- test</span><br><span class="line">|</span><br><span class="line">|-- opensource</span><br><span class="line">|   |-- build.gradle</span><br><span class="line">|   |-- libs</span><br><span class="line">|   `-- src</span><br><span class="line">|       `-- main</span><br><span class="line">|-- build.gradle</span><br><span class="line">|-- settings.gradle</span><br><span class="line">`-- versions.gradle</span><br></pre></td></tr></table></figure>
<blockquote>
<p>app 为主项目<br>opensource 作为library存在,将来会成为baseLib的依赖,其中是所有的三方依赖,开源代码等等</p>
</blockquote>
<p><strong>1.根目录创建versions.gradle</strong></p>
<p><code>/versions.gradle</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">ext.deps = [:]</span><br><span class="line">    def versions = [:]</span><br><span class="line">    versions.arch = &quot;1.0.0&quot;</span><br><span class="line">    versions.support = &quot;27.0.1&quot;</span><br><span class="line">    versions.dagger = &quot;2.13&quot;</span><br><span class="line">    versions.stetho = &quot;1.5.0&quot;</span><br><span class="line">    versions.dialogs = &quot;0.9.6.0&quot;</span><br><span class="line"></span><br><span class="line">    versions.glide = &quot;4.3.1&quot;</span><br><span class="line">    versions.gradle = &quot;3.0.1&quot;</span><br><span class="line"></span><br><span class="line">    versions.rxJava = &quot;2.1.7&quot;</span><br><span class="line">    versions.rxAndroid = &quot;2.0.1&quot;</span><br><span class="line">    versions.rxRelay = &quot;2.0.0&quot;</span><br><span class="line">    versions.rxBinding = &quot;2.0.0&quot;</span><br><span class="line"></span><br><span class="line">    versions.paging = &quot;1.0.0-alpha3&quot;</span><br><span class="line"></span><br><span class="line">    versions.okhttp = &quot;3.9.0&quot;</span><br><span class="line">    versions.retrofit = &quot;2.3.0&quot;</span><br><span class="line"></span><br><span class="line">    versions.kotlin = &quot;1.2.0&quot;</span><br><span class="line">    versions.kotlinBind = &quot;3.0.1&quot;</span><br><span class="line"></span><br><span class="line">    versions.gson = &quot;2.8.2&quot;</span><br><span class="line"></span><br><span class="line">    versions.arouterVersion = &quot;1.2.4&quot;</span><br><span class="line">    versions.arouterProcessor = &quot;1.1.4&quot;</span><br><span class="line">    versions.atslRunner = &quot;1.0.1&quot;</span><br><span class="line">    versions.atslRules = &quot;1.0.1&quot;</span><br><span class="line">    versions.hamcrest = &quot;1.3&quot;</span><br><span class="line">    versions.timber = &quot;4.5.1&quot;</span><br><span class="line">    versions.mockwebserver = &quot;3.8.1&quot;</span><br><span class="line">    versions.apache_commons = &quot;2.5&quot;</span><br><span class="line">    versions.mockito = &quot;2.7.19&quot;</span><br><span class="line">    versions.mockito_all = &quot;1.10.19&quot;</span><br><span class="line">    versions.dexmaker = &quot;2.2.0&quot;</span><br><span class="line">    versions.constraint = &quot;1.0.2&quot;</span><br><span class="line">    versions.junit = &quot;4.12&quot;</span><br><span class="line">    versions.espresso = &quot;3.0.1&quot;</span><br><span class="line">    def deps = [:]</span><br><span class="line"></span><br><span class="line">    def rxLib = [:]</span><br><span class="line">    rxLib.rxJava = &quot;io.reactivex.rxjava2:rxjava:$versions.rxJava&quot;</span><br><span class="line">    rxLib.rxAndroid = &quot;io.reactivex.rxjava2:rxandroid:$versions.rxAndroid&quot;</span><br><span class="line">    rxLib.rxBinding = &quot;com.jakewharton.rxbinding2:rxbinding:$versions.rxBinding&quot;</span><br><span class="line">    rxLib.rxBingingV4 = &quot;com.jakewharton.rxbinding2:rxbinding-support-v4:$versions.rxBinding&quot;</span><br><span class="line">    rxLib.rxBingingRecycler = &quot;com.jakewharton.rxbinding2:rxbinding-recyclerview-v7:$versions.rxBinding&quot;</span><br><span class="line">        rxLib.rxBingingV7 = &quot;com.jakewharton.rxbinding2:rxbinding-appcompat-v7:$versions.rxBinding&quot;</span><br><span class="line">    rxLib.rxBingingDesign = &quot;com.jakewharton.rxbinding2:rxbinding-design:$versions.rxBinding&quot;</span><br><span class="line">    rxLib.rxRelay = &quot;com.jakewharton.rxrelay2:rxrelay:$versions.rxRelay&quot;</span><br><span class="line">    deps.rxLibs = rxLib</span><br><span class="line"></span><br><span class="line">    def support = [:]</span><br><span class="line">    support.annotations = &quot;com.android.support:support-annotations:$versions.support&quot;</span><br><span class="line">    support.appCompat = &quot;com.android.support:appcompat-v7:$versions.support&quot;</span><br><span class="line">    support.recyclerview = &quot;com.android.support:recyclerview-v7:$versions.support&quot;</span><br><span class="line">    support.cardview = &quot;com.android.support:cardview-v7:$versions.support&quot;</span><br><span class="line">    support.design = &quot;com.android.support:design:$versions.support&quot;</span><br><span class="line">    support.v4 = &quot;com.android.support:support-v4:$versions.support&quot;</span><br><span class="line">    support.coreUtils = &quot;com.android.support:support-core-utils:$versions.support&quot;</span><br><span class="line">    deps.support = support</span><br><span class="line"></span><br><span class="line">    def archLib = [:]</span><br><span class="line">    archLib.archExtensions = &quot;android.arch.lifecycle:extensions:$versions.arch&quot;</span><br><span class="line">    archLib.archRoomRuntime = &quot;android.arch.persistence.room:runtime:$versions.arch&quot;</span><br><span class="line">    archLib.archRoomCompiler = &quot;android.arch.persistence.room:compiler:$versions.arch&quot;</span><br><span class="line">    archLib.archLifecycleCommon = &quot;android.arch.lifecycle:common-java8:$versions.arch&quot;</span><br><span class="line">    deps.archLibs = archLib</span><br><span class="line"></span><br><span class="line">    def glide = [:]</span><br><span class="line">    glide.glide = &quot;com.github.bumptech.glide:glide:$versions.glide&quot;</span><br><span class="line">    glide.glideCompiler = &quot;com.github.bumptech.glide:compiler:$versions.glide&quot;</span><br><span class="line">    deps.glide = glide</span><br><span class="line"></span><br><span class="line">    def stethos = [:]</span><br><span class="line">    stethos.stetho = &quot;com.facebook.stetho:stetho:$versions.stetho&quot;</span><br><span class="line">    stethos.stethoHttp = &quot;com.facebook.stetho:stetho-okhttp3:$versions.stetho&quot;</span><br><span class="line">    deps.stetho = stethos</span><br><span class="line"></span><br><span class="line">    def okhttp = [:]</span><br><span class="line">    okhttp.okhttp = &quot;com.squareup.okhttp3:okhttp:$versions.okhttp&quot;</span><br><span class="line">    okhttp.okhttpLogging = &quot;com.squareup.okhttp3:logging-interceptor:$versions.okhttp&quot;</span><br><span class="line">    deps.okhttp = okhttp</span><br><span class="line"></span><br><span class="line">    def retrofit = [:]</span><br><span class="line">    retrofit.retrofit = &quot;com.squareup.retrofit2:retrofit:$versions.retrofit&quot;</span><br><span class="line">    retrofit.converterGson = &quot;com.squareup.retrofit2:converter-gson:$versions.retrofit&quot;</span><br><span class="line">    retrofit.adapterRxjava = &quot;com.squareup.retrofit2:adapter-rxjava2:$versions.retrofit&quot;</span><br><span class="line">    deps.retrofit = retrofit</span><br><span class="line"></span><br><span class="line">    def arouter = [:]</span><br><span class="line">    arouter.runtime = &quot;com.alibaba:arouter-api:$versions.arouterVersion&quot;</span><br><span class="line">    arouter.compiler = &quot;com.alibaba:arouter-compiler:$versions.arouterProcessor&quot;</span><br><span class="line">    deps.arouter = arouter</span><br><span class="line"></span><br><span class="line">    def dagger = [:]</span><br><span class="line">    dagger.dagger = &quot;com.google.dagger:dagger:$versions.dagger&quot;</span><br><span class="line">    dagger.daggerAndroid = &quot;com.google.dagger:dagger-android:$versions.dagger&quot;</span><br><span class="line">    dagger.daggerAndroidSupport = &quot;com.google.dagger:dagger-android-support:$versions.dagger&quot;</span><br><span class="line">    dagger.daggerCompiler = &quot;com.google.dagger:dagger-compiler:$versions.dagger&quot;</span><br><span class="line">    dagger.daggerAndroidCompiler = &quot;com.google.dagger:dagger-android-processor:$versions.dagger&quot;</span><br><span class="line">    deps.dagger = dagger</span><br><span class="line"></span><br><span class="line">    def kotlin = [:]</span><br><span class="line">    kotlin.kotlinStdlib = &quot;org.jetbrains.kotlin:kotlin-stdlib-jre8:$versions.kotlin&quot;</span><br><span class="line">    kotlin.kotlinPlugin = &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin&quot;</span><br><span class="line">    kotlin.kotlinDatabind = &quot;com.android.databinding:compiler:$versions.kotlinBind&quot;</span><br><span class="line">    deps.kotlin = kotlin</span><br><span class="line"></span><br><span class="line">    def espresso = [:]</span><br><span class="line">    espresso.core = &quot;com.android.support.test.espresso:espresso-core:$versions.espresso&quot;</span><br><span class="line">    espresso.contrib = &quot;com.android.support.test.espresso:espresso-contrib:$versions.espresso&quot;</span><br><span class="line">    espresso.intents = &quot;com.android.support.test.espresso:espresso-intents:$versions.espresso&quot;</span><br><span class="line">    deps.espresso = espresso</span><br><span class="line"></span><br><span class="line">    def atsl = [:]</span><br><span class="line">    atsl.runner = &quot;com.android.support.test:runner:$versions.atsl_runner&quot;</span><br><span class="line">    atsl.rules = &quot;com.android.support.test:rules:$versions.atsl_runner&quot;</span><br><span class="line">    deps.atsl = atsl</span><br><span class="line"></span><br><span class="line">    deps.multidex = &quot;com.android.support:multidex:1.0.1&quot;</span><br><span class="line">    deps.dialog =  &quot;com.afollestad.material-dialogs:core:$versions.dialogs&quot;</span><br><span class="line">    deps.gson = &quot;com.google.code.gson:gson:$versions.gson&quot;</span><br><span class="line">    deps.paging = &quot;android.arch.paging:runtime:$versions.paging&quot;</span><br><span class="line">    deps.dexmaker = &quot;com.linkedin.dexmaker:dexmaker-mockito:$versions.dexmaker&quot;</span><br><span class="line">    deps.constraint = &quot;com.android.support.constraint:constraint-layout:$versions.constraint&quot;</span><br><span class="line">    deps.timber = &quot;com.jakewharton.timber:timber:$versions.timber&quot;</span><br><span class="line">    deps.gradlePlugin = &quot;com.android.tools.build:gradle:$versions.gradle&quot;</span><br><span class="line">    deps.kotlinPlugin = &quot;org.jetbrains.kotlin:kotlin-gradle-plugin:$versions.kotlin&quot;</span><br><span class="line">    ext.deps = deps</span><br><span class="line"></span><br><span class="line">    def buildVersions = [:]</span><br><span class="line">    buildVersions.minSDK = 14</span><br><span class="line">    buildVersions.targetSDK = 26</span><br><span class="line">    buildVersions.compileSDK = 27</span><br><span class="line">    buildVersions.buildTools = &quot;26.0.2&quot;</span><br><span class="line">    ext.buildVersion = buildVersions</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    def addRepos(RepositoryHandler handler) &#123;</span><br><span class="line">        handler.google()</span><br><span class="line">        handler.jcenter()</span><br><span class="line">        handler.mavenCentral()</span><br><span class="line">        handler.maven &#123; url &apos;https://oss.jfrog.org/libs-snapshot&apos; &#125;</span><br><span class="line">        handler.maven &#123; url &apos;https://jitpack.io&apos; &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ext.addRepos = this.&amp;addRepos</span><br></pre></td></tr></table></figure>
<p>其中声明了所有已经用到,或者可能使用的Lib版本,以及Android sdk tools 的版本.</p>
<p><strong>2.将声明的版本,添加到项目中,方便引用</strong></p>
<p><code>/build.gradle</code></p>
<p>项目的build.gradle中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">buildscript &#123;</span><br><span class="line">    //加入引用</span><br><span class="line">    apply from: &apos;versions.gradle&apos;</span><br><span class="line"></span><br><span class="line">    //添加rep</span><br><span class="line">    addRepos(repositories)</span><br><span class="line">    dependencies &#123;</span><br><span class="line">        //由versions.gradle管理的版本</span><br><span class="line">        classpath deps.gradlePlugin</span><br><span class="line">        classpath deps.kotlinPlugin</span><br><span class="line">        // NOTE: Do not place your application dependencies here; they belong</span><br><span class="line">        // in the individual module build.gradle files</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">allprojects &#123;</span><br><span class="line">    //添加rep</span><br><span class="line">    addRepos(repositories)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>3.对Android Tools,SDK版本的控制</strong><br>项目/app/build.gradle</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">    //sdk的版本</span><br><span class="line">    compileSdkVersion buildVersion.compileSDK</span><br><span class="line">    //tools的版本</span><br><span class="line">    buildToolsVersion buildVersion.buildTools</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;</span><br><span class="line">        //sdk版本</span><br><span class="line">        minSdkVersion buildVersion.minSDK</span><br><span class="line">        targetSdkVersion buildVersion.targetSDK</span><br><span class="line">        versionCode 1  //也可以使用</span><br><span class="line">        versionName &quot;1.0&quot;</span><br><span class="line">    &#125;</span><br><span class="line">//</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4.其他Lib的依赖</strong><br>按照这样的格式即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">dependencies &#123;</span><br><span class="line">    //support</span><br><span class="line">    api deps.support.appCompat</span><br><span class="line">    api deps.support.recyclerview</span><br><span class="line">    api deps.support.cardview</span><br><span class="line">    api deps.support.design</span><br><span class="line">    api deps.multidex</span><br><span class="line">    api deps.constraint</span><br><span class="line">    //rxjava</span><br><span class="line">    api deps.rxLibs.rxJava</span><br><span class="line">    api deps.rxLibs.rxAndroid</span><br><span class="line">    api deps.rxLibs.rxRelay</span><br><span class="line">    //http</span><br><span class="line">    api deps.okhttp.okhttp</span><br><span class="line">    api deps.okhttp.okhttpLogging</span><br><span class="line">    api deps.retrofit.retrofit</span><br><span class="line">    api deps.retrofit.converterGson</span><br><span class="line">    api deps.retrofit.adapterRxjava</span><br><span class="line">    api deps.gson</span><br><span class="line">    //arch</span><br><span class="line">    api deps.archLibs.archExtensions</span><br><span class="line">    api deps.archLibs.archRoomRuntime</span><br><span class="line">    api deps.archLibs.archLifecycleCommon</span><br><span class="line">    annotationProcessor deps.archLibs.archRoomCompiler</span><br><span class="line">    //stetho</span><br><span class="line">    api deps.stetho.stetho</span><br><span class="line">    api deps.stetho.stethoHttp</span><br><span class="line">    //dialog</span><br><span class="line">    api deps.dialog</span><br><span class="line">    //glide</span><br><span class="line">    api deps.glide.glide</span><br><span class="line">    annotationProcessor deps.glide.glideCompiler</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Gradle </tag>
            
            <tag> 组件化 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[常用的Google Chrome 浏览器插件]]></title>
      <url>/Tools/%E5%B8%B8%E7%94%A8%E7%9A%84Google-Chrome-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%8F%92%E4%BB%B6/</url>
      <content type="html"><![CDATA[<p>###几个比较常用的Chrome插件</p>
<p><strong>1.<a href="https://chrome.google.com/webstore/detail/adblock/gighmmpiobklfepjocnamgkkbiglidom" target="_blank" rel="noopener">AdBlock</a></strong></p>
<p>最受欢迎的Chrome扩展，拥有超过4000万用户！屏蔽整个互联网上的广告。</p>
<p><img src="/images/adblock.png" alt="adblock"></p>
<p>推荐: ★★★</p>
<p><strong>2.<a href="https://chrome.google.com/webstore/detail/insightio-for-github/pmhfgjjhhomfplgmbalncpcohgeijonh" target="_blank" rel="noopener">Insight.io for Github</a></strong></p>
<p>Improve GitHub code browsing experienc.<br>通过插件可以在github的项目页面上,结构化的查看代码,甚至还有”引用”,”查找”等等功能.<br>就像是把github项目页,变成了一个只能查看的ide.<br>对了,还能很方便的下载单个文件</p>
<p><img src="/images/chrome_insight.io.png" alt="Insight.io for Github"></p>
<p>推荐: ★★★★★</p>
<p><strong>3.<a href="https://chrome.google.com/webstore/detail/infinity-new-tab/dbfmnekepjoapopniengjbcpnbljalfg" target="_blank" rel="noopener">Infinity新标签页</a></strong></p>
<p>重新定义了新标签页，一个追求极简美学和一站式服务体验更少的东西体验更多的功能。</p>
<p>简洁,方便,实用</p>
<p><img src="/images/chrome_infinity.png" alt="Infinity新标签页"></p>
<p>推荐:★★★★</p>
<p><strong>4.<a href="https://chrome.google.com/webstore/detail/postman/fhbjgbiflinjbdggehcddcbncdddomop" target="_blank" rel="noopener">Postman</a></strong><br>Postman makes API development faster, easier, and better.</p>
<p>更快…..哈哈<br>超级方便,模拟请求的App,支持post get,可以测试文件上传等<br>还有比较方便的一点是,可以生成当前请求的okhttp代码,虽然只能作参考…..</p>
<p>推荐:★★★★★</p>
<blockquote>
<p>和它一样的还有<a href="https://chrome.google.com/webstore/detail/restlet-client-rest-api-t/aejoelaoggembcahagimdiliamlcdmfm" target="_blank" rel="noopener">Restlet Client - REST API Testing</a></p>
</blockquote>
<p><strong>5.<a href="https://github.com/acgotaku/BaiduExporter" target="_blank" rel="noopener">BaiduExporter</a></strong><br>可以方便的把网盘的下载地址导出到aria2/aria2-rpc，支持YAAW。<br>配合Aria2GUI,可以高速下载百度云限速的文件..</p>
<p>虽然还能用,但是作者说不维护了,还有替代品:<a href="https://chrome.google.com/webstore/detail/aria2c-integration/edcakfpjaobkpdfpicldlccdffkhpbfk?hl=en-US" target="_blank" rel="noopener">Aria2c Integration</a>没有用过,不知道是否可用.</p>
<p><a href="https://aria2.github.io/" target="_blank" rel="noopener">Aria2GUI</a><br>Github : <a href="https://github.com/aria2/aria2" target="_blank" rel="noopener">https://github.com/aria2/aria2</a></p>
<p>推荐:★★★★★</p>
<p><strong>其他</strong><br>推荐:★★★</p>
<p><a href="https://chrome.google.com/webstore/detail/singlefile/mpiodijhokgodhhofbcjdecpffjipkle" target="_blank" rel="noopener">SingleFile</a><br>Archive a complete page into a single HTML file<br>可以将网页保存为单文件,方便保存</p>
<p><a href="https://chrome.google.com/webstore/detail/evernote-web-clipper/pioclpoplcdbaefihamjohnefbikjilc" target="_blank" rel="noopener">印象笔记·剪藏</a><br>使用印象笔记扩展程序一键保存精彩网页内容到印象笔记帐户。</p>
<p><a href="https://github.com/callumlocke/json-formatter" target="_blank" rel="noopener">JSON Formatter</a><br>Chrome extension for printing JSON and JSONP nicely when you visit it ‘directly’ in a browser tab.<br>Github : <a href="https://github.com/callumlocke/json-formatter" target="_blank" rel="noopener">https://github.com/callumlocke/json-formatter</a></p>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> tools </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[jni使用指南,关于.so你应该知道的]]></title>
      <url>/uncategorized/jni%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97-%E5%85%B3%E4%BA%8E-so%E4%BD%A0%E5%BA%94%E8%AF%A5%E7%9F%A5%E9%81%93%E7%9A%84/</url>
      <content type="html"><![CDATA[<p><strong>其实这些都是Android设备CPU的:</strong></p>
<blockquote>
<ul>
<li>armeabi: 早期的手机用的比较多,针对普通的或旧的arm v5 cpu,。</li>
<li>armeabiv-v7a:目前主流版本 2011年以后的生产的大部分设备,针对有浮点运算或高级扩展功能的arm v7 cpu.</li>
<li>arm64-v8a:  8代、64位ARM处理器，64位支持.</li>
<li>x86: 我们见到的模拟器大多就是这个。</li>
<li>x86_64: 64位的平板。</li>
</ul>
</blockquote>
<p>然后特意说一下x86系列的,是兼容arm的,但是性能损失特别大.</p>
<p><strong>Android加载.so的原则</strong><br>同一目录下要么所有使用jni的项目都给加上.so文件,<br>要么你就别给这个目录,也就是只要不齐全就都干掉<br>比如你的lib结构是这样的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">libs</span><br><span class="line">  -armeabi</span><br><span class="line">      -aaa.so</span><br><span class="line">      -bbb.so</span><br><span class="line">  -arm64-v8a</span><br><span class="line">      -aaa.so</span><br></pre></td></tr></table></figure>
<p>其实这种情况就是属于同一目录下,提供的.so文件不全…然而很容易出现,毕竟有些三方啊什么的,提供的.so文件并不齐全,这样的话同一个架构目录下会缺少一个或多个.so文件.</p>
<p>Android在加载某个使用jni的功能时,你并没有提供x86的.so文件,但是你有x86这个目录,那就会去x86目录下去找,<strong>没有啊</strong>然后就异常了.</p>
<p><strong>Android加载.so的目录</strong><br>1.我自己用的是</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-4f36025e8667df85.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Snip20170309_1.png"></p>
<p>也就是自己在app -&gt; src -&gt; main 下自己建立一个目录: jniLibs<br>然后放进去即可.</p>
<p>2.就是通常放在libs目录下了<br>别忘了在build.gradle文件中设置   jniLibs.srcDir </p>
<p><strong>Android排除某架构的.so</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">android &#123;</span><br><span class="line">	...</span><br><span class="line"></span><br><span class="line">    defaultConfig &#123;    </span><br><span class="line">        ...</span><br><span class="line">        ndk &#123;</span><br><span class="line">            // 设置支持的 SO 库构架</span><br><span class="line">            abiFilters &apos;armeabi&apos;, &apos;armeabi-v7a&apos;     // &apos;arm64-v8a&apos;, &apos;x86&apos;, &apos;x86_64&apos;, &apos;mips&apos;, &apos;mips64&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果编译报<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NDK integration is deprecated in the current plugin.</span><br></pre></td></tr></table></figure></p>
<p> gradle.properties 文件中添加：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">android.useDeprecatedNdk=true</span><br></pre></td></tr></table></figure></p>
<p>应该还有其他方法排除,我也就知道这一种,如果有知道其他方法的,请告知一下,谢谢</p>
]]></content>
      
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[EditText的输入属性InputType以及imeOptions]]></title>
      <url>/Android/EditText%E7%9A%84%E8%BE%93%E5%85%A5%E5%B1%9E%E6%80%A7InputType%E4%BB%A5%E5%8F%8AimeOptions/</url>
      <content type="html"><![CDATA[<p><strong>EditText的输入属性</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">android:imeOptions=&quot;flagNoExtractUi&quot;  //使软键盘不全屏显示，只占用部分屏幕</span><br><span class="line">android:imeOptions=&quot;actionNone&quot;  //输入框右侧不带任何提示</span><br><span class="line">android:imeOptions=&quot;actionGo&quot;    //右下角按键内容为&apos;开始&apos;</span><br><span class="line">android:imeOptions=&quot;actionSearch&quot;  //右下角按键为搜索</span><br><span class="line">android:imeOptions=&quot;actionSend&quot;    //右下角按键内容为&apos;发送&apos;</span><br><span class="line">android:imeOptions=&quot;actionNext&quot;   //右下角按键内容为&apos;下一步&apos;</span><br><span class="line">android:imeOptions=&quot;actionDone&quot;  //右下角按键内容为&apos;完成&apos;</span><br></pre></td></tr></table></figure></p>
<p><strong>EditText的inputType属性</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">&lt;EditText</span><br><span class="line">    android:inputType=&quot;phone&quot; //电话号码</span><br><span class="line">    android:inputType=&quot;none&quot; </span><br><span class="line">    android:inputType=&quot;text&quot;  //文本类型</span><br><span class="line">    android:inputType=&quot;textCapCharacters&quot; //字母大写 </span><br><span class="line">    android:inputType=&quot;textCapWords&quot; //首字母大写 </span><br><span class="line">    android:inputType=&quot;textCapSentences&quot; //仅第一个字母大写 </span><br><span class="line">    android:inputType=&quot;textAutoCorrect&quot; //自动完成 </span><br><span class="line">    android:inputType=&quot;textAutoComplete&quot; //自动完成 </span><br><span class="line">    android:inputType=&quot;textMultiLine&quot; //多行输入 </span><br><span class="line">    android:inputType=&quot;textImeMultiLine&quot; //输入法多行</span><br><span class="line">    android:inputType=&quot;textNoSuggestions&quot; //不提示 </span><br><span class="line">    android:inputType=&quot;textUri&quot; //网址 </span><br><span class="line">    android:inputType=&quot;textEmailAddress&quot; //电子邮件地址 </span><br><span class="line">    android:inputType=&quot;textEmailSubject&quot; //邮件主题 </span><br><span class="line">    android:inputType=&quot;textShortMessage&quot; //短讯 </span><br><span class="line">    android:inputType=&quot;textLongMessage&quot; //长信息 </span><br><span class="line">    android:inputType=&quot;textPersonName&quot; //人名 </span><br><span class="line">    android:inputType=&quot;textPostalAddress&quot; //地址</span><br><span class="line">    android:inputType=&quot;textPassword&quot; //密码 </span><br><span class="line">    android:inputType=&quot;textVisiblePassword&quot; //可见密码</span><br><span class="line">    android:inputType=&quot;textWebEditText&quot; //作为网页表单的文本 </span><br><span class="line">    android:inputType=&quot;textFilter&quot; //文本筛选过滤 </span><br><span class="line">    android:inputType=&quot;textPhonetic&quot; //拼音输入 </span><br><span class="line">    android:inputType=&quot;number&quot; //数字 </span><br><span class="line">    android:inputType=&quot;numberSigned&quot; //带符号数字格式 </span><br><span class="line">    android:inputType=&quot;numberDecimal&quot; //带小数点的浮点格式 </span><br><span class="line">    android:inputType=&quot;datetime&quot; //时间日期 </span><br><span class="line">    android:inputType=&quot;date&quot; //日期键盘 </span><br><span class="line">    android:inputType=&quot;time&quot; //时间键盘</span><br><span class="line">    /&gt;</span><br></pre></td></tr></table></figure></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[TextView中的文字颜色,点击,斜体等实现--SpannableString]]></title>
      <url>/Android/TextView%E4%B8%AD%E7%9A%84%E6%96%87%E5%AD%97%E9%A2%9C%E8%89%B2-%E7%82%B9%E5%87%BB-%E6%96%9C%E4%BD%93%E7%AD%89%E5%AE%9E%E7%8E%B0-SpannableString/</url>
      <content type="html"><![CDATA[<p><strong>一般实现方式如下</strong>:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">String html = &quot;文字&lt;font color=\&quot;red\&quot;&gt;变色&lt;/font&gt;的效果&quot;;</span><br><span class="line">tvMainShow.setText(Html.fromHtml(html));</span><br></pre></td></tr></table></figure></p>
<p>使用Html的方式来实现,简单的还好,复杂一点的真的很不方便</p>
<p>Google显然早就已经想到了这样的问题,所以  </p>
<blockquote>
<p><a href="https://developer.android.com/reference/android/text/SpannedString.html" target="_blank" rel="noopener">SpannedString</a> &amp; <a href="https://developer.android.com/reference/android/text/SpannableStringBuilder.html" target="_blank" rel="noopener">SpannableStringBuilder</a> 就是干这个的</p>
</blockquote>
<p>他们都实现了 <a href="https://developer.android.com/reference/java/lang/CharSequence.html" target="_blank" rel="noopener">CharSequence</a>,眼熟么?  <figure class="highlight plain"><figcaption><span>text)```.也就是说,你可以直接赋值给TextView</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">他们两个的区别就是    </span><br><span class="line">This is the class for text whose content is immutable but to which markup objects can be attached and detached. For mutable text, see SpannableStringBuilder</span><br><span class="line">文档说的很清楚了,就是CharSequence是固定长度的,一旦通过 new SpannableString(&quot;设置文字&quot;);则不可以更改文字内容,而SpannableStringBuilder是可以的,个人理解比较像String 和 StringBuilder 的关系</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">###不多说了,开搞:</span><br><span class="line">**1.设置文字**</span><br><span class="line">&gt;SpannableString spannableString = new SpannableString(&quot;文字的前景色与背景色&quot;);</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">**2.通过setSpan来修改文字的样式**</span><br><span class="line">```setSpan [Object what, int start, int end, int flags)</span><br></pre></td></tr></table></figure></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-e821febbebd4f8dc.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="入参.png"></p>
<p>flags:<br>Spannable.SPAN_EXCLUSIVE_EXCLUSIVE：前后都不包括<br>Spannable.SPAN_EXCLUSIVE_INCLUSIVE    ：前面不包括<br>Spannable.SPAN_INCLUSIVE_EXCLUSIVE    ：前面包括<br>Spannable.SPAN_INCLUSIVE_INCLUSIVE    ：前后都包括</p>
<p>为了说明这四个参数,有例子如下:</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-3784e1b0d6a15d73.gif?imageMogr2/auto-orient/strip" alt="flags.gif"><br>代码如下:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> *</span><br><span class="line"> * @author 王诛魔 2017/1/21 上午11:31</span><br><span class="line"> * @e-mail  phyooos@163.com</span><br><span class="line"> */</span><br><span class="line">public class MainActivity extends AppCompatActivity &#123;</span><br><span class="line"></span><br><span class="line">    @BindView(R.id.edit_show)</span><br><span class="line">    EditText etMainShow;</span><br><span class="line">    @BindView(R.id.tab_view)</span><br><span class="line">    TabLayout tabLayout;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void onCreate(@Nullable Bundle savedInstanceState) &#123;</span><br><span class="line">        super.onCreate(savedInstanceState);</span><br><span class="line">        setContentView(R.layout.activity_main);</span><br><span class="line">        ButterKnife.bind(this);</span><br><span class="line">        showText(Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">        tabLayout.setOnTabSelectedListener(new TabLayout.OnTabSelectedListener() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void onTabSelected(TabLayout.Tab tab) &#123;</span><br><span class="line">                switch (tab.getPosition()) &#123;</span><br><span class="line">                    case 0:</span><br><span class="line">                        showText(Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);</span><br><span class="line">                        break;</span><br><span class="line">                    case 1:</span><br><span class="line">                        showText(Spannable.SPAN_EXCLUSIVE_INCLUSIVE);</span><br><span class="line">                        break;</span><br><span class="line">                    case 2:</span><br><span class="line">                        showText(Spannable.SPAN_INCLUSIVE_EXCLUSIVE);</span><br><span class="line">                        break;</span><br><span class="line">                    case 3:</span><br><span class="line">                        showText(Spannable.SPAN_INCLUSIVE_INCLUSIVE);</span><br><span class="line">                        break;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onTabUnselected(TabLayout.Tab tab) &#123;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            @Override</span><br><span class="line">            public void onTabReselected(TabLayout.Tab tab) &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    /**</span><br><span class="line">     * 展示文字</span><br><span class="line">     */</span><br><span class="line">    private void showText(int type) &#123;</span><br><span class="line">        //构造SpannableString</span><br><span class="line">        SpannableString spanString = new SpannableString(&quot;这里是王诛魔的简书文章&quot;);</span><br><span class="line">        //字体颜色的Span</span><br><span class="line">        ForegroundColorSpan span = new ForegroundColorSpan(Color.RED);</span><br><span class="line">        //指定范围</span><br><span class="line">        spanString.setSpan(span, 3, 6, type);</span><br><span class="line">        //设置给EditText显示出来</span><br><span class="line">        etMainShow.setText(spanString);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>上面的代码中:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//字体颜色的Span</span><br><span class="line">ForegroundColorSpan span = new ForegroundColorSpan(Color.RED);</span><br><span class="line">ForegroundColorSpan就是设置的文字样式,,这个是前景色,,也就是字体的颜色</span><br><span class="line">//指定范围</span><br><span class="line">spanString.setSpan(span, 3, 6, type);</span><br><span class="line">这里的三个参数已经在上面说过了,通过上面的代码也会发现,其实3,6  其中下标3是包含的,而下标6就不会改变</span><br></pre></td></tr></table></figure></p>
<hr>
<p><strong>3.至于Span的这些个样式在哪里找,请看文档:</strong><br><strong>关键词:<a href="https://developer.android.com/reference/android/text/style/CharacterStyle.html" target="_blank" rel="noopener">CharacterStyle</a></strong></p>
<blockquote>
<p><a href="https://developer.android.com/reference/android/text/style/CharacterStyle.html" target="_blank" rel="noopener">https://developer.android.com/reference/android/text/style/CharacterStyle.html</a></p>
</blockquote>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-50978874ad4c3a7f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="Span的一些类型.png"></p>
<p>说几个常用的吧:</p>
<ul>
<li>ForegroundColorSpan  字体颜色</li>
<li>BackgroundColorSpan 字体背景色设置</li>
<li>AbsoluteSizeSpan 字体大小</li>
<li>StyleSpan 粗体等<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">//字体由Typeface来控制</span><br><span class="line">StyleSpan span = new StyleSpan(Typeface.BOLD_ITALIC);</span><br><span class="line"></span><br><span class="line">- UnderlineSpan 下划线</span><br><span class="line">- ImageSpan 图片置换</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">[ImageSpan https://developer.android.com/reference/android/text/style/ImageSpan.html](https://developer.android.com/reference/android/text/style/ImageSpan.html)</span><br><span class="line"></span><br><span class="line">这个有一点不同,它是将文字中的指定部分替换为一个图片,至于如何构造请参考文档</span><br><span class="line">让我想起来了那个EmojiEditText的库,其实可以用这个ImageSpan实现一个简单的可以显示表情的TextView</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">- ClickableSpan 点击</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>//这个有些不同,需要<br>class CustomClickable extends ClickableSpan {</p>
<pre><code>@Override
public void updateDrawState(TextPaint ds) {
    //这里其实还可以对可点击部分设置一些东西
}

@Override
public void onClick(View widget) {
      ...do something
}
</code></pre><p>}</p>
<p>//对了,加上这行代码<br>TextView.setMovementMethod(LinkMovementMethod.getInstance());<br>//要不点不动哦</p>
<p>```</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-7ccd2161c4d5f5e7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="2017-04-05_23-36-38.png"></p>
<ul>
<li>URLSpan 这个完全可以用ClickableSpan实现</li>
</ul>
<p><strong>SpannableStringBuilder</strong></p>
<p>SpannableString都说的这么明白了,SpannableStringBuilder就省了</p>
<p>####End</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Flutter 安装]]></title>
      <url>/Flutter/Flutter-%E5%AE%89%E8%A3%85/</url>
      <content type="html"><![CDATA[<blockquote>
<p>使用系统Mac OS</p>
</blockquote>
<p>已经没办法给大家看问题了,我在github上提了问题.</p>
<p><a href="https://github.com/flutter/flutter/issues/11674" target="_blank" rel="noopener">github issue</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">使用命令 command</span><br><span class="line"></span><br><span class="line">`flutter doctor`</span><br><span class="line"></span><br><span class="line">异常:</span><br><span class="line">exception</span><br><span class="line"></span><br><span class="line">SocketException: SocketException: Connection failed (OS Error: No route to host, errno = 65), address = android.googlesource.com, port = 443</span><br></pre></td></tr></table></figure>
<p>总的来说就是下载 Downloading Gradle Wrapper…的时候连接不到外网,以至于失败</p>
<p>github上的这位小哥提醒了我<a href="https://github.com/lishuhao" target="_blank" rel="noopener">@lishuhao</a></p>
<blockquote>
<p><a href="https://github.com/eseidelgoogle" target="_blank" rel="noopener">@eseidelGoogle</a>it’s reachable via https from Chrome<br>Maybe his chrome use proxy but terminal not use proxy.</p>
</blockquote>
<p>我确实开了ss,但是终端确实连接不到代理的,不走代理,那当然无解</p>
<p>##解决:</p>
<p>####1.Mac下使用Homebrew安装</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew install polipo</span><br></pre></td></tr></table></figure>
<p>####2.修改配置</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -sfv /usr/local/opt/polipo/*.plist ~/Library/LaunchAgents</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-bfa92bf302955c0d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vim /usr/local/opt/polipo/homebrew.mxcl.polipo.plist</span><br></pre></td></tr></table></figure>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-b14154bf99746494.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>在配置文件中添加<br><code>&lt;string&gt;socksParentProxy=localhost:1086&lt;/string&gt;</code></p>
<p>其中1086这个端口号,自己去看</p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-40564c01c67e3f13.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240" alt="image.png"></p>
<p>####3.启动</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">launchctl load ~/Library/LaunchAgents/homebrew.mxcl.polipo.plist</span><br></pre></td></tr></table></figure>
<p>####4.使用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ http_proxy=http://localhost:8123 curl ip.gs</span><br><span class="line">Current IP / 当前 IP: 47.90.88.133</span><br><span class="line">ISP / 运营商:  ALIYUN</span><br><span class="line">City / 城市:  Hong Kong</span><br><span class="line">Country / 国家: China</span><br><span class="line">IP.GS is now IP.SB, please visit https://ip.sb/ for more IP information, ip.gs will only use for curl purpose. / IP.GS 已更新至 IP.SB 请访问 https://ip.sb/ 获取更多信息, ip.gs 域名仅作 curl 使用</span><br><span class="line">Please join Telegram group https://t.me/sbfans if you have any issues. / 如有问题，请加入 Telegram 群 https://t.me/sbfans</span><br></pre></td></tr></table></figure>
<p>可以看到,现在我是香港的IP了,http_proxy=<a href="http://localhost:8123这个是提供默认的,至于怎么修改我没有看,也不知道" target="_blank" rel="noopener">http://localhost:8123这个是提供默认的,至于怎么修改我没有看,也不知道</a></p>
<p><strong>把代理设置为全局的</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">~ ⌚ 11:42:51</span><br><span class="line">$ export http_proxy=http://localhost:8123</span><br><span class="line"></span><br><span class="line">~ ⌚ 11:43:02</span><br><span class="line">$ export https_proxy=http://localhost:8123</span><br><span class="line"></span><br><span class="line">~ ⌚ 11:43:09</span><br><span class="line">$ curl https://www.google.com</span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;</span><br><span class="line">&lt;H1&gt;302 Moved&lt;/H1&gt;</span><br><span class="line">The document has moved</span><br><span class="line">&lt;A HREF=&quot;https://www.google.com.hk/?gfe_rd=cr&amp;ei=5FaaWZDNOMLU8Af_nriwDw&quot;&gt;here&lt;/A&gt;.</span><br><span class="line">&lt;/BODY&gt;&lt;/HTML&gt;</span><br><span class="line"></span><br><span class="line">~ ⌚ 11:43:33</span><br><span class="line">$ curl www.google.com</span><br><span class="line">&lt;HTML&gt;&lt;HEAD&gt;&lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot;&gt;</span><br><span class="line">&lt;TITLE&gt;302 Moved&lt;/TITLE&gt;&lt;/HEAD&gt;&lt;BODY&gt;</span><br><span class="line">&lt;H1&gt;302 Moved&lt;/H1&gt;</span><br><span class="line">The document has moved</span><br><span class="line">&lt;A HREF=&quot;http://www.google.com.hk/?gfe_rd=cr&amp;ei=6laaWZqEO8_U8AeLlID4CA&quot;&gt;here&lt;/A&gt;.</span><br><span class="line">&lt;/BODY&gt;&lt;/HTML&gt;</span><br></pre></td></tr></table></figure></p>
<p>####5.End</p>
<p>##见证奇迹的时刻到了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">~/develop/flutter on  alpha! ⌚ 11:44:11</span><br><span class="line">$ flutter doctor</span><br><span class="line">Downloading Gradle Wrapper...                         1.3s</span><br><span class="line">[✓] Flutter (on Mac OS X 10.12.6 16G29, locale zh-Hans-CN, channel alpha)</span><br><span class="line">    • Flutter at /Users/phyooos/develop/flutter</span><br><span class="line">    • Framework revision b156a0f054 (9 days ago), 2017-08-11 22:01:40 -0700</span><br><span class="line">    • Engine revision fef7d827d6</span><br><span class="line">    • Tools Dart version 1.25.0-dev.9.0</span><br><span class="line"></span><br><span class="line">[✓] Android toolchain - develop for Android devices (Android SDK 26.0.1)</span><br><span class="line">    • Android SDK at /Users/phyooos/Library/Android/sdk</span><br><span class="line">    • Platform android-26, build-tools 26.0.1</span><br><span class="line">    • ANDROID_HOME = /Users/phyooos/Library/Android/sdk</span><br><span class="line">    • Java binary at: /Applications/Android Studio.app/Contents/jre/jdk/Contents/Home/bin/java</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 1.8.0_112-release-b06)</span><br><span class="line"></span><br><span class="line">[-] iOS toolchain - develop for iOS devices</span><br><span class="line">    ✗ Xcode installation is incomplete; a full installation is necessary for iOS development.</span><br><span class="line">      Download at: https://developer.apple.com/xcode/download/</span><br><span class="line">      Or install Xcode via the App Store.</span><br><span class="line">      Once installed, run:</span><br><span class="line">        sudo xcode-select --switch /Applications/Xcode.app/Contents/Developer</span><br><span class="line">    ✗ libimobiledevice and ideviceinstaller are not installed or require updating. To update, run:</span><br><span class="line">        brew uninstall --ignore-dependencies libimobiledevice</span><br><span class="line">        brew install --HEAD libimobiledevice</span><br><span class="line">        brew install ideviceinstaller</span><br><span class="line">    ✗ ios-deploy not installed. To install:</span><br><span class="line">        brew install ios-deploy</span><br><span class="line">    ✗ CocoaPods not installed.</span><br><span class="line">        CocoaPods is used to retrieve the iOS platform side&apos;s plugin code that responds to your plugin usage on the Dart side.</span><br><span class="line">        Without resolving iOS dependencies with CocoaPods, plugins will not work on iOS.</span><br><span class="line">        For more info, see https://flutter.io/platform-plugins</span><br><span class="line">      To install:</span><br><span class="line">        brew install cocoapods</span><br><span class="line">        pod setup</span><br><span class="line"></span><br><span class="line">[✓] Android Studio (version 2.3)</span><br><span class="line">    • Android Studio at /Applications/Android Studio.app/Contents</span><br><span class="line">    • Java version OpenJDK Runtime Environment (build 1.8.0_112-release-b06)</span><br><span class="line"></span><br><span class="line">[✓] IntelliJ IDEA Ultimate Edition (version 2017.1.3)</span><br><span class="line">    • Flutter plugin version 16.0</span><br><span class="line">    • Dart plugin version 171.4424.63</span><br><span class="line"></span><br><span class="line">[✓] Connected devices</span><br><span class="line">    • None</span><br></pre></td></tr></table></figure>
<p>我的Flutter就ok了</p>
]]></content>
      
        <categories>
            
            <category> Flutter </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Google </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[BottomNavigationView使用指南]]></title>
      <url>/Android/BottomNavigationView%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      <content type="html"><![CDATA[<p><strong>最终效果:</strong></p>
<p><img src="http://upload-images.jianshu.io/upload_images/2520304-f952921225e06fb8.gif?imageMogr2/auto-orient/strip" alt="最后效果.gif"></p>
<p>Android Support Library 25 以上的support包中增加了 BottomNavigationView<br>所以你必须使用<code>com.android.support:design:25.0.0</code>以上的版本才能玩</p>
<p>1.在 build.gradle 文件中增加依赖：</p>
<blockquote>
<figure class="highlight plain"><figcaption><span>'com.android.support:design:25.0.0'```</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">2.在main_activity.xml中添加:</span><br></pre></td></tr></table></figure>
</blockquote>
<p><android.support.design.widget.bottomnavigationview android:id="@+id/bottom_nav" android:layout_width="match_parent" android:layout_height="@dimen/title_height" android:layout_alignparentbottom="true" app:menu="@menu/menu_tab_button" app:itemicontint="@color/nav_color_select" app:itemtextcolor="@color/nav_color_select" app:itembackground="@color/text_white_color"><br>    </android.support.design.widget.bottomnavigationview></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 其中```app:menu=&quot;@menu/menu_tab_button&quot;```决定了展示几个item,都长什么样</span><br><span class="line">- 其中,分别决定**图标和文字**选中和未选中item的状态,颜色</span><br></pre></td></tr></table></figure>
<p>app:itemIconTint=”@color/nav_color_select”<br>app:itemTextColor=”@color/nav_color_select”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- 其中```app:itemBackground=&quot;@color/text_white_color&quot;```则是整个view的背景颜色</span><br><span class="line"></span><br><span class="line">3.menu_tab_button.xml的代码如下:</span><br></pre></td></tr></table></figure></p>
<p>&lt;?xml version=”1.0” encoding=”utf-8”?&gt;</p>
<p><menu xmlns:android="http://schemas.android.com/apk/res/android" xmlns:app="http://schemas.android.com/apk/res-auto"><br>    <item android:id="@+id/mian_tab_statistics" android:enabled="true" android:checked="true" 默认选中="" android:title="@string/nav_tongji" android:icon="@drawable/tongji"></item></menu></p>
<pre><code>&lt;item android:id=&quot;@+id/mian_tab_paidui&quot;
    android:enabled=&quot;true&quot;
    android:title=&quot;@string/nav_paidui&quot;   //文字内容
    android:icon=&quot;@drawable/paidui&quot;/&gt;   //icon图标

&lt;item android:id=&quot;@+id/mian_tab_find&quot;
    android:enabled=&quot;true&quot;
    android:title=&quot;@string/nav_faxiang&quot;
    android:icon=&quot;@drawable/faxian&quot;/&gt;

&lt;item android:id=&quot;@+id/mian_tab_more&quot;
    android:enabled=&quot;true&quot;
    android:title=&quot;@string/nav_more&quot;
    android:icon=&quot;@drawable/more&quot;/&gt;
</code></pre><p><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">###然而,你以为会这么简单?? shiftingMode教你做人()</span><br><span class="line">###这个只会在item个数超过3个才会出现.</span><br><span class="line"></span><br><span class="line">![牛逼的特效(shiftingMode).gif](http://upload-images.jianshu.io/upload_images/2520304-464b090fa4c8919c.gif?imageMogr2/auto-orient/strip)</span><br><span class="line"></span><br><span class="line">4.这让我如何是好?看了半天,在网上找到一个方法.</span><br></pre></td></tr></table></figure></p>
<p>/**</p>
<ul>
<li>一个关于BottomNavigationView的帮助类,用来关闭shiftingMode</li>
<li>@author 王诛魔 2017/2/10 下午6:35</li>
<li>@e-mail phyooos@163.com<br>*/</li>
</ul>
<p>public class BNVHelper {</p>
<pre><code>public static void disableShiftMode(BottomNavigationView navigationView) {
    BottomNavigationMenuView menuView = (BottomNavigationMenuView) navigationView.getChildAt(0);
    try {
        Field shiftingMode = menuView.getClass().getDeclaredField(&quot;mShiftingMode&quot;);
        shiftingMode.setAccessible(true);
        shiftingMode.setBoolean(menuView, false);
        shiftingMode.setAccessible(false);

        for (int i = 0; i &lt; menuView.getChildCount(); i++) {
            BottomNavigationItemView itemView = (BottomNavigationItemView) menuView.getChildAt(i);
            itemView.setShiftingMode(false);
            itemView.setChecked(itemView.getItemData().isChecked());
        }
    } catch (NoSuchFieldException e) {
        // Log
    } catch (IllegalAccessException e) {
        // Log
    }
}
</code></pre><p>}<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line">原作者@[ChristmasJason](http://www.jianshu.com/u/4d132a94e6e8):http://www.jianshu.com/p/e2a8791e80d6</span><br><span class="line"></span><br><span class="line">然后我看了一下源码**mShiftingMode** 这个布尔值决定了是否启用shiftingMode,所以上面的方法就是shiftingMode.setBoolean(menuView, false);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">然后就好了......</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">提示:</span><br><span class="line">google说选中图标的颜色是这么改的,然而都是骗人的,这个应该是默认的设置,我也偷懒没有验证</span><br><span class="line"></span><br><span class="line">![2017-02-21_17-59-10.png](http://upload-images.jianshu.io/upload_images/2520304-c6c71ad14a9e0106.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240)</span><br></pre></td></tr></table></figure></p>
<p>app:itemIconTint=”@color/nav_color_select”<br>app:itemTextColor=”@color/nav_color_select”<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">其实你配置了之后,就是这个东西来决定的,而不是app&apos;s primary color</span><br><span class="line">nav_color_select.xml这就是个选择器,代码如下:</span><br></pre></td></tr></table></figure></p>
<p>&lt;?xml version=”1.0” encoding=”utf-8”?&gt;</p>
<p><selector xmlns:android="http://schemas.android.com/apk/res/android"><br>    <item android:state_checked="true" android:color="@color/colorPrimary"><br>    <item android:state_pressed="true" android:color="@color/colorPrimary"><br>    <item android:color="@color/gray_light"><br></item></item></item></selector><br>```</p>
<p>####End,到这里你的导航条也应该ok了</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio 使用正式签名debug调试]]></title>
      <url>/Android-Studio/Android-Studio-%E4%BD%BF%E7%94%A8%E6%AD%A3%E5%BC%8F%E7%AD%BE%E5%90%8Ddebug%E8%B0%83%E8%AF%95/</url>
      <content type="html"><![CDATA[<p>###解决问题:</p>
<blockquote>
<p>很多时候我们使用第三方登录什么的东西,需要我们提供正式签名,但是我们总是需要调试的.<br>一般情况,我们不可能一次性OK,那么每一次调试都需要正式签名打包,并安装,然后再调试,这也太麻烦了,.</p>
</blockquote>
<p>所以,直接上代码:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            keyAlias &apos;phyooos&apos;</span><br><span class="line">            keyPassword &apos;phyooos&apos;</span><br><span class="line">            storeFile file(&apos;phyooos.jks&apos;)</span><br><span class="line">            storePassword &apos;phyooos&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        debug&#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p><strong>解释一下:</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">signingConfigs &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            keyAlias &apos;phyooos&apos;</span><br><span class="line">            keyPassword &apos;phyooos&apos;</span><br><span class="line">            storeFile file(&apos;phyooos.jks&apos;)</span><br><span class="line">            storePassword &apos;phyooos&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这一段代码写在项目app目录下&gt;gradle配置文件中&gt;android节点下,<br>是我们自定义的一个配置</p>
<ul>
<li>keyAlias ‘phyooos’  这是签名文件的Alias</li>
<li>keyPassword ‘phyooos’   这是签名文件的密码</li>
<li>storeFile file(‘phyooos.jks’)  这个就是签名文件的地址,我放在app目录下了</li>
<li>storePassword ‘phyooos’  这是store密码</li>
</ul>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">buildTypes &#123;</span><br><span class="line">        release &#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">        debug&#123;</span><br><span class="line">            minifyEnabled false</span><br><span class="line">            signingConfig signingConfigs.release</span><br><span class="line">            proguardFiles getDefaultProguardFile(&apos;proguard-android.txt&apos;), &apos;proguard-rules.pro&apos;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>这一段的意思就是debug调试以及正式打包都使用上面自定义的配置</p>
<h4 id="The-End-好了-愉快的玩耍吧"><a href="#The-End-好了-愉快的玩耍吧" class="headerlink" title="The End   好了,愉快的玩耍吧"></a>The End   好了,愉快的玩耍吧</h4>]]></content>
      
        <categories>
            
            <category> Android Studio </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Studio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[低功耗蓝牙iBeacon的开发笔记]]></title>
      <url>/Android/%E4%BD%8E%E5%8A%9F%E8%80%97%E8%93%9D%E7%89%99iBeacon%E7%9A%84%E5%BC%80%E5%8F%91%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<p>###1.挣扎的开始<br>各种百度,google,发现国内资料很少,有的也是商业公司提供的sdk,这并不符合我需要,<br>google倒是不少,然而以我的英语水平,望洋兴叹罢了@<br>不发牢骚了:</p>
<blockquote>
<p>首先你需要了解这些资料<br>1、profile<br> rofile可以理解为一种规范，一个标准的通信协议，它存在于从机中。蓝牙组织规定了一些标准的profile，例如 HID OVER GATT ，防丢器 ，心率计等。每个profile中会包含多个service，每个service代表从机的一种能力。</p>
<p>2、service<br>service可以理解为一个服务，在ble从机中，通过有多个服务，例如电量信息服务、系统信息服务等，每个service中又包含多个characteristic特征值。每个具体的characteristic特征值才是ble通信的主题。比如当前的电量是80%，所以会通过电量的characteristic特征值存在从机的profile里，这样主机就可以通过这个characteristic来读取80%这个数据</p>
<p>3、characteristic<br>characteristic特征值，ble主从机的通信均是通过characteristic来实现，可以理解为一个标签，通过这个标签可以获取或者写入想要的内容。</p>
<p>4、UUID<br>UUID，统一识别码，我们刚才提到的service和characteristic，都需要一个唯一的uuid来标识<br> S: 百度到的,我以一个过来人的身份保证这个很重要</p>
</blockquote>
<p>###2.资料,准备<br>资料看这里:</p>
<ul>
<li>这也是最重要的资料来源,谷歌SDK的例子里面有的项目<br><img src="http://img.blog.csdn.net/20160710190336812" alt="Android SDK 中的doc文档"></li>
</ul>
<ul>
<li>接上文,说完资料,<blockquote>
<p>这是一个很好的demo<br>sdk\samples\android-22\connectivity\BluetoothLeGatt</p>
</blockquote>
</li>
</ul>
<p>该目录下为谷歌提供的demo,我的应用也是在它的基础上改进而成的.<br>由以下部分组成:<br>1.一个服务 BluetoothLeService,主负责与蓝牙设备进行数据交换</p>
<p>2.两个activity:DeviceControlActivity,DeviceScanActivity<br>    见名知意,一个负责扫描设备,而两外一个与设备进行交互</p>
<p>3.一个SampleGattAttributes<br>   主要是存储了一些UUID,我对它进行了加强</p>
<p>###3.BLE设备的使用步骤概况<br>1.首先要说明的一点是,要求Android版本为4.3及其以上<br>  接着确认设备支持<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 支持BLE</span><br><span class="line"> *  check to determine whether BLE is supported on the device</span><br><span class="line"> */</span><br><span class="line">public void isSupported()&#123;</span><br><span class="line">     if (!getPackageManager().hasSystemFeature(PackageManager.FEATURE_BLUETOOTH_LE)) &#123;</span><br><span class="line">            Toast.makeText(this, &quot;设备不支持BLE功能&quot;, Toast.LENGTH_SHORT).show();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>2.确认手机支持并打开蓝牙的状态下,你就可以进行设备的搜索了<br>   有两种模式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">//第一种</span><br><span class="line">//serviceUuids   指定设备的UUID</span><br><span class="line">//callback       搜索的回调</span><br><span class="line">startLeScan(final UUID[] serviceUuids, final LeScanCallback callback)</span><br><span class="line"></span><br><span class="line">//第二种</span><br><span class="line">//其实就是不传入serviceUuids的,就是说搜索范围内所有蓝牙设备</span><br><span class="line">public boolean startLeScan(LeScanCallback callback) &#123;</span><br><span class="line">     return startLeScan(null, callback);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>3.同时记得停止搜索,当然你也可以一直搜<br>PS：其实我见到的app大部分是不停的搜索，这样的话会有一个广播数据持续刷新的效果,那么很多的距离判断什么的都是通过这种不停搜索的形式来工作的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">//mBluetoothAdapter   请自行查看谷歌文档</span><br><span class="line">//mLeScanCallback     这就是上面提过的LeScanCallback的实例</span><br><span class="line">mBluetoothAdapter.stopLeScan(mLeScanCallback);</span><br></pre></td></tr></table></figure></p>
<p>接着就是在回调中拿到各个设备数据了<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * 搜索设备回调 </span><br><span class="line"> */</span><br><span class="line">private BluetoothAdapter.LeScanCallback mLeScanCallback =</span><br><span class="line">            new BluetoothAdapter.LeScanCallback() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    public void onLeScan(final BluetoothDevice device, int rssi, </span><br><span class="line">            byte[] scanRecord) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure></p>
<p>这里有几个值得说一下的东西</p>
<ul>
<li><strong>1.BluetoothDevice device</strong><br><img src="http://img.blog.csdn.net/20160712000123059" alt="这里写图片描述"><br>  该可以看的很清楚,    device中包含了设备的基本信息               </li>
</ul>
<ul>
<li><strong>2.rssi信号质量,也有人告诉我是质量</strong><br>不过我这次并没有使用到</li>
</ul>
<ul>
<li><strong>3.byte[] scanRecord (重头戏)</strong><br>广播响应包数据<br>一般包括两个部分,我使用的主要是ServiceData域<br><strong>在这里需要注意的是，这两个部分都存在于广播数据，而且并不是两部分都有，有可能是只有一个部分，所以一定要看情设备的硬件规范，因为这涉及到后面解析广播数据</strong></li>
</ul>
<p>要知道，我们都是拿byte[]数组中的某些部分对应特定值,一旦对应关系打乱，那么数据解析就没什么正确性可言了<br>这些广播数据都是依据一定的规则指定 的,所以这时候你需要设备厂商的文档来查看对应的数据,以及其结构<br>PS:需要注意的一点是,这些数据都是byte[],你需要将它们转化(一般常用的做法是,先转化为16进制的字符串,而后再进行读取解析)</p>
<p>###4.读取蓝牙设备内部数据<br>这里涉及到两个重要部分<br>service  以及 characteristic</p>
<p>一般来说<br> 一个Service  eg: FF01-XXXXXXXXXXX-XXXXX<br> 下面可能有很多的characteristic<br>Marjor : FF16 -XXXXXX<br>Power : FF17 - XXX<br>….一堆的characteristic </p>
<ul>
<li><strong>如果需要给指定的项目写入一个数据</strong><br> 条件：<pre><code>1.此特征在哪个Service下，即该service的UUID
2.该特征的UUID
3.该特征的写入格式，16进制还是其他的东西
</code></pre></li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">//代码片段1</span><br><span class="line">//此方法获取对应特征值的对象BluetoothGattCharacteristic的实体</span><br><span class="line">    public BluetoothGattCharacteristic getCharacteristic(String service,String charact) &#123;</span><br><span class="line">        if (mBluetoothGatt == null) return null;</span><br><span class="line">        if(mBluetoothGatt.getService(UUID.fromString(service))==null)&#123;return null ;&#125;</span><br><span class="line">        return mBluetoothGatt.getService(UUID.fromString(service)).getCharacteristic(UUID.fromString(charact));</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">//代码片段2</span><br><span class="line">if(!TextUtils.isEmpty(value))&#123;//输入非空</span><br><span class="line">      byte[] arrayOfByte= new byte[2];//传入数据规定为2个byte</span><br><span class="line">      arrayOfByte[0] = ((byte)Integer.parseInt((value).substring(0, 2), 16));</span><br><span class="line">      arrayOfByte[1] = ((byte)Integer.parseInt((value).substring(2, 4), 16));</span><br><span class="line">      //上面操作，先切，再转为16进制</span><br><span class="line">      characteristic.setValue(arrayOfByte);</span><br><span class="line">      //characteristic实体就是片段1代码获取到的</span><br><span class="line">      gattServer.writeCharacteristic(characteristic);</span><br><span class="line">      //所有的操作都封装在一个service中，gattServer为其实体对象</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">//片段3就是服务中的写入方法</span><br><span class="line">/**</span><br><span class="line">   * 写入一个数据</span><br><span class="line">   * @param characteristic</span><br><span class="line">   */</span><br><span class="line">  public void writeCharacteristic(BluetoothGattCharacteristic characteristic) &#123;</span><br><span class="line">      mBluetoothGatt.setCharacteristicNotification(characteristic, true);</span><br><span class="line">      mBluetoothGatt.writeCharacteristic(characteristic);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">//代码片段4   这是回调，</span><br><span class="line">//在连接时就作为参数传入了 mBluetoothGatt = device.connectGatt(this, false, mGattCallback);</span><br><span class="line">private final BluetoothGattCallback mGattCallback = new BluetoothGattCallback() &#123;</span><br><span class="line">        @Override</span><br><span class="line">        public void onConnectionStateChange(BluetoothGatt gatt, int status, int newState) &#123;</span><br><span class="line">            if (newState == BluetoothProfile.STATE_CONNECTED) &#123;            </span><br><span class="line">                Log.e(TAG, &quot;连接至 GATT server.&quot;);</span><br><span class="line">            &#125; else if (newState == BluetoothProfile.STATE_DISCONNECTED) &#123;</span><br><span class="line">                Log.e(TAG, &quot;断开 GATT server.&quot;);             </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onServicesDiscovered(BluetoothGatt gatt, int status) &#123;</span><br><span class="line">            if (status == BluetoothGatt.GATT_SUCCESS) &#123;</span><br><span class="line">                Log.e(TAG, &quot;建立连接成功&quot;);              </span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                Log.e(TAG, &quot;连接状态异常: &quot; + status);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onCharacteristicWrite(BluetoothGatt gatt, BluetoothGattCharacteristic characteristic, int status) &#123;</span><br><span class="line">            if (status == BluetoothGatt.GATT_SUCCESS) &#123;</span><br><span class="line">                  Log.e(TAG, &quot;写入数据成功&quot;);   </span><br><span class="line">            &#125; </span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onCharacteristicRead(BluetoothGatt gatt, BluetoothGattCharacteristic</span><br><span class="line">                characteristic, int status) &#123;</span><br><span class="line">            if (status == BluetoothGatt.GATT_SUCCESS) &#123;</span><br><span class="line">               Log.e(TAG, &quot;读取数据成功&quot;);   </span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        @Override</span><br><span class="line">        public void onCharacteristicChanged(BluetoothGatt gatt,</span><br><span class="line">                                            BluetoothGattCharacteristic characteristic) &#123;</span><br><span class="line">            Log.e(TAG, &quot;连接状态发生改变&quot;);      </span><br><span class="line">        &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>PS:<strong>这里的例子是写入，其实读取的操作与此类似，操作完成后在回调里面判断状态以及读取数据即可</strong></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> 蓝牙 </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio 基本设置]]></title>
      <url>/Android-Studio/Android-Studio-%E5%9F%BA%E6%9C%AC%E8%AE%BE%E7%BD%AE/</url>
      <content type="html"><![CDATA[<p>####1.常用的快捷键</p>
<ul>
<li>ALT + Enter 自动提示</li>
<li><p>ALT + Ins<br><img src="http://img.blog.csdn.net/20160503215809984" alt="这里写图片描述"></p>
<blockquote>
<p>get set 构造方法  重写方法<br>以及一些插件如这里的 GsonFormat 以及 Butterknife</p>
</blockquote>
</li>
<li><p>Ctrl + Alt + F  全局变量</p>
</li>
<li><p>Ctrl +Shift + Enter   加; 以及if 的(){}</p>
</li>
<li><p>Ctrl + P  以及  Ctrl + Q  方法参数以及文档</p>
</li>
<li><p>Ctrl +O 继承重写的方法</p>
</li>
<li><p>Ctrl + /   Ctrl +Shift + /    注释</p>
</li>
<li><p>Ctrl + Alt + L 格式化</p>
</li>
<li><p>Ctrl + D  Ctrl + Y   复制 删除行</p>
</li>
<li><p>Ctrl + Shift + U 大小写</p>
</li>
<li><p>Shift Shift     Ctrl + F  全局  当前 搜索 </p>
</li>
<li><p>Ctrl + U 到父类</p>
</li>
<li><p>Ctrl + Alt + B 找到子类</p>
</li>
<li><p>Ctrl + H     类结构</p>
</li>
<li><p>Ctrl+Shift + H   方法层次</p>
</li>
<li><p>Ctrl + Alt + H   调用层次</p>
</li>
<li><p>Alt + F7  find use  非常好用的功能</p>
</li>
<li><p>Shift + F6  重命名</p>
</li>
<li><p>logt + Enter    Tag </p>
</li>
<li><p>loge logd …    打印log</p>
</li>
</ul>
<hr>
<p>####2.自动生成代码 </p>
<blockquote>
<p>Ctrl  + J   </p>
</blockquote>
<p><img src="http://img.blog.csdn.net/20160503222913571" alt="这里写图片描述"></p>
<p>里面相当多的模版代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if 判空     ifn</span><br><span class="line">for 循环     for </span><br><span class="line">foreach     foreach</span><br><span class="line">setVisibility     gone</span><br><span class="line">findViewById   fbc</span><br><span class="line">instanceof    inst</span><br></pre></td></tr></table></figure></p>
<p>这些比较常用</p>
<p>####3.自动导入包<br>Settings&gt;Editor&gt;General&gt;Auto import<br><img src="http://img.blog.csdn.net/20160503215409545" alt="这里写图片描述"></p>
<p>####4.其他设置已经导出</p>
<blockquote>
<p>ps : 在百度云里有<br><img src="http://img.blog.csdn.net/20160503223900468" alt="这里写图片描述"></p>
</blockquote>
]]></content>
      
        <categories>
            
            <category> Android Studio </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android Studio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Android Studio 导入 Vitamio及横竖屏切换]]></title>
      <url>/Android-Studio/Android-Studio-%E5%AF%BC%E5%85%A5-Vitamio%E5%8F%8A%E6%A8%AA%E7%AB%96%E5%B1%8F%E5%88%87%E6%8D%A2/</url>
      <content type="html"><![CDATA[<p>##建议不要使用Vitamio,各种深坑</p>
<blockquote>
<p><a href="https://github.com/Bilibili/ijkplayer看看bilibili的开源播放器" target="_blank" rel="noopener">https://github.com/Bilibili/ijkplayer看看bilibili的开源播放器</a></p>
</blockquote>
<p>##Vitamio<br>官方:<a href="https://www.vitamio.org/" target="_blank" rel="noopener">https://www.vitamio.org/</a><br>GitHub:<a href="https://github.com/yixia/VitamioBundle" target="_blank" rel="noopener">https://github.com/yixia/VitamioBundle</a></p>
<blockquote>
<p><a href="https://www.vitamio.org/" target="_blank" rel="noopener">Vitamio</a> 能够流畅播放720P甚至1080P高清MKV，FLV，MP4，MOV，TS，RMVB等常见格式的视频，支持 MMS, RTSP, RTMP, HLS(m3u8) 等常见的多种视频流媒体协议，包括点播与直播。</p>
</blockquote>
<p>###1.下载Vitamio<br>  <img src="http://img.blog.csdn.net/20160408235109325" alt="去官网下载即可"></p>
<ul>
<li>地址<a href="https://www.vitamio.org/Download/" target="_blank" rel="noopener">https://www.vitamio.org/Download/</a></li>
</ul>
<hr>
<p>###2.解压并导入Android</p>
<ul>
<li><p>找到到文件夹VitamioBundle</p>
<p><img src="http://img.blog.csdn.net/20160408235743265" alt="VitamioBundle"></p>
</li>
<li><p>File &gt; New &gt; New Module<br><img src="http://img.blog.csdn.net/20160409000630784" alt="这里写图片描述"></p>
</li>
<li><p>导入完成后是这样的</p>
<p><img src="http://img.blog.csdn.net/20160409001321974" alt="这里写图片描述"></p>
</li>
</ul>
<p>###3.导入到自己的项目(即不使用Vitamio的libiary,强迫症专属)<br><img src="http://img.blog.csdn.net/20160908231510455" alt="这里写图片描述"></p>
<p>####A.在自己的目录下建立io.vov.vitamio<br>    并导入所有的类,以及将jniLibs目录拷贝到main目录下,还有相关的资源文件</p>
<p>####B.在AndroidManifest.xml文件中写入<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;activity </span><br><span class="line">android:name=&quot;io.vov.vitamio.activity.InitActivity&quot;             android:configChanges=&quot;orientation|screenSize|smallestScreenSize|keyboard|keyboardHidden|navigation&quot;</span><br><span class="line">android:launchMode=&quot;singleTop&quot;</span><br><span class="line">android:theme=&quot;@android:style/Theme.NoTitleBar&quot;</span><br><span class="line">android:windowSoftInputMode=&quot;stateAlwaysHidden&quot;/&gt;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>并加入相应的权限</p>
</blockquote>
<p>####C.在你喜欢的地方初始化Vitamio<br> 开玩笑的,放在activity或者是Application的onCreate中</p>
<blockquote>
<p>Vitamio.isInitialized(application.getApplicationContext()); </p>
</blockquote>
<hr>
<p>###3.Vatimio的使用</p>
<p>####A.界面的搭建<br><img src="http://img.blog.csdn.net/20160908232554310" alt="这里写图片描述"></p>
<p>可以看到<br>    整个页面主要分上下两层,主要是为了视屏全屏的时候能方便的隐藏整个下面的布局</p>
<p>####B.使用<br>在此之前为了方便的使用视屏全屏播放,对MediaController(package io.vov.vitamio.widget)做一个小小的改造:<br>添加一个构造:主要用于把视屏,进度条等放到一个View中,便于全屏展示<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//这个全屏的操作可把我难坏了,看到这个真的是为原作者的机智点赞</span><br><span class="line">  public MediaController(Context context,boolean fromXml,View container) &#123;</span><br><span class="line">    super(context);</span><br><span class="line">    initController(context);</span><br><span class="line">    mFromXml = fromXml;</span><br><span class="line">    mRoot = makeControllerView();</span><br><span class="line">    //这个地方的FrameLayout.LayoutpParams是因为布局文件中要把MediaController的视图作为childView加到一个FrameLayout中去</span><br><span class="line">    LayoutParams p = new LayoutParams(LayoutParams.FILL_PARENT, LayoutParams.WRAP_CONTENT);</span><br><span class="line">    //想怎样布局MediaController就尽情的发挥这个LayoutParams吧</span><br><span class="line">    p.gravity = Gravity.BOTTOM;</span><br><span class="line">    mRoot.setLayoutParams(p);</span><br><span class="line">    ((FrameLayout)container).addView(mRoot);</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure></p>
<p>接着你就可以愉快的玩耍了:<br>在oncreate中调用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initVitamioView();</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">//初始化控件</span><br><span class="line">private void initVitamioView() &#123;</span><br><span class="line">//VideoView</span><br><span class="line">mVideoView = (VideoView) findViewById(R.id.buffer);</span><br><span class="line">//这个就是包裹整个视屏模块的FrameLayout</span><br><span class="line">fl_controller = (FrameLayout) findViewById(R.id.fl_controller);</span><br><span class="line">//缓冲时出现的进度条</span><br><span class="line">pb = (ProgressBar) findViewById(R.id.probar);</span><br><span class="line">//播放进度,并可以拖动调节视屏播放位置</span><br><span class="line">downloadRateView = (TextView) findViewById(R.id.download_rate);</span><br><span class="line">loadRateView = (TextView) findViewById(R.id.load_rate);</span><br><span class="line">//设置视屏setVideoURI可以缓冲并播放</span><br><span class="line">//setVideoPath()缓冲完再播放</span><br><span class="line">mVideoView.setVideoURI(Uri.parse(TextUtils.isEmpty(path)?defaultPath:path));</span><br><span class="line">//这里使用自定义的那个MediaController构造</span><br><span class="line">mMediaController= new MediaController(this, true, fl_controller);</span><br><span class="line">//这里的监听其实是在MediaController中自己定义的,主要就是全屏的切换按钮</span><br><span class="line">mMediaController.setOnControllerClick(new MediaController.OnControllerClick() &#123;</span><br><span class="line">     @Override</span><br><span class="line">     public void OnClick(int type) &#123;</span><br><span class="line">         if (type == 0) &#123;  //表示点击切换全屏按钮</span><br><span class="line">	          if (isPortrait) &#123;</span><br><span class="line">		          //不是全屏,切换为全屏</span><br><span class="line">	             //代码块1</span><br><span class="line">	           &#125; else &#123;</span><br><span class="line">		          //是全屏,近来就切为原来的大小</span><br><span class="line">	             //代码块2</span><br><span class="line">		       &#125;</span><br><span class="line">          &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">//类似绑定 </span><br><span class="line">mVideoView.setMediaController(mMediaController);</span><br><span class="line">//隐藏控制模块</span><br><span class="line">mMediaController.setVisibility(View.GONE);</span><br><span class="line">mVideoView.requestFocus();</span><br><span class="line">//设置对视屏信息的监听</span><br><span class="line">mVideoView.setOnInfoListener(this);</span><br><span class="line">//视屏缓冲的监听</span><br><span class="line">mVideoView.setOnBufferingUpdateListener(this);</span><br><span class="line">//视屏OK</span><br><span class="line">mVideoView.setOnPreparedListener(new MediaPlayer.OnPreparedListener() &#123;</span><br><span class="line">     @Override</span><br><span class="line">     public void onPrepared(MediaPlayer mediaPlayer) &#123;</span><br><span class="line">	     //设置播放速度</span><br><span class="line">         mediaPlayer.setPlaybackSpeed(1.0f);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<p>补充代码块1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&gt; RelativeLayout.LayoutParams fl_lp = new RelativeLayout.LayoutParams(displayheight, displayWidth);</span><br><span class="line">                        fl_controller.setLayoutParams(fl_lp);</span><br><span class="line">//设置横屏                        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_LANDSCAPE);  //这样mVideoView会自己充满全屏</span><br><span class="line">                        mVideoView.setVideoLayout(VideoView.VIDEO_LAYOUT_SCALE, 0);</span><br><span class="line">                        isPortrait = false;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
<p>代码块2<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&gt; RelativeLayout.LayoutParams fl_lp = new RelativeLayout.LayoutParams(</span><br><span class="line">                                LinearLayout.LayoutParams.MATCH_PARENT,</span><br><span class="line">                                DensityUtils.dip2px(ClassRoomActivity.this,200)</span><br><span class="line">                        );</span><br><span class="line">                        fl_controller.setLayoutParams(fl_lp);</span><br><span class="line">                        setRequestedOrientation(ActivityInfo.SCREEN_ORIENTATION_PORTRAIT);</span><br><span class="line">                        isPortrait = true;</span><br><span class="line">&gt;</span><br></pre></td></tr></table></figure></p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/*</span><br><span class="line"> * 横竖屏切换的时候回走这个回调</span><br><span class="line"> *</span><br><span class="line"> */</span><br><span class="line">@Override</span><br><span class="line">public void onConfigurationChanged(Configuration newConfig) &#123;</span><br><span class="line">        //屏幕切换时，设置全屏</span><br><span class="line">        if (this.getResources().getConfiguration().orientation == Configuration.ORIENTATION_LANDSCAPE) &#123;</span><br><span class="line">	        //隐藏下面的布局和标题</span><br><span class="line">            tLBelow.setVisibility(View.GONE);</span><br><span class="line">            mTitlebar.setVisibility(View.GONE);</span><br><span class="line">        &#125;</span><br><span class="line">        if (this.getResources().getConfiguration().orientation == Configuration.ORIENTATION_PORTRAIT) &#123;</span><br><span class="line">	         //显示下面的布局和标题</span><br><span class="line">            tLBelow.setVisibility(View.VISIBLE);</span><br><span class="line">            mTitlebar.setVisibility(View.VISIBLE);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        super.onConfigurationChanged(newConfig);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>####C.两个重要的监听(上面已经注册过了)<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//缓冲的监听</span><br><span class="line">@Override</span><br><span class="line">    public void onBufferingUpdate(MediaPlayer mp, int percent) &#123;</span><br><span class="line">    //显示缓冲进度</span><br><span class="line">        loadRateView.setText(percent + &quot;%&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">//视屏信息监听</span><br><span class="line">@Override</span><br><span class="line">    public boolean onInfo(MediaPlayer mp, int what, int extra) &#123;</span><br><span class="line">        switch (what) &#123;</span><br><span class="line">        //开始缓冲</span><br><span class="line">            case MediaPlayer.MEDIA_INFO_BUFFERING_START:</span><br><span class="line">                if (mVideoView.isPlaying()) &#123;</span><br><span class="line">                    mVideoView.pause();</span><br><span class="line">                    pb.setVisibility(View.VISIBLE);</span><br><span class="line">                    downloadRateView.setText(&quot;&quot;);</span><br><span class="line">                    loadRateView.setText(&quot;&quot;);</span><br><span class="line">                    downloadRateView.setVisibility(View.VISIBLE);</span><br><span class="line">                    loadRateView.setVisibility(View.VISIBLE);</span><br><span class="line">                &#125;</span><br><span class="line">                break;</span><br><span class="line">                //停止缓冲,这里自动开始播放</span><br><span class="line">            case MediaPlayer.MEDIA_INFO_BUFFERING_END:</span><br><span class="line">                mVideoView.start();</span><br><span class="line">                pb.setVisibility(View.GONE);</span><br><span class="line">                downloadRateView.setVisibility(View.GONE);</span><br><span class="line">                loadRateView.setVisibility(View.GONE);</span><br><span class="line">                break;</span><br><span class="line">            case MediaPlayer.MEDIA_INFO_DOWNLOAD_RATE_CHANGED:</span><br><span class="line">	            //缓冲的...那个啥    change</span><br><span class="line">                downloadRateView.setText(&quot;&quot; + extra + &quot;kb/s&quot; + &quot;  &quot;);</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>###4.就这样<br>   对了,完事记得<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    protected void onDestroy() &#123;</span><br><span class="line">            mVideoView.stopPlayback();</span><br><span class="line">           super.onDestroy();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure></p>
<p>基本就是这样了,其他的问题自己解决一下就好了…</p>
]]></content>
      
        <categories>
            
            <category> Android Studio </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Android Studio </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Linux 学习笔记]]></title>
      <url>/Server/Linux-%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
      <content type="html"><![CDATA[<ul>
<li>netstat -an</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">查看所有网络连接</span><br></pre></td></tr></table></figure>
<ul>
<li>more命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">选项</span><br><span class="line"></span><br><span class="line">-num    指定屏幕的行数（以整数表示）</span><br><span class="line"></span><br><span class="line">+num    从行号num开始显示</span><br><span class="line"></span><br><span class="line">-d    让more给用户显示信息[Press space to continue, &apos;q&apos; to quit.]</span><br><span class="line"></span><br><span class="line">-f    使more计数逻辑行，而不是屏幕行（长行不会断到下一行）</span><br><span class="line"></span><br><span class="line">-s   把重复的空行压缩成一个空行</span><br><span class="line"></span><br><span class="line">-u    防止下划线</span><br><span class="line"></span><br><span class="line">交互基于VIM</span><br></pre></td></tr></table></figure>
<ul>
<li>字符界面</li>
</ul>
<p>1.字符界面占用资源少</p>
<p>2.减少了出错,别攻击的可能</p>
<ul>
<li>一切皆文件</li>
</ul>
<p>用户  硬件 文件….</p>
<ul>
<li>分区</li>
<li>swap 内存的两倍</li>
</ul>
<p>/ 根分区</p>
<p>/boot    boot分区  200m即可  (作为启动盘使用,启动需要空间)</p>
<p>/home  </p>
<p>/etc</p>
<p>…</p>
<ul>
<li>安装日志</li>
</ul>
<p>/root/install.log     记录了安装在系统中的软件包和版本信息</p>
<p>/root/install.log.syslog    安装过程的记录</p>
<p>/root/anaconda-ks.cfg    记录安装过程中的配置信息(用于网络批量安装)</p>
<ul>
<li>linux起始符</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@hadoop ~]#</span><br><span class="line">root 用户名</span><br><span class="line">hadoop  当前用户的主机名</span><br><span class="line">"~" 当前的目录, "~"表示家目录</span><br><span class="line">"#" 超级用户的提示符</span><br><span class="line">"$" 普通用户的提示符</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>-rw-r–r–</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">drwxr-xr-x. 2 wzm wzm 4096 6月  21 16:19 Desktop</span><br><span class="line"><span class="meta">#</span>一共10位  drwxr-xr-x</span><br><span class="line"><span class="meta">#</span>d</span><br><span class="line">第一位 文件类型( -文件  d目录 |软链接文件   c  b )</span><br><span class="line"><span class="meta">#</span>rwx r-x r-x</span><br><span class="line">后面的每三位是一组</span><br><span class="line">第一个三位   所属者u</span><br><span class="line">第二个三位   所属组g</span><br><span class="line">第三个三位   其他人o</span><br><span class="line"><span class="meta">#</span>acf权限</span><br><span class="line">r读</span><br><span class="line">w写</span><br><span class="line">x执行</span><br></pre></td></tr></table></figure>
<ul>
<li>目录</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">/        根目录</span><br><span class="line">/etc     配置文件目录</span><br><span class="line">/bin     系统命令的目录 (普通用户即可读取)</span><br><span class="line">/sbin    系统命令的目录 (超级用户即可读取)</span><br><span class="line">/usr/bin 系统命令的目录 (普通用户即可读取)</span><br><span class="line">/usr/sbin系统命令的目录 (超级用户即可读取)</span><br><span class="line">/home    普通用户的家目录</span><br><span class="line">/root    超级用户的家目录</span><br><span class="line">/usr     系统软件资源目录</span><br><span class="line">/boot    启动目录</span><br><span class="line">/var     系统相关文档</span><br><span class="line">/sys	 直接写入内存</span><br><span class="line">/proc    直接写入内存</span><br><span class="line">/dev     设备文件目录</span><br><span class="line">/lib     系统库 保存目录</span><br><span class="line">/mnt     系统挂载目录</span><br><span class="line">/media   挂载目录</span><br></pre></td></tr></table></figure>
<ul>
<li><p>linux 常用命令     control + L  清屏</p>
</li>
<li><p>文件命令</p>
<ul>
<li>基本命令格式</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">命令 [选项] [参数]</span><br><span class="line"><span class="meta">#</span>ls</span><br><span class="line">ls </span><br><span class="line">   -a  显示所有文件</span><br><span class="line">   -l  显示详细信息,目录下所有内容</span><br><span class="line">   -d  查看目录属性,目录本身</span><br><span class="line">   -h  人性化显示文件大小</span><br><span class="line">   -i  显示inode  文件的id号</span><br><span class="line">ll ll -l</span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure>
<p>​</p>
<ul>
<li>目录文件处理</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>mkdir  创建目录</span><br><span class="line">mkdir </span><br><span class="line">  -p  递归创建,创建多级目录</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span>cd  切换目录</span><br><span class="line">cd </span><br><span class="line">  ~  当前用户的家目录</span><br><span class="line">  -  进入上次进入的目录</span><br><span class="line">  .. 进入上级目录</span><br><span class="line">  .  进入当前目录</span><br><span class="line">  </span><br><span class="line"><span class="meta">#</span>pwd</span><br><span class="line">pwd  显示当前目录全路径</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>rm -rf [文件或目录]</span><br><span class="line">rm </span><br><span class="line"> -f 强制删除</span><br><span class="line"> -r 删除目录</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span>cp</span><br><span class="line">cp</span><br><span class="line"> -r 复制目录</span><br><span class="line"> -p 连带文件的属性一起复制</span><br><span class="line"> -d 如果文件为链接文件,则复制链接属性</span><br><span class="line"> -a 相当于-pdr</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>mv</span><br><span class="line">mv [源地址] [目标地址]</span><br></pre></td></tr></table></figure>
<p>​</p>
<ul>
<li>软链接命令(源文件一定写巨绝对路径)</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>ln [源] [目标]</span><br><span class="line">ln</span><br><span class="line">不能跨分区,不能是一个目录</span><br><span class="line">相当于一个文件   文件id号相同</span><br><span class="line"></span><br><span class="line"> -s    软链接   类似windows里面的快捷方式</span><br><span class="line"> 有自己的id号   </span><br><span class="line"> 其实是去查看自己的存储点,</span><br><span class="line"> 存储点里面是源文件的id号,</span><br><span class="line"> 然后又用源文件id号去找源文件的存储点</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>搜索命令</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">locate 文件搜索命令</span><br><span class="line">whereis 与 which</span><br><span class="line">find 文件搜索命令</span><br><span class="line">grep 字符串搜索命令</span><br></pre></td></tr></table></figure>
<ul>
<li><p>locate </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>locate</span><br><span class="line">locate [文件名]</span><br><span class="line"></span><br><span class="line">在后台数据库中按文件名搜索</span><br><span class="line">位置在:</span><br><span class="line">/var/lib/mlocate</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>updatedb</span><br><span class="line">updatedb 更新数据库</span><br></pre></td></tr></table></figure>
</li>
<li><p>whereis </p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>whereis</span><br><span class="line">whereis [命令名]</span><br><span class="line"> -b 之查找可执行文件</span><br><span class="line"> -m 只查找帮助文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>which</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">查看</span><br><span class="line"><span class="meta">#</span>which</span><br><span class="line">which [文件名]</span><br><span class="line">搜索命令所在目录路径已经别名</span><br></pre></td></tr></table></figure>
</li>
<li><p>find</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>find</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>避大范围搜索,会非常消耗系统资源</span><br><span class="line"><span class="meta">#</span>如果不用通配符,则会搜索与文件名完全一致的文件</span><br><span class="line"></span><br><span class="line">find [搜素范围] [搜索条件]</span><br><span class="line"></span><br><span class="line">find [搜素范围] </span><br><span class="line">  -name [名字]</span><br><span class="line">  </span><br><span class="line">  -iname [名字]  不区分大小写</span><br><span class="line">  </span><br><span class="line">  -user [所有者]  按所有者搜索</span><br><span class="line">  </span><br><span class="line">  -nouser   查找没有所有者的文件 </span><br><span class="line">  </span><br><span class="line">  -mtime  [] 修改文件内容的时间 </span><br><span class="line">  -atime  [] 文件访问时间</span><br><span class="line">  -ctime  [] 改变文件属性的时间</span><br><span class="line">    [-10 10 +10  10天内  10天当天  +10天前]</span><br><span class="line">  </span><br><span class="line">  -size [大小]  当前目录下查找大小是 25k的文件</span><br><span class="line">    [-25k 25k +25k]</span><br><span class="line">    [-2M 2M +2M]</span><br><span class="line">  </span><br><span class="line">  -inum [id号]  </span><br><span class="line">  </span><br><span class="line">  -a   and 逻辑与,同时满足两个条件</span><br><span class="line">   eg find /etc -size +25k -a -size -50k</span><br><span class="line"></span><br><span class="line">  -o   or  逻辑或,两个条件满足一个条件即可</span><br><span class="line">  </span><br><span class="line">  -exec [一个命令] &#123;&#125; \;   搜索出来的结果再执行一次命令</span><br><span class="line">   eg find /etc -size +25k -a -size -50k -exec ls -lh &#123;&#125; \;</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>通配符</span><br><span class="line">*    匹配任何内容</span><br><span class="line">?    匹配任意一个字符</span><br><span class="line">[]   匹配任意一个中口号内的字符    </span><br><span class="line">     eg:  abc  abd</span><br><span class="line">     find /home -name ab[cd]</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>grep</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span>grep</span><br><span class="line">grep "size" system.log</span><br><span class="line"></span><br><span class="line">grep是包含匹配   在  system.log  中查找"size"</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>​</p>
</li>
<li><p>帮助命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">man [命令]</span><br><span class="line"></span><br><span class="line">whatis [命令] </span><br><span class="line"></span><br><span class="line">man -f [命令]   命令的帮助级别</span><br><span class="line"></span><br><span class="line">man -k [命令]   模糊匹配</span><br><span class="line"> </span><br><span class="line">apropos [命令]   模糊匹配</span><br><span class="line"></span><br><span class="line">[命令] --help</span><br><span class="line"></span><br><span class="line">内核的命令查看帮助</span><br><span class="line"></span><br><span class="line">help [命令]</span><br></pre></td></tr></table></figure>
<p>​</p>
</li>
<li><p>压缩与解压缩</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">常用压缩格式   .zip  .gz  .bz2   .tar.gz   .tar.bz2</span><br></pre></td></tr></table></figure>
<ul>
<li><p>zip</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">zip [压缩文件名字] [源文件]</span><br><span class="line"></span><br><span class="line">zip -r [压缩文件名字] [源目录]</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>解压缩</span><br><span class="line">unzip [zip文件]</span><br></pre></td></tr></table></figure>
</li>
<li><p>gz</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">gzip [源文件]   </span><br><span class="line"><span class="meta">#</span>压缩为.gz格式的压缩文件,源文件会消失</span><br><span class="line"></span><br><span class="line">gzip -c [源文件] &gt; 压缩文件</span><br><span class="line"><span class="meta">#</span>压缩为.gz格式 ,源文件保留</span><br><span class="line"></span><br><span class="line">gzip -r [源目录] </span><br><span class="line"><span class="meta">#</span>压缩目录下所有的子文件,但是不能压缩目录</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>解压缩</span><br><span class="line">gzip -d [压缩文件]</span><br><span class="line"></span><br><span class="line">gunzip [压缩文件]</span><br><span class="line"></span><br><span class="line">gzp -d -r [目录]   解压目录下所有的文件</span><br></pre></td></tr></table></figure>
</li>
<li><p>tar </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">#tar</span><br><span class="line">tar -cvf [打包文件名] [源文件]</span><br><span class="line">  -c 打包</span><br><span class="line">  -v 显示过程</span><br><span class="line">  -f 指定打包后的文件名</span><br><span class="line">     eg tar -cvf jp.tar jp</span><br><span class="line"></span><br><span class="line">#解压缩</span><br><span class="line">tar -xvf [压缩文件]</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- .tar.gz

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">tar -zcvf [压缩文件名] [源文件]</span><br><span class="line"></span><br><span class="line">#解压缩</span><br><span class="line">tar -zxvf [压缩包名.tar.gz]</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>关机和重启</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">shutdown [选项] 时间</span><br><span class="line"> -c   取消前一个关机命令</span><br><span class="line"> -h   关机</span><br><span class="line"> -r   重启</span><br><span class="line"> </span><br><span class="line">logout 退出登录</span><br></pre></td></tr></table></figure>
<ul>
<li>其他的命令</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">w  显示所有的登录用户</span><br><span class="line">last  所有登录信息</span><br><span class="line">lastlog   所有用户登录信息</span><br></pre></td></tr></table></figure>
<ul>
<li>其他快捷键</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">control + c   强制终止当前命令</span><br><span class="line">control + l   清屏</span><br><span class="line">control + a   光标移动到行首</span><br><span class="line">control + e   光标移动到行尾</span><br><span class="line">control + u   从光标位置删除到行首</span><br><span class="line">control + z   把命令放入到后台</span><br><span class="line">control + r   在历史记录中搜索</span><br></pre></td></tr></table></figure>
<ul>
<li>输出重定向</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">#标准的输出重定向</span><br><span class="line">命令 &gt; 文件    覆盖的方式写入</span><br><span class="line"></span><br><span class="line">命令 &gt;&gt; 文件   追加的方式写入</span><br><span class="line"></span><br><span class="line">#错误输出重定向</span><br><span class="line"></span><br><span class="line">错误命令 2&gt; 文件  覆盖的方式写入错误提示</span><br><span class="line">错误命令 2&gt;&gt; 文件  追加的方式写入错误提示</span><br><span class="line"></span><br><span class="line">#正确和错误的同时输出</span><br><span class="line">命令  &gt;&gt; 文件 2&gt;&amp;1</span><br><span class="line"></span><br><span class="line">命令  &amp;&gt;&gt; 文件</span><br><span class="line"></span><br><span class="line">#正确错误分开输出</span><br><span class="line">命令 &gt;&gt; 文件 2&gt;&gt; 文件</span><br></pre></td></tr></table></figure>
<p>-输入重定向</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">wc [选项] [文件名]</span><br><span class="line">    -c 统计字节数</span><br><span class="line">    -w 统计单词数</span><br><span class="line">    -l 统计行数</span><br><span class="line"> </span><br><span class="line">wc</span><br><span class="line">在终端输入文字    </span><br><span class="line">control + D 统计结果</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">wc [文件名]</span><br><span class="line">   文件内容输入到终端</span><br></pre></td></tr></table></figure>
<ul>
<li><p>管道符</p>
<ul>
<li><p>多命令执行(前一条命令的结果不会传入)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[命令1] ; [命令2]    顺序执行</span><br><span class="line"></span><br><span class="line">[命令1] &amp;&amp; [命令2]    </span><br><span class="line">    命令1执行正确   命令2执行</span><br><span class="line">    命令1执行错误   命令2不会执行</span><br><span class="line"></span><br><span class="line">[命令1] || [命令2]  </span><br><span class="line">    当命令1执行不正确   命令2执行</span><br><span class="line">    命令1执行正确   命令2就不会执行</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- 管道符(前一条命令的结果传入下一个命令)

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"> # |</span><br><span class="line">[命令1] | [命令2]</span><br><span class="line">   命令2会去操作命令1执行的结果</span><br></pre></td></tr></table></figure>
</code></pre><ul>
<li>通配符</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">?       任意一个字符</span><br><span class="line">*       任意内容</span><br><span class="line">[]      匹配括号中的某一个字符</span><br><span class="line">[-]     匹配括号中的任意一个字符 - 代表一个范围 [a-z] [1-3]</span><br><span class="line">[^]     表示匹配不是括号中的字符 比如[^0-9] 指匹配不是数字的字符</span><br><span class="line"></span><br><span class="line">&apos;&apos;      单引号   在单引号中所有字符都没有特殊含义</span><br><span class="line">&quot;&quot;      双引号 除了&quot;$&quot; 和 &quot;`&quot; &quot;\&quot; 其他字符都没有特殊意义</span><br><span class="line"></span><br><span class="line">``      反引号 是系统命令内容</span><br><span class="line">$()     用来引用系统命令</span><br><span class="line">#       shell中表示注释</span><br><span class="line">$       调用变量的值</span><br><span class="line">\       转义符</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Server </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Server </tag>
            
            <tag> Linux </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Facebook/Stetho——Android开发调试神器]]></title>
      <url>/Android/Facebook-Stetho%E2%80%94%E2%80%94Android%E5%BC%80%E5%8F%91%E8%B0%83%E8%AF%95%E7%A5%9E%E5%99%A8/</url>
      <content type="html"><![CDATA[<p>####一、简介</p>
<p>Stetho是一个Android应用调试工具。集成后，开发人员可以通过Chrome的开发工具查看App相关的信息和调试；可视化操作，不需要自己使用adb也不需要root权限。</p>
<p>####二、APP集成</p>
<p>1.下载最新的jar，或者通过Gradle引入stetho的libraay</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.facebook.stetho:stetho:1.3.1&apos;</span><br></pre></td></tr></table></figure>
<p>2.只需要在 Application的 onCreate 方法中调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class MyApplication extends Application &#123;</span><br><span class="line">   public void onCreate() &#123;</span><br><span class="line">     super.onCreate();</span><br><span class="line">     Stetho.initializeWithDefaults(this);</span><br><span class="line">   &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>
<p>3.如果还想查看网络请求的话，需要引入另外的Library</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">compile &apos;com.facebook.stetho:stetho-okhttp3:1.3.1&apos;</span><br></pre></td></tr></table></figure>
<p>4.使用okhttp 还需要添加 StethoInterceptor</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">OkHttpClient client = new OkHttpClient.Builder()</span><br><span class="line">             .addNetworkInterceptor(new StethoInterceptor())</span><br><span class="line">             .build();</span><br></pre></td></tr></table></figure>
<p>####三、使用<br>配置完成之后，在Chrome地址栏输入<code>chrome://inspect</code></p>
<blockquote>
<p>chrome://inspect/#devices</p>
</blockquote>
<p>chrome会检测到我们的app，点击 <em>inspect</em> 进入查看页面</p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[String.format的参数表]]></title>
      <url>/Android/String-format%E7%9A%84%E5%8F%82%E6%95%B0%E8%A1%A8/</url>
      <content type="html"><![CDATA[<p>####String.format()</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">%s  字符串类型 &quot;mingrisoft&quot;</span><br><span class="line">%c  字符类型    &apos;m&apos;</span><br><span class="line">%b  布尔类型    true</span><br><span class="line">%d  整数类型（十进制）   99</span><br><span class="line">%x  整数类型（十六进制）  FF</span><br><span class="line">%o  整数类型（八进制）   77</span><br><span class="line">%f  浮点类型    99.99</span><br><span class="line">%a  十六进制浮点类型    FF.35AE</span><br><span class="line">%e  指数类型    9.38e+5</span><br><span class="line">%g  通用浮点类型（f和e类型中较短的）</span><br><span class="line">%h  散列码 </span><br><span class="line">%%  百分比类型   ％</span><br><span class="line">%n  换行符</span><br><span class="line">%tx 日期与时间类型（x代表不同的日期与时间转换符</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[透明度对照表]]></title>
      <url>/Tools/%E9%80%8F%E6%98%8E%E5%BA%A6%E5%AF%B9%E7%85%A7%E8%A1%A8/</url>
      <content type="html"><![CDATA[<p>####透明度对照表</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">100% — FF</span><br><span class="line"></span><br><span class="line">95% — F2</span><br><span class="line"></span><br><span class="line">90% — E6</span><br><span class="line"></span><br><span class="line">85% — D9</span><br><span class="line"></span><br><span class="line">80% — CC</span><br><span class="line"></span><br><span class="line">75% — BF</span><br><span class="line"></span><br><span class="line">70% — B3</span><br><span class="line"></span><br><span class="line">65% — A6</span><br><span class="line"></span><br><span class="line">60% — 99</span><br><span class="line"></span><br><span class="line">55% — 8C</span><br><span class="line"></span><br><span class="line">50% — 80</span><br><span class="line"></span><br><span class="line">45% — 73</span><br><span class="line"></span><br><span class="line">40% — 66</span><br><span class="line"></span><br><span class="line">35% — 59</span><br><span class="line"></span><br><span class="line">30% — 4D</span><br><span class="line"></span><br><span class="line">25% — 40</span><br><span class="line"></span><br><span class="line">20% — 33</span><br><span class="line"></span><br><span class="line">15% — 26</span><br><span class="line"></span><br><span class="line">10% — 1A</span><br><span class="line"></span><br><span class="line">5% — 0D</span><br><span class="line"></span><br><span class="line">0% — 00</span><br></pre></td></tr></table></figure>
]]></content>
      
        <categories>
            
            <category> Tools </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
  
  
</search>
